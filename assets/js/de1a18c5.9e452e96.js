"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2675],{79224:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>r});var i=t(74848),s=t(28453);const l={layout:"api",page_title:"/sys/internal/counters - HTTP API",description:"The `/sys/internal/counters` endpoints are used to return data about OpenBao usage."},a="/sys/internal/counters",c={id:"system/internal-counters",title:"/sys/internal/counters",description:"The `/sys/internal/counters` endpoints are used to return data about OpenBao usage.",source:"@site/content/api-docs/system/internal-counters.mdx",sourceDirName:"system",slug:"/system/internal-counters",permalink:"/openbao/api-docs/system/internal-counters",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/api-docs/system/internal-counters.mdx",tags:[],version:"current",frontMatter:{layout:"api",page_title:"/sys/internal/counters - HTTP API",description:"The `/sys/internal/counters` endpoints are used to return data about OpenBao usage."},sidebar:"apiSidebar",previous:{title:"/sys/internal/inspect/router",permalink:"/openbao/api-docs/system/inspect/router"},next:{title:"/sys/internal/specs/openapi",permalink:"/openbao/api-docs/system/internal-specs-openapi"}},o={},r=[{value:"Entities",id:"entities",level:2},{value:"Sample request",id:"sample-request",level:3},{value:"Sample response",id:"sample-response",level:3},{value:"Tokens",id:"tokens",level:2},{value:"Sample request",id:"sample-request-1",level:3},{value:"Sample response",id:"sample-response-1",level:3},{value:"Client count",id:"client-count",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Sample request",id:"sample-request-2",level:3},{value:"Sample response",id:"sample-response-2",level:3},{value:"Sample request for a single month",id:"sample-request-for-a-single-month",level:3},{value:"Sample request to get client counts for top 2 namespaces with highest activity for a usage period",id:"sample-request-to-get-client-counts-for-top-2-namespaces-with-highest-activity-for-a-usage-period",level:3},{value:"Partial month client count",id:"partial-month-client-count",level:2},{value:"Sample request",id:"sample-request-3",level:3},{value:"Sample response",id:"sample-response-3",level:3},{value:"Update the client count configuration",id:"update-the-client-count-configuration",level:2},{value:"Parameters",id:"parameters-1",level:3},{value:"Sample payload",id:"sample-payload",level:3},{value:"Sample request",id:"sample-request-4",level:3},{value:"Read the client count configuration",id:"read-the-client-count-configuration",level:2},{value:"Sample request",id:"sample-request-5",level:3},{value:"Sample response",id:"sample-response-4",level:3},{value:"Activity export",id:"activity-export",level:2},{value:"Parameters",id:"parameters-2",level:3},{value:"Sample request",id:"sample-request-6",level:3},{value:"Sample response",id:"sample-response-5",level:3}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"sysinternalcounters",children:(0,i.jsx)(e.code,{children:"/sys/internal/counters"})}),"\n",(0,i.jsxs)(e.p,{children:["The ",(0,i.jsx)(e.code,{children:"/sys/internal/counters"})," endpoints are used to return data about the number of Tokens and Entities in OpenBao. They return information for the entire cluster."]}),"\n",(0,i.jsx)(e.h2,{id:"entities",children:"Entities"}),"\n",(0,i.jsx)(e.p,{children:"This endpoint returns the total number of Entities."}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Method"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,i.jsx)(e.tbody,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"GET"})}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"/sys/internal/counters/entities"})})]})})]}),"\n",(0,i.jsx)(e.h3,{id:"sample-request",children:"Sample request"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell-session",children:'$ curl \\\n    --header "X-Vault-Token: ..." \\\n    --request GET \\\n    http://127.0.0.1:8200/v1/sys/internal/counters/entities\n'})}),"\n",(0,i.jsx)(e.h3,{id:"sample-response",children:"Sample response"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "request_id": "75cbaa46-e741-3eba-2be2-325b1ba8f03f",\n  "lease_id": "",\n  "renewable": false,\n  "lease_duration": 0,\n  "data": {\n    "counters": {\n      "entities": {\n        "total": 1\n      }\n    }\n  },\n  "wrap_info": null,\n  "warnings": null,\n  "auth": null\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"tokens",children:"Tokens"}),"\n",(0,i.jsx)(e.p,{children:"This endpoint returns the total number of Tokens."}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Method"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,i.jsx)(e.tbody,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"GET"})}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"/sys/internal/counters/tokens"})})]})})]}),"\n",(0,i.jsx)(e.h3,{id:"sample-request-1",children:"Sample request"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell-session",children:'$ curl \\\n    --header "X-Vault-Token: ..." \\\n    --request GET \\\n    http://127.0.0.1:8200/v1/sys/internal/counters/tokens\n'})}),"\n",(0,i.jsx)(e.h3,{id:"sample-response-1",children:"Sample response"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "request_id": "75cbaa46-e741-3eba-2be2-325b1ba8f03f",\n  "lease_id": "",\n  "renewable": false,\n  "lease_duration": 0,\n  "data": {\n    "counters": {\n      "service_tokens": {\n        "total": 1\n      }\n    }\n  },\n  "wrap_info": null,\n  "warnings": null,\n  "auth": null\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"client-count",children:"Client count"}),"\n",(0,i.jsxs)(e.p,{children:["This endpoint returns client activity information for a given billing\nperiod, which is represented by the ",(0,i.jsx)(e.code,{children:"start_time"})," and ",(0,i.jsx)(e.code,{children:"end_time"})," parameters."]}),"\n",(0,i.jsx)(e.p,{children:"There are a few things to keep in mind while using this API."}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["The response contains the total activity for the billing period and the\nattributions of the total activity against specific components in OpenBao. This\nhelps in understanding the total activity better by knowing which components in\nOpenBao lead to that top-level activity count. First-level of attribution\nbreakdowns are by namespaces and months, under the ",(0,i.jsx)(e.code,{children:"by_namespaces"})," and ",(0,i.jsx)(e.code,{children:"months"}),"\nJSON block, respectively."]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n   "by_namespace":[],\n   "months":[],\n}\n'})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"by_namespaces"})," breakdowns provide attributions of each namespace to the total\nactivity count. Mount level attributions further break down these namespaces\nattributions, wherein information can be found on the attributions of each mount\npath within a given namespace to the overall activity of the namespace."]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n   "by_namespace":[\n      {\n         "namespace_id":"root",\n         "namespace_path":"",\n         "counts":{},\n         "mounts":[\n            {\n               "path":"auth/up1/",\n               "counts":{}\n            },\n            {\n               "path":"auth/up2/",\n               "counts":{}\n            }\n         ]\n      }\n   ]\n}\n'})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"months"})," breakdowns provide attributions of each month to the total activity\ncount. These month-level attributions are further broken down into namespace and mount\nlevel attributions for each month."]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n   "months":[\n      {\n         "timestamp":"2021-05-01T00:00:00Z",\n         "counts":{},\n         "namespaces":[\n            {\n               "namespace_id":"root",\n               "namespace_path":"",\n               "counts":{},\n               "mounts":[\n                  {\n                     "path":"auth/up2/",\n                     "counts":{}\n                  },\n                  {\n                     "path":"auth/up1/",\n                     "counts":{}\n                  }\n               ]\n            },\n            {\n               "namespace_id":"s07UR",\n               "namespace_path":"ns1/",\n               "counts":{},\n               "mounts":[\n                  {\n                     "path":"auth/up1/",\n                     "counts":{}\n                  },\n                  {\n                     "path":"auth/up2/",\n                     "counts":{}\n                  }\n               ]\n            }\n         ],\n         "new_clients":{}\n      }\n   ],\n}\n'})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Each entry in the ",(0,i.jsx)(e.code,{children:"months"})," breakdown contains a ",(0,i.jsx)(e.code,{children:"new_clients"})," block. When a\ntoken is first used within a billing period, it is considered a new client for\nthat billing period. This means that all the active clients in the first month\nof the billing period will be considered new clients for that billing period.\nWhile these tokens could be generated and counted in the previous billing\nperiod, they are still considered new clients in the context of the given\nbilling period. For each subsequent month in the same billing period, the tokens\nused in those months that were unused in previous months of the same billing\nperiod are considered new clients for that month. Hence, the computation of new\nclients differs for each combination of ",(0,i.jsx)(e.code,{children:"start_time"})," and ",(0,i.jsx)(e.code,{children:"end_time"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["The ",(0,i.jsx)(e.code,{children:"new_clients"})," block within the ",(0,i.jsx)(e.code,{children:"months"})," breakdown will also be further\nbroken down by namespaces and mounts for visibility into which components in\nOpenBao lead to the new clients for each month."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n   "months":[\n      {\n         "new_clients":{\n            "counts":{},\n            "namespaces":[\n               {\n                  "namespace_id":"root",\n                  "namespace_path":"",\n                  "counts":{},\n                  "mounts":[\n                     {\n                        "path":"auth/up2/",\n                        "counts":{}\n                     },\n                     {\n                        "path":"auth/up1/",\n                        "counts":{}\n                     }\n                  ]\n               }\n            ]\n         }\n      }\n   ],\n}\n'})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["The ",(0,i.jsx)(e.code,{children:"distinct_entities"})," field name has been deprecated. Refer to\n",(0,i.jsx)(e.code,{children:"entity_clients"})," field instead. The ",(0,i.jsx)(e.code,{children:"distinct_entities"})," field is currently\nreturned by the API for backward compatibility and it may be removed in the\nfuture."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["The ",(0,i.jsx)(e.code,{children:"non_entity_tokens"})," field name has been deprecated. Refer to\n",(0,i.jsx)(e.code,{children:"non_entity_clients"})," field instead. The ",(0,i.jsx)(e.code,{children:"non_entity_tokens"})," field is currently\nreturned by the API for backward compatibility, and it may be removed in the\nfuture."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["If the ",(0,i.jsx)(e.code,{children:"end_date"})," supplied to the API is for the current month, the activity\ninformation returned by this API will only be till the previous month. The\nactivity system is designed to process the accumulated activity only at the end\nof the month. Since the system does not fully process the current month's\ninformation, it will not be added to the API response."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"The response includes the actual time period covered, which may not exactly\nmatch the query parameters due to the month granularity of data or missing\nmonths in the requested time range."}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Note that if the ",(0,i.jsx)(e.code,{children:"end_date"})," specified is the current month,\nthe last element in the ",(0,i.jsx)(e.code,{children:"months"})," response stanza, signifying the current month, will\nnot have namespace attribution for the ",(0,i.jsx)(e.code,{children:"new_clients"})," stanza. Furthermore, the\n",(0,i.jsx)(e.code,{children:"new_clients"})," counts returned for the current month will be an approximation.\nThat is to say, the response will appear as follows."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n   "months":[\n      {\n         "timestamp":"current_month_timestamp",\n         "counts":{\n            "distinct_entities":"exact int value",\n            "entity_clients":"exact int value",\n            "non_entity_tokens":"exact int value",\n            "non_entity_clients":"exact int value",\n            "clients":"exact int value"\n         },\n         "namespaces": [\n               {\n                  "namespace_id":"root",\n                  "namespace_path":"path",\n                  "counts":{\n                     "distinct_entities":"exact int value",\n                     "entity_clients":"exact int value",\n                     "non_entity_tokens":"exact int value",\n                     "non_entity_clients":"exact int value",\n                     "clients":"exact int value"\n                  },\n                  "mounts":[\n                     {\n                        "path":"auth/up2/",\n                        "counts":{\n                           "distinct_entities":"exact int value",\n                           "entity_clients":"exact int value",\n                           "non_entity_tokens":"exact int value",\n                           "non_entity_clients":"exact int value",\n                           "clients":"exact int value"\n                        },\n                     },\n                  ]\n               },\n         ],\n         "new_clients":{\n            "counts":{\n               "distinct_entities":"approx int value",\n               "entity_clients":"approx int value",\n               "non_entity_tokens":"approx int value",\n               "non_entity_clients":"approx int value",\n               "clients":"approx int value"\n            },\n            "namespaces":[]\n         }\n      }\n   ],\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:["Please visit the ",(0,i.jsx)(e.a,{href:"/docs/concepts/client-count",children:"client count"})," concepts page for\nmore information on how clients map to these client IDs and how they are\ncounted, or for more information about how the new clients for the current month\nare estimated in a billing period."]}),"\n",(0,i.jsx)(e.p,{children:'The response will include all child namespaces of the namespace in which the\nrequest was made. If some namespace has subsequently been deleted, its path will\nbe listed as "deleted namespace :ID:." Deleted namespaces are reported only for\nqueries in the root namespace because the information about the namespace path\nis unknown.'}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Method"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,i.jsx)(e.tbody,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"GET"})}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"/sys/internal/counters/activity"})})]})})]}),"\n",(0,i.jsx)(e.h3,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"start_time"})," ",(0,i.jsx)(e.code,{children:"(string, optional)"})," - An RFC3339 timestamp or Unix epoch time. Specifies the start of the\nperiod for which client counts will be reported. If no start time is specified, the ",(0,i.jsx)(e.code,{children:"default_report_months"}),"\nprior to the ",(0,i.jsx)(e.code,{children:"end_time"})," will be used."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"end_time"})," ",(0,i.jsx)(e.code,{children:"(string, optional)"})," - An RFC3339 timestamp or Unix epoch time. Specifies the end of the period\nfor which client counts will be reported. If no end time is specified, the end of the previous calendar\nmonth will be used."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"limit_namespaces"})," ",(0,i.jsx)(e.code,{children:"(int, optional)"})," - Controls the total number of by_namespace data returned. This can\nbe used to return the client counts for the specified number of namespaces having highest activity.\nIf no ",(0,i.jsx)(e.code,{children:"limit_namespaces"})," parameter is specified, client counts for all namespaces in specified usage period is returned."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"current_billing_period"})," ",(0,i.jsx)(e.code,{children:"(bool, optional)"})," - Uses the builtin billing start\ntimestamp as ",(0,i.jsx)(e.code,{children:"start_time"})," and the current time as the ",(0,i.jsx)(e.code,{children:"end_time"}),", returning a\nresponse with the current billing period information without having to\nexplicitly provide a start and end time."]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"sample-request-2",children:"Sample request"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell-session",children:'$ curl \\\n    --header "X-Vault-Token: ..." \\\n    --request GET \\\n    http://127.0.0.1:8200/v1/sys/internal/counters/activity\n'})}),"\n",(0,i.jsx)(e.h3,{id:"sample-response-2",children:"Sample response"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n   "request_id":"26be5ab9-dcac-9237-ec12-269a8ca647d5",\n   "lease_id":"",\n   "renewable":false,\n   "lease_duration":0,\n   "data":{\n      "by_namespace":[\n         {\n            "namespace_id":"root",\n            "namespace_path":"",\n            "counts":{\n               "distinct_entities":20,\n               "entity_clients":20,\n               "non_entity_tokens":10,\n               "non_entity_clients":10,\n               "clients":30\n            },\n            "mounts":[\n               {\n                  "path":"auth/up1/",\n                  "counts":{\n                     "distinct_entities":10,\n                     "entity_clients":10,\n                     "non_entity_tokens":10,\n                     "non_entity_clients":10,\n                     "clients":20\n                  }\n               },\n               {\n                  "path":"auth/up2/",\n                  "counts":{\n                     "distinct_entities":5,\n                     "entity_clients":5,\n                     "non_entity_tokens":5,\n                     "non_entity_clients":5,\n                     "clients":10\n                  }\n               }\n            ]\n         },\n         {\n            "namespace_id":"s07UR",\n            "namespace_path":"ns1/",\n            "counts":{\n               "distinct_entities":5,\n               "entity_clients":5,\n               "non_entity_tokens":5,\n               "non_entity_clients":5,\n               "clients":10\n            },\n            "mounts":[\n               {\n                  "path":"auth/up1/",\n                  "counts":{\n                     "distinct_entities":0,\n                     "entity_clients":0,\n                     "non_entity_tokens":5,\n                     "non_entity_clients":5,\n                     "clients":5\n                  }\n               },\n               {\n                  "path":"auth/up2/",\n                  "counts":{\n                     "distinct_entities":5,\n                     "entity_clients":5,\n                     "non_entity_tokens":0,\n                     "non_entity_clients":0,\n                     "clients":5\n                  }\n               }\n            ]\n         }\n      ],\n      "end_time":"2021-05-31T23:59:59Z",\n      "months":[\n         {\n            "timestamp":"2021-05-01T00:00:00Z",\n            "counts":{\n               "distinct_entities":20,\n               "entity_clients":20,\n               "non_entity_tokens":10,\n               "non_entity_clients":10,\n               "clients":30\n            },\n            "namespaces":[\n               {\n                  "namespace_id":"root",\n                  "namespace_path":"",\n                  "counts":{\n                     "distinct_entities":15,\n                     "entity_clients":15,\n                     "non_entity_tokens":5,\n                     "non_entity_clients":5,\n                     "clients":20\n                  },\n                  "mounts":[\n                     {\n                        "path":"auth/up2/",\n                        "counts":{\n                           "distinct_entities":10,\n                           "entity_clients":10,\n                           "non_entity_tokens":5,\n                           "non_entity_clients":5,\n                           "clients":15\n                        }\n                     },\n                     {\n                        "path":"auth/up1/",\n                        "counts":{\n                           "distinct_entities":3,\n                           "entity_clients":3,\n                           "non_entity_tokens":2,\n                           "non_entity_clients":2,\n                           "clients":5\n                        }\n                     }\n                  ]\n               },\n               {\n                  "namespace_id":"s07UR",\n                  "namespace_path":"ns1/",\n                  "counts":{\n                     "distinct_entities":5,\n                     "entity_clients":5,\n                     "non_entity_tokens":5,\n                     "non_entity_clients":5,\n                     "clients":10\n                  },\n                  "mounts":[\n                     {\n                        "path":"auth/up1/",\n                        "counts":{\n                           "distinct_entities":0,\n                           "entity_clients":0,\n                           "non_entity_tokens":5,\n                           "non_entity_clients":5,\n                           "clients":5\n                        }\n                     },\n                     {\n                        "path":"auth/up2/",\n                        "counts":{\n                           "distinct_entities":5,\n                           "entity_clients":5,\n                           "non_entity_tokens":0,\n                           "non_entity_clients":0,\n                           "clients":5\n                        }\n                     }\n                  ]\n               }\n            ],\n            "new_clients":{\n               "counts":{\n                  "distinct_entities":10,\n                  "entity_clients":10,\n                  "non_entity_tokens":10,\n                  "non_entity_clients":10,\n                  "clients":20\n               },\n               "namespaces":[\n                  {\n                     "namespace_id":"root",\n                     "namespace_path":"",\n                     "counts":{\n                        "distinct_entities":5,\n                        "entity_clients":5,\n                        "non_entity_tokens":5,\n                        "non_entity_clients":5,\n                        "clients":10\n                     },\n                     "mounts":[\n                        {\n                           "path":"auth/up2/",\n                           "counts":{\n                              "distinct_entities":0,\n                              "entity_clients":0,\n                              "non_entity_tokens":5,\n                              "non_entity_clients":5,\n                              "clients":5\n                           }\n                        },\n                        {\n                           "path":"auth/up1/",\n                           "counts":{\n                              "distinct_entities":5,\n                              "entity_clients":5,\n                              "non_entity_tokens":0,\n                              "non_entity_clients":0,\n                              "clients":5\n                           }\n                        }\n                     ]\n                  },\n                  {\n                     "namespace_id":"s07UR",\n                     "namespace_path":"ns1/",\n                     "counts":{\n                        "distinct_entities":5,\n                        "entity_clients":5,\n                        "non_entity_tokens":5,\n                        "non_entity_clients":5,\n                        "clients":10\n                     },\n                     "mounts":[\n                        {\n                           "path":"auth/up1/",\n                           "counts":{\n                              "distinct_entities":0,\n                              "entity_clients":0,\n                              "non_entity_tokens":5,\n                              "non_entity_clients":5,\n                              "clients":5\n                           }\n                        },\n                        {\n                           "path":"auth/up2/",\n                           "counts":{\n                              "distinct_entities":5,\n                              "entity_clients":5,\n                              "non_entity_tokens":0,\n                              "non_entity_clients":0,\n                              "clients":5\n                           }\n                        }\n                     ]\n                  }\n               ]\n            }\n         },\n         {\n            "timestamp":"2021-04-01T00:00:00Z",\n            "counts":{\n               "distinct_entities":5,\n               "entity_clients":5,\n               "non_entity_tokens":5,\n               "non_entity_clients":5,\n               "clients":10\n            },\n            "namespaces":[\n               {\n                  "namespace_id":"root",\n                  "namespace_path":"",\n                  "counts":{\n                     "distinct_entities":5,\n                     "entity_clients":5,\n                     "non_entity_tokens":5,\n                     "non_entity_clients":5,\n                     "clients":10\n                  },\n                  "mounts":[\n                     {\n                        "path":"auth/up1/",\n                        "counts":{\n                           "distinct_entities":0,\n                           "entity_clients":0,\n                           "non_entity_tokens":5,\n                           "non_entity_clients":5,\n                           "clients":5\n                        }\n                     },\n                     {\n                        "path":"auth/up2/",\n                        "counts":{\n                           "distinct_entities":5,\n                           "entity_clients":5,\n                           "non_entity_tokens":0,\n                           "non_entity_clients":0,\n                           "clients":5\n                        }\n                     }\n                  ]\n               }\n            ],\n            "new_clients":{\n               "counts":{\n                  "distinct_entities":5,\n                  "entity_clients":5,\n                  "non_entity_tokens":5,\n                  "non_entity_clients":5,\n                  "clients":10\n               },\n               "namespaces":[\n                  {\n                     "namespace_id":"root",\n                     "namespace_path":"",\n                     "counts":{\n                        "distinct_entities":5,\n                        "entity_clients":5,\n                        "non_entity_tokens":5,\n                        "non_entity_clients":5,\n                        "clients":10\n                     },\n                     "mounts":[\n                        {\n                           "path":"auth/up1/",\n                           "counts":{\n                              "distinct_entities":0,\n                              "entity_clients":0,\n                              "non_entity_tokens":5,\n                              "non_entity_clients":5,\n                              "clients":5\n                           }\n                        },\n                        {\n                           "path":"auth/up2/",\n                           "counts":{\n                              "distinct_entities":5,\n                              "entity_clients":5,\n                              "non_entity_tokens":0,\n                              "non_entity_clients":0,\n                              "clients":5\n                           }\n                        }\n                     ]\n                  }\n               ]\n            }\n         }\n      ],\n      "start_time":"2021-01-01T00:00:00Z",\n      "total":{\n         "distinct_entities":20,\n         "entity_clients":20,\n         "non_entity_tokens":20,\n         "non_entity_clients":20,\n         "clients":40\n      }\n   },\n   "wrap_info":null,\n   "warnings":null,\n   "auth":null\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"sample-request-for-a-single-month",children:"Sample request for a single month"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell-session",children:'$ curl \\\n    --header "X-Vault-Token: ..." \\\n    --request GET \\\n    http://127.0.0.1:8200/v1/sys/internal/counters/activity?end_time=2020-06-30T00%3A00%3A00Z&start_time=2020-06-01T00%3A00%3A00Z\n'})}),"\n",(0,i.jsx)(e.h3,{id:"sample-request-to-get-client-counts-for-top-2-namespaces-with-highest-activity-for-a-usage-period",children:"Sample request to get client counts for top 2 namespaces with highest activity for a usage period"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell-session",children:'$ curl \\\n    --header "X-Vault-Token: ..." \\\n    --request GET \\\n    http://127.0.0.1:8200/v1/sys/internal/counters/activity?end_time=2020-06-30T00%3A00%3A00Z&start_time=2020-06-01T00%3A00%3A00Z&limit_namespaces=2\n'})}),"\n",(0,i.jsx)(e.h2,{id:"partial-month-client-count",children:"Partial month client count"}),"\n",(0,i.jsx)(e.p,{children:"This endpoint returns the client activity in the current month. The response\nwill have activity attributions per namespace, per mount within each namespaces,\nand new clients information."}),"\n",(0,i.jsx)(e.p,{children:"The time period is from the start of the current month, up until the time that\nthis request was made."}),"\n",(0,i.jsx)(e.p,{children:"Note: the client count may be inaccurate in the moments following an OpenBao\nreboot, or leadership change. The estimate will stabilize when background\nloading of client data has completed."}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Method"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,i.jsx)(e.tbody,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"GET"})}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"/sys/internal/counters/activity/monthly"})})]})})]}),"\n",(0,i.jsx)(e.h3,{id:"sample-request-3",children:"Sample request"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell-session",children:'$ curl \\\n    --header "X-Vault-Token: ..." \\\n    --request GET \\\n    http://127.0.0.1:8200/v1/sys/internal/counters/activity/monthly\n'})}),"\n",(0,i.jsx)(e.h3,{id:"sample-response-3",children:"Sample response"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "request_id": "d0d37f90-96ec-28c7-b59c-b53612cbbcad",\n  "lease_id": "",\n  "lease_duration": 0,\n  "renewable": false,\n  "data": {\n    "by_namespace": [\n      {\n        "counts": {\n          "clients": 1,\n          "distinct_entities": 0,\n          "entity_clients": 0,\n          "non_entity_clients": 1,\n          "non_entity_tokens": 1\n        },\n        "mounts": [\n          {\n            "counts": {\n              "clients": 1,\n              "distinct_entities": 0,\n              "entity_clients": 0,\n              "non_entity_clients": 1,\n              "non_entity_tokens": 0\n            },\n            "mount_path": "auth_token_0747d59c"\n          }\n        ],\n        "namespace_id": "root",\n        "namespace_path": ""\n      }\n    ],\n    "clients": 1,\n    "distinct_entities": 0,\n    "entity_clients": 0,\n    "months": [\n      {\n        "counts": {\n          "clients": 1,\n          "distinct_entities": 0,\n          "entity_clients": 0,\n          "non_entity_clients": 1,\n          "non_entity_tokens": 0\n        },\n        "namespaces": [\n          {\n            "counts": {\n              "clients": 1,\n              "distinct_entities": 0,\n              "entity_clients": 0,\n              "non_entity_clients": 1,\n              "non_entity_tokens": 0\n            },\n            "mounts": [\n              {\n                "counts": {\n                  "clients": 1,\n                  "distinct_entities": 0,\n                  "entity_clients": 0,\n                  "non_entity_clients": 1,\n                  "non_entity_tokens": 0\n                },\n                "mount_path": "auth_token_0747d59c"\n              }\n            ],\n            "namespace_id": "root",\n            "namespace_path": ""\n          }\n        ],\n        "new_clients": {\n          "counts": {\n            "clients": 1,\n            "distinct_entities": 0,\n            "entity_clients": 0,\n            "non_entity_clients": 1,\n            "non_entity_tokens": 0\n          },\n          "namespaces": [\n            {\n              "counts": {\n                "clients": 1,\n                "distinct_entities": 0,\n                "entity_clients": 0,\n                "non_entity_clients": 1,\n                "non_entity_tokens": 0\n              },\n              "mounts": [\n                {\n                  "counts": {\n                    "clients": 1,\n                    "distinct_entities": 0,\n                    "entity_clients": 0,\n                    "non_entity_clients": 1,\n                    "non_entity_tokens": 0\n                  },\n                  "mount_path": "auth_token_0747d59c"\n                }\n              ],\n              "namespace_id": "root",\n              "namespace_path": ""\n            }\n          ]\n        },\n        "timestamp": "2022-04-01T04:00:00Z"\n      }\n    ],\n    "non_entity_clients": 1,\n    "non_entity_tokens": 1\n  },\n  "warnings": null\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"update-the-client-count-configuration",children:"Update the client count configuration"}),"\n",(0,i.jsxs)(e.p,{children:["The ",(0,i.jsx)(e.code,{children:"/sys/internal/counters/config"})," endpoint is used to configure logging of active clients."]}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Method"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,i.jsx)(e.tbody,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"POST"})}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"/sys/internal/counters/config"})})]})})]}),"\n",(0,i.jsx)(e.h3,{id:"parameters-1",children:"Parameters"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"default_report_months"})," ",(0,i.jsx)(e.code,{children:"(integer: 12)"})," - The number of months to report if no ",(0,i.jsx)(e.code,{children:"start_time"})," is specified in a query."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"enabled"})," ",(0,i.jsx)(e.code,{children:"(string: enable, disable, default)"})," - Enable or disable counting of client activity. When set to ",(0,i.jsx)(e.code,{children:"default"}),", the client\ncounts are disabled. Disabling the feature during the middle of a month will discard any data recorded for that month,\nbut does not delete previous months."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"retention_months"})," ",(0,i.jsx)(e.code,{children:"(integer: 24)"})," - The number of months of history to retain."]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"Any missing parameters are left at their existing value."}),"\n",(0,i.jsx)(e.h3,{id:"sample-payload",children:"Sample payload"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "enabled": "enable",\n  "default_report_months": 3,\n  "retention_months": 12\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"sample-request-4",children:"Sample request"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell-session",children:'$ curl \\\n    --request POST\n    --header "X-Vault-Token: ..." \\\n    --data @payload.json\n    http://127.0.0.1:8200/v1/sys/internal/counters/config\n'})}),"\n",(0,i.jsx)(e.h2,{id:"read-the-client-count-configuration",children:"Read the client count configuration"}),"\n",(0,i.jsx)(e.p,{children:"Reading the configuration shows the current settings, as well as a flag as to whether any data can be queried."}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Method"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,i.jsx)(e.tbody,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"GET"})}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"/sys/internal/counters/config"})})]})})]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"enabled"})," ",(0,i.jsx)(e.code,{children:"(string)"})," - returns ",(0,i.jsx)(e.code,{children:"default-enabled"})," or ",(0,i.jsx)(e.code,{children:"default-disabled"})," if the configuration is ",(0,i.jsx)(e.code,{children:"default"}),"."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"queries_available"})," ",(0,i.jsx)(e.code,{children:"(bool)"})," - indicates whether any usage report is available. This will initially be\nfalse until the end of the first calendar month after the feature is enabled."]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"sample-request-5",children:"Sample request"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell-session",children:'$ curl \\\n    --request GET\n    --header "X-Vault-Token: ..." \\\n    http://127.0.0.1:8200/v1/sys/internal/counters/config\n'})}),"\n",(0,i.jsx)(e.h3,{id:"sample-response-4",children:"Sample response"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "request_id": "25a94b99-b49a-c4ac-cb7b-5ba0eb390a25",\n  "lease_id": "",\n  "lease_duration": 0,\n  "renewable": false,\n  "data": {\n    "default_report_months": 12,\n    "enabled": "default-enabled",\n    "queries_available": true,\n    "retention_months": 24,\n    "reporting_enabled": false,\n    "billing_start_timestamp": "2022-03-01T00:00:00Z",\n  },\n  "warnings": null\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"activity-export",children:"Activity export"}),"\n",(0,i.jsx)(e.p,{children:"This endpoint returns an export of the clients that had activity within the\nprovided start and end times. The returned set of client information will be\ndeduplicated over the time window and will show the earliest activity logged for\neach client. The output will be ordered chronologically by month of activity."}),"\n",(0,i.jsxs)(e.p,{children:["~> ",(0,i.jsx)(e.strong,{children:"NOTE"}),": This endpoint is currently in tech preview status."]}),"\n",(0,i.jsx)(e.p,{children:"There are a few things to keep in mind while using this API."}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"The response includes the actual time period covered, which may not exactly\nmatch the query parameters due to the month granularity of data or missing\nmonths in the requested time range."}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["If the ",(0,i.jsx)(e.code,{children:"end_date"})," supplied to the API is for the current month, the activity\ninformation returned by this API will include activity for this month, however\nit may be up to 20 minutes delayed."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Method"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,i.jsx)(e.tbody,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"GET"})}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.code,{children:"/sys/internal/counters/activity/export"})})]})})]}),"\n",(0,i.jsx)(e.h3,{id:"parameters-2",children:"Parameters"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"start_time"})," ",(0,i.jsx)(e.code,{children:"(string, optional)"})," - An RFC3339 timestamp or Unix epoch time. Specifies the start of the\nperiod for which client counts will be reported. If no start time is specified, the ",(0,i.jsx)(e.code,{children:"default_report_months"}),"\nprior to the ",(0,i.jsx)(e.code,{children:"end_time"})," will be used."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"end_time"})," ",(0,i.jsx)(e.code,{children:"(string, optional)"})," - An RFC3339 timestamp or Unix epoch time. Specifies the end of the period\nfor which client counts will be reported. If no end time is specified, the end of the previous calendar\nmonth will be used."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"format"})," ",(0,i.jsx)(e.code,{children:"(string, optional)"})," - The desired format of the output file. Allowed\nvalues are ",(0,i.jsx)(e.code,{children:"csv"})," and ",(0,i.jsx)(e.code,{children:"json"}),". If no format is provided a default of ",(0,i.jsx)(e.code,{children:"json"}),"\nwill be used."]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"sample-request-6",children:"Sample request"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell-session",children:'$ curl \\\n    --header "X-Vault-Token: ..." \\\n    --request GET \\\n    http://127.0.0.1:8200/v1/sys/internal/counters/activity/export\n'})}),"\n",(0,i.jsx)(e.h3,{id:"sample-response-5",children:"Sample response"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{"client_id":"3f210722-7210-98e8-1f0d-e6a39ffb29c6","namespace_id":"root","timestamp":1653350457,"mount_accessor":"auth_userpass_bb52979d"}\n{"client_id":"X/Yed4Oj4cqODj9tSHjKwnRy5QVSBRlX3COxjjWSXyI=","namespace_id":"root","timestamp":1653350491,"non_entity":true,"mount_accessor":"auth_token_f6f2c11c"}\n{"client_id":"d93405dc-b592-b1c3-a520-14e618d359c1","namespace_id":"root","timestamp":1653350501,"mount_accessor":"auth_userpass_bb52979d"}\n'})})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>a,x:()=>c});var i=t(96540);const s={},l=i.createContext(s);function a(n){const e=i.useContext(l);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:a(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);