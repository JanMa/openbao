"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5705],{14411:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var t=s(74848),a=s(28453);const i={sidebar_label:"Windows service",description:"OpenBao Agent can be run as a Windows service."},o="OpenBao agent windows service",r={id:"agent-and-proxy/agent/winsvc",title:"OpenBao agent windows service",description:"OpenBao Agent can be run as a Windows service.",source:"@site/content/docs/agent-and-proxy/agent/winsvc.mdx",sourceDirName:"agent-and-proxy/agent",slug:"/agent-and-proxy/agent/winsvc",permalink:"/openbao/docs/agent-and-proxy/agent/winsvc",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/agent-and-proxy/agent/winsvc.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"Windows service",description:"OpenBao Agent can be run as a Windows service."},sidebar:"docs",previous:{title:"Templates",permalink:"/openbao/docs/agent-and-proxy/agent/template"},next:{title:"Version compatibility",permalink:"/openbao/docs/agent-and-proxy/agent/versions"}},c={},d=[{value:"Register OpenBao agent as a windows service",id:"register-openbao-agent-as-a-windows-service",level:2},{value:"Using sc.exe",id:"using-scexe",level:3},{value:"Using New-Service",id:"using-new-service",level:3},{value:"Start the OpenBao agent service",id:"start-the-openbao-agent-service",level:2},{value:"Example starting OpenBao agent using <code>sc.exe</code>",id:"example-starting-openbao-agent-using-scexe",level:3},{value:"Example starting OpenBao agent using <code>Start-Service</code>",id:"example-starting-openbao-agent-using-start-service",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"openbao-agent-windows-service",children:"OpenBao agent windows service"}),"\n",(0,t.jsx)(n.p,{children:"OpenBao Agent can be run as a Windows service. In order to do this, you need to register OpenBao Agent with the Windows\nService Control Manager. After OpenBao Agent is registered, it can be started like any other Windows\nservice."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note:"})," These commands should be run in a PowerShell session with Administrator capabilities."]}),"\n",(0,t.jsx)(n.h2,{id:"register-openbao-agent-as-a-windows-service",children:"Register OpenBao agent as a windows service"}),"\n",(0,t.jsxs)(n.p,{children:["There are multiple ways to register OpenBao Agent as a Windows service. One way is to use\n",(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/sc-create",children:(0,t.jsx)(n.code,{children:"sc.exe"})}),". ",(0,t.jsx)(n.code,{children:"sc.exe"})," works\nbest if the path to your OpenBao binary and its associated agent config file do not contain spaces. ",(0,t.jsx)(n.code,{children:"sc.exe"})," can be\npretty tricky to get working correctly if your path contains spaces, as paths containing spaces must be quoted,\nand escaping quotes correctly in a way that makes ",(0,t.jsx)(n.code,{children:"sc.exe"})," happy is non-trivial. If your path contains spaces, or you prefer not to use ",(0,t.jsx)(n.code,{children:"sc.exe"}),", another\nalternative is to use the\n",(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/new-service?view=powershell-5.1",children:(0,t.jsx)(n.code,{children:"New-Service"})}),"\ncmdlet. ",(0,t.jsx)(n.code,{children:"New-Service"})," is less picky about the method used to escape quotes, and can sometimes be easier. Examples of\nboth will be shown below."]}),"\n",(0,t.jsx)(n.h3,{id:"using-scexe",children:"Using sc.exe"}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Important Note:"})," Ensure the executable path of the service is quoted, especially when it contains spaces, to avoid\npotential privilege escalation risks."]})}),"\n",(0,t.jsxs)(n.p,{children:["If you use ",(0,t.jsx)(n.code,{children:"sc.exe"}),", make sure you specify ",(0,t.jsx)(n.code,{children:"sc.exe"})," explicitly, and not just ",(0,t.jsx)(n.code,{children:"sc"}),'. The command below shows the creation\nof OpenBao Agent as a service, using "OpenBao Agent" as the display name, and starting automatically when Windows starts.\nThe ',(0,t.jsx)(n.code,{children:"binPath"})," argument should include the fully qualified path to the OpenBao executable, as well as any arguments required."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell-session",children:'PS C:\\Windows\\system32> sc.exe create OpenBaoAgent binPath="C:\\openbao\\bao.exe agent -config=C:\\openbao\\agent-config.hcl" displayName="OpenBao Agent" start=auto\n[SC] CreateService SUCCESS\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note that the spacing after the ",(0,t.jsx)(n.code,{children:"="})," in all of the arguments is intentional and required."]}),"\n",(0,t.jsx)(n.p,{children:"If you receive a success message, your service is registered with the service manager."}),"\n",(0,t.jsxs)(n.p,{children:["If you get an error, please verify the path to the binary and check the arguments, by running the contents of\n",(0,t.jsx)(n.code,{children:"binPath="})," directly in a PowerShell session and observing the results."]}),"\n",(0,t.jsx)(n.h3,{id:"using-new-service",children:"Using New-Service"}),"\n",(0,t.jsxs)(n.p,{children:["The syntax is slightly different for ",(0,t.jsx)(n.code,{children:"New-Service"}),", but the gist is the same. The invocation below is equivalent to the\n",(0,t.jsx)(n.code,{children:"sc.exe"})," one above."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell-session",children:'PS C:\\Windows\\system32> New-Service -Name "OpenBaoAgent" -BinaryPathName "C:\\openbao\\bao.exe agent -config=C:\\openbao\\agent-config.hcl" -DisplayName "OpenBao Agent" -StartupType "Automatic"\n\nStatus   Name               DisplayName\n------   ----               -----------\nStopped  OpenBaoAgent         OpenBao Agent\n'})}),"\n",(0,t.jsxs)(n.p,{children:["As mentioned previously, ",(0,t.jsx)(n.code,{children:"New-Service"})," is easier to use if the path to your OpenBao executable and/or agent config contains spaces.\nBelow is an example of how to configure OpenBao Agent as a service using a path with spaces."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell-session",children:'PS C:\\Windows\\system32> New-Service -Name "OpenBaoAgent" -BinaryPathName \'"C:\\my dir\\bao.exe" agent -config="C:\\my dir\\agent-config.hcl"\' -DisplayName "OpenBao Agent" -StartupType "Automatic"\n\nStatus   Name               DisplayName\n------   ----               -----------\nStopped  OpenBaoAgent         OpenBao Agent\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note that only the paths themselves are double quoted, and the entire ",(0,t.jsx)(n.code,{children:"BinaryPathName"})," is wrapped in single quotes, in order\nto escape the double quotes used for the paths."]}),"\n",(0,t.jsxs)(n.p,{children:["If anything goes wrong during this process, and you need to manually edit the path later, use the Registry Editor to find\nthe following key: ",(0,t.jsx)(n.code,{children:"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\OpenBaoAgent"}),". You can edit the ",(0,t.jsx)(n.code,{children:"ImagePath"})," value\nat that key to the correct path."]}),"\n",(0,t.jsx)(n.h2,{id:"start-the-openbao-agent-service",children:"Start the OpenBao agent service"}),"\n",(0,t.jsx)(n.p,{children:"There are multiple ways to start the service."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Using the ",(0,t.jsx)(n.code,{children:"sc.exe"})," command."]}),"\n",(0,t.jsxs)(n.li,{children:["Using the ",(0,t.jsx)(n.code,{children:"Start-Service"})," cmdlet."]}),"\n",(0,t.jsxs)(n.li,{children:["Go to the Windows Service Manager, and look for ",(0,t.jsx)(n.strong,{children:"OpenBaoAgent"})," in the service name column. Click the\n",(0,t.jsx)(n.code,{children:"Start"})," button to start the service."]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"example-starting-openbao-agent-using-scexe",children:["Example starting OpenBao agent using ",(0,t.jsx)(n.code,{children:"sc.exe"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell-session",children:"PS C:\\Windows\\system32> sc.exe start OpenBaoAgent\n\nSERVICE_NAME: OpenBaoAgent\n     TYPE               : 10  WIN32_OWN_PROCESS\n     STATE              : 4  RUNNING\n                             (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN)\n     WIN32_EXIT_CODE    : 0  (0x0)\n     SERVICE_EXIT_CODE  : 0  (0x0)\n     CHECKPOINT         : 0x0\n     WAIT_HINT          : 0x0\n     PID                : 6548\n     FLAGS              :\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"example-starting-openbao-agent-using-start-service",children:["Example starting OpenBao agent using ",(0,t.jsx)(n.code,{children:"Start-Service"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell-session",children:'PS C:\\Windows\\system32> Start-Service -Name "OpenBaoAgent"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note that in the case where the service was started successfully, ",(0,t.jsx)(n.code,{children:"New-Service"})," does not return any output."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>r});var t=s(96540);const a={},i=t.createContext(a);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);