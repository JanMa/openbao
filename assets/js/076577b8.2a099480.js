"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6747],{43165:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var i=t(74848),s=t(28453);const r={sidebar_label:"Templates",description:"OpenBao Agent's Template functionality allows OpenBao secrets to be rendered to files using Consul Template markup."},a="OpenBao agent templates",o={id:"agent-and-proxy/agent/template",title:"OpenBao agent templates",description:"OpenBao Agent's Template functionality allows OpenBao secrets to be rendered to files using Consul Template markup.",source:"@site/content/docs/agent-and-proxy/agent/template.mdx",sourceDirName:"agent-and-proxy/agent",slug:"/agent-and-proxy/agent/template",permalink:"/docs/agent-and-proxy/agent/template",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/agent-and-proxy/agent/template.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"Templates",description:"OpenBao Agent's Template functionality allows OpenBao secrets to be rendered to files using Consul Template markup."},sidebar:"docs",previous:{title:"Process Supervisor Mode",permalink:"/docs/agent-and-proxy/agent/process-supervisor"},next:{title:"Windows service",permalink:"/docs/agent-and-proxy/agent/winsvc"}},l={},c=[{value:"Functionality",id:"functionality",level:2},{value:"Templating language",id:"templating-language",level:2},{value:"Template language example",id:"template-language-example",level:3},{value:"Global configurations",id:"global-configurations",level:2},{value:"<code>template_config</code> stanza example",id:"template_config-stanza-example",level:3},{value:"Interaction between <code>exit_on_retry_failure</code> and <code>error_on_missing_key</code>",id:"interaction-between-exit_on_retry_failure-and-error_on_missing_key",level:3},{value:"Template configurations",id:"template-configurations",level:2},{value:"Example <code>template</code> stanza",id:"example-template-stanza",level:3},{value:"Renewals and updating secrets",id:"renewals-and-updating-secrets",level:2},{value:"Renewable secrets",id:"renewable-secrets",level:3},{value:"Non-Renewable secrets",id:"non-renewable-secrets",level:3},{value:"Non-Renewable leased secrets",id:"non-renewable-leased-secrets",level:3},{value:"Static roles",id:"static-roles",level:3},{value:"Certificates",id:"certificates",level:3},{value:"Rendering using the <code>pkiCert</code> template function",id:"rendering-using-the-pkicert-template-function",level:4},{value:"Rendering using the <code>secret</code> template function",id:"rendering-using-the-secret-template-function",level:4},{value:"Templating configuration example",id:"templating-configuration-example",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"openbao-agent-templates",children:"OpenBao agent templates"}),"\n",(0,i.jsxs)(n.p,{children:["OpenBao Agent's Template functionality allows OpenBao secrets to be rendered to files\nor environment variables (via the ",(0,i.jsx)(n.a,{href:"/docs/agent-and-proxy/agent/process-supervisor",children:"Process Supervisor Mode"}),")\nusing ",(0,i.jsx)(n.a,{href:"https://github.com/hashicorp/consul-template/blob/v0.28.1/docs/templating-language.md",children:"Consul Template markup"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"functionality",children:"Functionality"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"template_config"})," stanza configures overall default behavior for the\ntemplating engine. Note that ",(0,i.jsx)(n.code,{children:"template_config"})," can only be defined once, and is\ndifferent from the ",(0,i.jsx)(n.code,{children:"template"})," stanza. Unlike ",(0,i.jsx)(n.code,{children:"template"})," which focuses on where\nand how a specific secret is rendered, ",(0,i.jsx)(n.code,{children:"template_config"})," contains parameters\naffecting how the templating engine as a whole behaves and its interaction with\nthe rest of Agent. This includes, but is not limited to, program exit behavior.\nOther parameters that apply to the templating engine as a whole may be added\nover time."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"template"})," stanza configures the OpenBao agent for rendering secrets to files\nusing Consul Template markup language. Multiple ",(0,i.jsx)(n.code,{children:"template"})," stanzas can be\ndefined to render multiple files."]}),"\n",(0,i.jsx)(n.p,{children:"When the agent is started with templating enabled, it will attempt to acquire a\nOpenBao token using the configured auto-auth Method. On failure, it will back off\nfor a short while (including some randomness to help prevent thundering herd\nscenarios) and retry. On success, secrets defined in the templates will be\nretrieved from OpenBao and rendered locally."}),"\n",(0,i.jsx)(n.h2,{id:"templating-language",children:"Templating language"}),"\n",(0,i.jsxs)(n.p,{children:["The template output content can be provided directly as part of the ",(0,i.jsx)(n.code,{children:"contents"}),"\noption in a ",(0,i.jsx)(n.code,{children:"template"})," stanza or as a separate ",(0,i.jsx)(n.code,{children:".ctmpl"})," file and specified in\nthe ",(0,i.jsx)(n.code,{children:"source"})," option of a ",(0,i.jsx)(n.code,{children:"template"})," stanza."]}),"\n",(0,i.jsxs)(n.p,{children:["In order to fetch secrets from OpenBao, whether those are static secrets, dynamic\ncredentials, or certificates, OpenBao Agent templates require the use of the\n",(0,i.jsx)(n.code,{children:"secret"}),"\n",(0,i.jsx)(n.a,{href:"https://github.com/hashicorp/consul-template/blob/master/docs/templating-language.md#secret",children:"function"}),"\nor ",(0,i.jsx)(n.code,{children:"pkiCert"}),"\n",(0,i.jsx)(n.a,{href:"https://github.com/hashicorp/consul-template/blob/main/docs/templating-language.md#pkicert",children:"function"}),"\nfrom Consul Template."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"secret"})," function works for all types of secrets and depending on the type\nof secret that's being rendered by this function, template will have different\nrenewal behavior as detailed in the ",(0,i.jsx)(n.a,{href:"#renewals-and-updating-secrets",children:"Renewals\nsection"}),". The ",(0,i.jsx)(n.code,{children:"pkiCert"})," function is intended to\nwork specifically for certificates issued by the ",(0,i.jsx)(n.a,{href:"/docs/secrets/pki",children:"PKI Secrets\nEngine"}),". Refer to the ",(0,i.jsx)(n.a,{href:"#certificates",children:"Certificates"})," section\nfor differences in certificate renewal behavior between ",(0,i.jsx)(n.code,{children:"secret"})," and ",(0,i.jsx)(n.code,{children:"pkiCert"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The following links contain additional resources for the templating language used by OpenBao Agent templating."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/hashicorp/consul-template/blob/v0.28.1/docs/templating-language.md",children:"Consul Templating Documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://pkg.go.dev/text/template#pkg-overview",children:"Go Templating Language Documentation"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"template-language-example",children:"Template language example"}),"\n",(0,i.jsx)(n.p,{children:"The following is an example of a template that retrieves a generic secret from OpenBao's\nKV store:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'{{ with secret "secret/my-secret" }}\n{{ .Data.data.foo }}\n{{ end }}\n'})}),"\n",(0,i.jsx)(n.p,{children:"The following is an example of a template that issues a PKI certificate in\nOpenBao's PKI secrets engine. The fetching of the certificate or key from a PKI role\nthrough this function will be based on the certificate's expiration."}),"\n",(0,i.jsx)(n.p,{children:"To generate a new certificate and create a bundle with the key, certificate, and CA, use:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'{{ with pkiCert "pki/issue/my-domain-dot-com" "common_name=foo.example.com" }}\n{{ .Data.Key }}\n{{ .Data.Cert }}\n{{ .Data.CA }}\n{{ end }}\n'})}),"\n",(0,i.jsx)(n.p,{children:"To fetch only the issuing CA for this mount, use:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'{{- with secret "pki/cert/ca" -}}\n{{ .Data.certificate }}\n{{- end -}}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Alternatively, ",(0,i.jsx)(n.code,{children:"pki/cert/ca_chain"})," can be used to fetch the full CA chain."]}),"\n",(0,i.jsx)(n.h2,{id:"global-configurations",children:"Global configurations"}),"\n",(0,i.jsxs)(n.p,{children:["The top level ",(0,i.jsx)(n.code,{children:"template_config"})," block has the following configuration entries that affect\nall templates:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"exit_on_retry_failure"})," ",(0,i.jsx)(n.code,{children:"(bool: false)"})," - This option configures OpenBao Agent\nto exit after it has exhausted its number of template retry attempts due to\nfailures."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"static_secret_render_interval"})," ",(0,i.jsx)(n.code,{children:"(string or integer: 5m)"})," - If specified, configures\nhow often OpenBao Agent Template should render non-leased secrets such as KV v2.\nThis setting will not change how often OpenBao Agent Templating renders leased\nsecrets. Uses ",(0,i.jsx)(n.a,{href:"/docs/concepts/duration-format",children:"duration format strings"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"template_config-stanza-example",children:[(0,i.jsx)(n.code,{children:"template_config"})," stanza example"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-hcl",children:'template_config {\n  exit_on_retry_failure = true\n  static_secret_render_interval = "10m"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In another example ",(0,i.jsx)(n.code,{children:"template_config"})," with ",(0,i.jsxs)(n.a,{href:"/docs/agent-and-proxy/agent/template#error_on_missing_key",children:[(0,i.jsx)(n.code,{children:"error_on_missing_key"})," parameter in the template stanza"]}),"\nas well as ",(0,i.jsx)(n.code,{children:"exit_on_retry_failure"})," result in the agent exiting in case of no key\n/ value issues instead of the default retry behavior."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-hcl",children:'template_config {\n  exit_on_retry_failure = true\n  static_secret_render_interval = "10m"\n}\n\ntemplate {\n  source      = "/tmp/agent/template.ctmpl"\n  destination = "/tmp/agent/render.txt"\n  error_on_missing_key = true\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"interaction-between-exit_on_retry_failure-and-error_on_missing_key",children:["Interaction between ",(0,i.jsx)(n.code,{children:"exit_on_retry_failure"})," and ",(0,i.jsx)(n.code,{children:"error_on_missing_key"})]}),"\n",(0,i.jsxs)(n.p,{children:["The parameter\n",(0,i.jsx)(n.a,{href:"/docs/agent-and-proxy/agent/template#error_on_missing_key",children:(0,i.jsx)(n.code,{children:"error_on_missing_key"})})," can be\nspecified within the ",(0,i.jsx)(n.code,{children:"template"})," stanza which determines if a template should\nerror when a key is missing in the secret. When ",(0,i.jsx)(n.code,{children:"error_on_missing_key"})," is not\nspecified or set to ",(0,i.jsx)(n.code,{children:"false"})," and the key to render is not in the secret's\nresponse, the templating engine will ignore it (or render ",(0,i.jsx)(n.code,{children:'"<no value>"'}),") and\ncontinue on with its rendering."]}),"\n",(0,i.jsxs)(n.p,{children:["If the desire is to have Agent fail and exit on a missing key, both\n",(0,i.jsx)(n.code,{children:"template.error_on_missing_key"})," and ",(0,i.jsx)(n.code,{children:"template_config.exit_on_retry_failure"})," must\nbe set to true. Otherwise, the templating engine will error and render to its\ndestination, but agent will not exit and will retry until the key exists or until\nthe process is terminated."]}),"\n",(0,i.jsxs)(n.p,{children:["Note that a missing key from a secret's response is different from a missing or\nnon-existent secret. The templating engine will always error if a secret is\nmissing, but will only error for a missing key if ",(0,i.jsx)(n.code,{children:"error_on_missing_key"})," is set.\nWhether OpenBao Agent will exit when the templating engine errors depends on the\nvalue of ",(0,i.jsx)(n.code,{children:"exit_on_retry_failure"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"template-configurations",children:"Template configurations"}),"\n",(0,i.jsxs)(n.p,{children:["The top level ",(0,i.jsx)(n.code,{children:"template"})," block has multiple configuration entries. The\nparameters found in the template configuration section in the consul-template\n",(0,i.jsx)(n.a,{href:"https://github.com/hashicorp/consul-template/blob/main/docs/configuration.md#templates",children:"documentation\npage"}),"\ncan be used here:"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["The parameters marked with ",(0,i.jsx)(n.code,{children:"\u0394"})," below are only applicable to file templates and\ncannot be used with ",(0,i.jsx)(n.code,{children:"env_template"})," entries in process supervisor mode."]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"source"})," ",(0,i.jsx)(n.code,{children:'(string: "")'})," - Path on disk to use as the input template. This\noption is required if not using the ",(0,i.jsx)(n.code,{children:"contents"})," option."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"destination"}),"\u0394 ",(0,i.jsx)(n.code,{children:"(string: required)"})," - Path on disk where the rendered secrets should\nbe created. If the parent directories do not exist, OpenBao\nAgent will attempt to create them, unless ",(0,i.jsx)(n.code,{children:"create_dest_dirs"})," is false."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"create_dest_dirs"}),"\u0394 ",(0,i.jsx)(n.code,{children:"(bool: true)"})," - This option tells OpenBao Agent to create\nthe parent directories of the destination path if they do not exist."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"contents"})," ",(0,i.jsx)(n.code,{children:'(string: "")'})," - This option allows embedding the contents of\na template in the configuration file rather then supplying the ",(0,i.jsx)(n.code,{children:"source"})," path to\nthe template file. This is useful for short templates. This option is mutually\nexclusive with the ",(0,i.jsx)(n.code,{children:"source"})," option."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"command"}),"\u0394 ",(0,i.jsx)(n.code,{children:'(string: "")'})," - This is the optional command to run when the\ntemplate is rendered. The command will only run if the resulting template changes.\nThe command must return within 30s (configurable), and it must have a successful\nexit code. OpenBao Agent is not a replacement for a process monitor or init system.\nThis is deprecated in favor of the ",(0,i.jsx)(n.code,{children:"exec"})," option."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"command_timeout"}),"\u0394 ",(0,i.jsx)(n.code,{children:"(duration: 30s)"})," - This is the maximum amount of time to\nwait for the optional command to return. This is deprecated in favor of the\n",(0,i.jsx)(n.code,{children:"exec"})," option."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"error_on_missing_key"})," ",(0,i.jsx)(n.code,{children:"(bool: false)"})," - Exit with an error when accessing\na struct or map field/key that does notexist. The default behavior will print ",(0,i.jsx)(n.code,{children:"<no value>"}),'\nwhen accessing a field that does not exist. It is highly recommended you set this\nto "true". Also see ',(0,i.jsxs)(n.a,{href:"/docs/agent-and-proxy/agent/template#interaction-between-exit_on_retry_failure-and-error_on_missing_key",children:[(0,i.jsx)(n.code,{children:"exit_on_retry_failure"})," in global OpenBao Agent Template Config"]}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"exec"}),"\u0394 ",(0,i.jsx)(n.code,{children:"(object: optional)"})," - The exec block executes a command when the\ntemplate is rendered and the output has changed. The block parameters are\n",(0,i.jsx)(n.code,{children:"command"})," ",(0,i.jsx)(n.code,{children:"(string or array: required)"})," and ",(0,i.jsx)(n.code,{children:"timeout"})," ",(0,i.jsx)(n.code,{children:"(string: optional, defaults to 30s)"}),". ",(0,i.jsx)(n.code,{children:"command"})," can be given as a string or array of strings to execute, such as\n",(0,i.jsx)(n.code,{children:'"touch myfile"'})," or ",(0,i.jsx)(n.code,{children:'["touch", "myfile"]'}),". To protect against command injection, we\nstrongly recommend using an array of strings, and we attempt to parse that way first.\nNote also that using a comma with the string approach will cause it to be interpreted as an\narray, which may not be desirable."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"perms"}),"\u0394 ",(0,i.jsx)(n.code,{children:'(string: "")'})," - This is the permission to render the file. If\nthis option is left unspecified, OpenBao Agent will attempt to match the permissions\nof the file that already exists at the destination path. If no file exists at that\npath, the permissions are 0644."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"backup"}),"\u0394 ",(0,i.jsx)(n.code,{children:"(bool: true)"})," - This option backs up the previously rendered template\nat the destination path before writing a new one. It keeps exactly one backup.\nThis option is useful for preventing accidental changes to the data without having\na rollback strategy."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"left_delimiter"})," ",(0,i.jsx)(n.code,{children:'(string: "\\{\\{")'}),' - Delimiter to use in the template. The\ndefault is "{{" but for some templates, it may be easier to use a different\ndelimiter that does not conflict with the output file itself.']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"right_delimiter"})," ",(0,i.jsx)(n.code,{children:'(string: "}}")'}),' - Delimiter to use in the template. The\ndefault is "}}" but for some templates, it may be easier to use a different\ndelimiter that does not conflict with the output file itself.']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sandbox_path"}),"\u0394 ",(0,i.jsx)(n.code,{children:'(string: "")'})," - If a sandbox path is provided, any path\nprovided to the ",(0,i.jsx)(n.code,{children:"file"})," function is checked that it falls within the sandbox path.\nRelative paths that try to traverse outside the sandbox path will exit with an error."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"wait"}),"\u0394 ",(0,i.jsx)(n.code,{children:"(object: required)"})," - This is the ",(0,i.jsx)(n.code,{children:"minimum(:maximum)"})," to wait before rendering\na new template to disk and triggering a command, separated by a colon (",(0,i.jsx)(n.code,{children:":"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"example-template-stanza",children:["Example ",(0,i.jsx)(n.code,{children:"template"})," stanza"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-hcl",children:'template {\n  source      = "/tmp/agent/template.ctmpl"\n  destination = "/tmp/agent/render.txt"\n  error_on_missing_key = true\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If you only want to use the OpenBao agent to render one or more templates and do\nnot need to sink the acquired credentials, you can omit the ",(0,i.jsx)(n.code,{children:"sink"})," stanza from\nthe ",(0,i.jsx)(n.code,{children:"auto_auth"})," stanza in the agent configuration."]}),"\n",(0,i.jsx)(n.h2,{id:"renewals-and-updating-secrets",children:"Renewals and updating secrets"}),"\n",(0,i.jsxs)(n.p,{children:["The OpenBao Agent templating automatically renews and fetches secrets/tokens.\nUnlike ",(0,i.jsx)(n.a,{href:"/docs/agent-and-proxy/agent/caching",children:"OpenBao Agent caching"}),", the behavior of how OpenBao Agent\ntemplating does this depends on the type of secret or token. The following is a\nhigh level overview of different behaviors."]}),"\n",(0,i.jsx)(n.h3,{id:"renewable-secrets",children:"Renewable secrets"}),"\n",(0,i.jsx)(n.p,{children:"If a secret or token is renewable, OpenBao Agent will renew the secret after 2/3\nof the secret's lease duration has elapsed."}),"\n",(0,i.jsx)(n.h3,{id:"non-renewable-secrets",children:"Non-Renewable secrets"}),"\n",(0,i.jsxs)(n.p,{children:["If a secret or token isn't renewable or leased, OpenBao Agent will fetch the secret every 5 minutes.\nThis can be configured using Template config ",(0,i.jsx)(n.a,{href:"/docs/agent-and-proxy/agent/template#static_secret_render_interval",children:"static_secret_render_interval"}),".\nNon-renewable secrets include (but not limited to) ",(0,i.jsx)(n.a,{href:"/docs/secrets/kv/kv-v2",children:"KV Version 2"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"non-renewable-leased-secrets",children:"Non-Renewable leased secrets"}),"\n",(0,i.jsxs)(n.p,{children:["If a secret or token is non-renewable but leased, OpenBao Agent will fetch the secret when 85% of the\nsecrets time-to-live (TTL) is reached. Leased, non-renewable secrets include (but not limited\nto) dynamic secrets such as ",(0,i.jsx)(n.a,{href:"/docs/secrets/databases",children:"database credentials"})," and ",(0,i.jsx)(n.a,{href:"/docs/secrets/kv/kv-v1",children:"KV Version 1"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"static-roles",children:"Static roles"}),"\n",(0,i.jsxs)(n.p,{children:["If a secret has a ",(0,i.jsx)(n.code,{children:"rotation_period"}),", such as a ",(0,i.jsx)(n.a,{href:"/docs/secrets/databases#static-roles",children:"database static role"}),",\nOpenBao Agent template will fetch the new secret as it changes in OpenBao. It does\nthis by inspecting the secret's time-to-live (TTL)."]}),"\n",(0,i.jsx)(n.h3,{id:"certificates",children:"Certificates"}),"\n",(0,i.jsxs)(n.p,{children:["Certificates can be rendered using either ",(0,i.jsx)(n.code,{children:"pkiCert"})," or\n",(0,i.jsx)(n.code,{children:"secret"})," template functions, although it is recommended to use ",(0,i.jsx)(n.code,{children:"pkiCert"})," to\navoid unnecessarily generating certificates whenever Agent restarts or\nre-authenticates."]}),"\n",(0,i.jsxs)(n.h4,{id:"rendering-using-the-pkicert-template-function",children:["Rendering using the ",(0,i.jsx)(n.code,{children:"pkiCert"})," template function"]}),"\n",(0,i.jsxs)(n.p,{children:["If a ",(0,i.jsx)(n.a,{href:"/docs/secrets/pki",children:"certificate"})," is rendered using the ",(0,i.jsx)(n.code,{children:"pkiCert"})," template\nfunction, OpenBao Agent template will have the following fetching and re-rendering\nbehaviors on certificates:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Fetches a new certificate on Agent startup if none has been previously\nrendered or the current rendered one has expired."}),"\n",(0,i.jsx)(n.li,{children:"On Agent's auto-auth re-authentication, due to a token expiry for example,\nskip fetching unless the current rendered one has expired."}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"rendering-using-the-secret-template-function",children:["Rendering using the ",(0,i.jsx)(n.code,{children:"secret"})," template function"]}),"\n",(0,i.jsxs)(n.p,{children:["If a ",(0,i.jsx)(n.a,{href:"/docs/secrets/pki",children:"certificate"})," is rendered using the ",(0,i.jsx)(n.code,{children:"secret"})," template\nfunction, OpenBao Agent template will have the following fetching and re-rendering\nbehaviors on certificates:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Fetches a new certificate on Agent startup, even if previously rendered\ncertificates are still valid."}),"\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"generate_lease"})," is unset or set to ",(0,i.jsx)(n.code,{children:"false"}),", it uses the certificate's\n",(0,i.jsx)(n.code,{children:"validTo"})," field to determine re-fetch interval."]}),"\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"generate_lease"})," is set to ",(0,i.jsx)(n.code,{children:"true"}),", apply the non-renewable, leased secret\nrules."]}),"\n",(0,i.jsx)(n.li,{children:"On Agent's auto-auth re-authentication, due to a token expiry for example, it\nfetches and re-renders a new certificate even if the existing certificate is\nvalid."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"templating-configuration-example",children:"Templating configuration example"}),"\n",(0,i.jsx)(n.p,{children:"The following demonstrates OpenBao Agent Templates configuration blocks."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-hcl",children:'# Other OpenBao agent configuration blocks\n# ...\n\ntemplate_config {\n  static_secret_render_interval = "10m"\n  exit_on_retry_failure = true\n}\n\ntemplate {\n  source      = "/tmp/agent/template.ctmpl"\n  destination = "/tmp/agent/render.txt"\n}\n\ntemplate {\n  contents     = "{{ with secret \\"secret/my-secret\\" }}{{ .Data.data.foo }}{{ end }}"\n  destination  = "/tmp/agent/render-content.txt"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["And the following demonstrates how the templates look when using ",(0,i.jsx)(n.code,{children:"env_template"})," with\n",(0,i.jsx)(n.a,{href:"/docs/agent-and-proxy/agent/process-supervisor",children:"Process Supervisor Mode"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-hcl",children:'# Other OpenBao agent configuration blocks\n# ...\n\ntemplate_config {\n  static_secret_render_interval = "10m"\n  exit_on_retry_failure = true\n}\n\nenv_template "MY_ENV_VAR" {\n  contents = "{{ with secret \\"secret/my-secret\\" }}{{ .Data.data.foo }}{{ end }}"\n}\n\nenv_template "ENV_VAR_FROM_FILE" {\n  source = "/tmp/agent/template.ctmpl"\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(96540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);