"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9795],{16862:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var s=t(74848),i=t(28453);const a={sidebar_label:"RabbitMQ",description:"The RabbitMQ secrets engine for OpenBao generates user credentials to access RabbitMQ."},r="RabbitMQ secrets engine",o={id:"secrets/rabbitmq",title:"RabbitMQ secrets engine",description:"The RabbitMQ secrets engine for OpenBao generates user credentials to access RabbitMQ.",source:"@site/content/docs/secrets/rabbitmq.mdx",sourceDirName:"secrets",slug:"/secrets/rabbitmq",permalink:"/docs/secrets/rabbitmq",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/secrets/rabbitmq.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"RabbitMQ",description:"The RabbitMQ secrets engine for OpenBao generates user credentials to access RabbitMQ."},sidebar:"docs",previous:{title:"Rotation Primitives",permalink:"/docs/secrets/pki/rotation-primitives"},next:{title:"Overview",permalink:"/docs/secrets/ssh/"}},c={},l=[{value:"Setup",id:"setup",level:2},{value:"Usage",id:"usage",level:2},{value:"API",id:"api",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"rabbitmq-secrets-engine",children:"RabbitMQ secrets engine"}),"\n",(0,s.jsx)(n.p,{children:"The RabbitMQ secrets engine generates user credentials dynamically based on\nconfigured permissions and virtual hosts. This means that services that need to\naccess a virtual host no longer need to hardcode credentials."}),"\n",(0,s.jsx)(n.p,{children:"With every service accessing the messaging queue with unique credentials,\nauditing is much easier when questionable data access is discovered. Easily\ntrack issues down to a specific instance of a service based on the RabbitMQ\nusername."}),"\n",(0,s.jsx)(n.p,{children:"OpenBao makes use both of its own internal revocation system as well as the\ndeleting RabbitMQ users when creating RabbitMQ users to ensure that users become\ninvalid within a reasonable time of the lease expiring."}),"\n",(0,s.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(n.p,{children:"Most secrets engines must be configured in advance before they can perform their\nfunctions. These steps are usually completed by an operator or configuration\nmanagement tool."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Enable the RabbitMQ secrets engine:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"$ bao secrets enable rabbitmq\nSuccess! Enabled the rabbitmq secrets engine at: rabbitmq/\n"})}),"\n",(0,s.jsxs)(n.p,{children:["By default, the secrets engine will mount at the name of the engine. To\nenable the secrets engine at a different path, use the ",(0,s.jsx)(n.code,{children:"-path"})," argument."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Configure the credentials that OpenBao uses to communicate with RabbitMQ to\ngenerate credentials:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:'$ bao write rabbitmq/config/connection \\\n    connection_uri="http://localhost:15672" \\\n    username="admin" \\\n    password="password"\nSuccess! Data written to: rabbitmq/config/connection\n'})}),"\n",(0,s.jsx)(n.p,{children:"It is important that the OpenBao user have the administrator privilege to\nmanager users."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Configure a role that maps a name in OpenBao to virtual host permissions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:'$ bao write rabbitmq/roles/my-role \\\n    vhosts=\'{"/":{"write": ".*", "read": ".*"}}\'\nSuccess! Data written to: rabbitmq/roles/my-role\n'})}),"\n",(0,s.jsxs)(n.p,{children:["By writing to the ",(0,s.jsx)(n.code,{children:"roles/my-role"})," path we are defining the ",(0,s.jsx)(n.code,{children:"my-role"})," role.\nThis role will be created by evaluating the given ",(0,s.jsx)(n.code,{children:"vhosts"}),", ",(0,s.jsx)(n.code,{children:"vhost_topics"}),"\nand ",(0,s.jsx)(n.code,{children:"tags"})," statements. By default, no tags, no virtual hosts or topic\npermissions are assigned to a role. If no topic permissions are defined\nand the default authorisation backend is used, publishing to a topic\nexchange or consuming from a topic is always authorised. You can read\nmore about ",(0,s.jsx)(n.a,{href:"https://www.rabbitmq.com/management.html#permissions",children:"RabbitMQ management tags"}),"\nand ",(0,s.jsx)(n.a,{href:"https://www.rabbitmq.com/access-control.html#topic-authorisation",children:"RabbitMQ topic authorization"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.p,{children:"After the secrets engine is configured and a user/machine has an OpenBao token with\nthe proper permission, it can generate credentials."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Generate a new credential by reading from the ",(0,s.jsx)(n.code,{children:"/creds"})," endpoint with the name\nof the role:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"$ bao read rabbitmq/creds/my-role\nKey                Value\n---                -----\nlease_id           rabbitmq/creds/my-role/I39Hu8XXOombof4wiK5bKMn9\nlease_duration     768h\nlease_renewable    true\npassword           3yNDBikgQvrkx2VA2zhq5IdSM7IWk1RyMYJr\nusername           root-39669250-3894-8032-c420-3d58483ebfc4\n"})}),"\n",(0,s.jsx)(n.p,{children:"Using ACLs, it is possible to restrict using the rabbitmq secrets engine\nsuch that trusted operators can manage the role definitions, and both users\nand applications are restricted in the credentials they are allowed to read."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,s.jsxs)(n.p,{children:["The RabbitMQ secrets engine has a full HTTP API. Please see the\n",(0,s.jsx)(n.a,{href:"/api-docs/secret/rabbitmq",children:"RabbitMQ secrets engine API"})," for more\ndetails."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(96540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);