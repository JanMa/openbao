"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7103],{10924:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>c,metadata:()=>l,toc:()=>h});var s=n(74848),i=n(28453),r=n(11470),a=n(19365);const c={sidebar_label:"Overview",description:"Technical overview covering the concept of clients, entities, and entity IDs\nin OpenBao "},o="Clients and entities",l={id:"concepts/client-count/index",title:"Clients and entities",description:"Technical overview covering the concept of clients, entities, and entity IDs\nin OpenBao ",source:"@site/content/docs/concepts/client-count/index.mdx",sourceDirName:"concepts/client-count",slug:"/concepts/client-count/",permalink:"/openbao/docs/concepts/client-count/",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/concepts/client-count/index.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"Overview",description:"Technical overview covering the concept of clients, entities, and entity IDs\nin OpenBao "},sidebar:"docs",previous:{title:"Resource quotas",permalink:"/openbao/docs/concepts/resource-quotas"},next:{title:"Client count calculation",permalink:"/openbao/docs/concepts/client-count/counting"}},d={},h=[{value:"Identity and entity assignment",id:"identity-and-entity-assignment",level:2},{value:"Standard entity assignments",id:"standard-entity-assignments",level:2},{value:"Entity assignment with ACME",id:"entity-assignment-with-acme",level:2},{value:"Entity assignment with namespaces",id:"entity-assignment-with-namespaces",level:2},{value:"Entity assignment with non-entity tokens",id:"entity-assignment-with-non-entity-tokens",level:2}];function u(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"clients-and-entities",children:"Clients and entities"}),"\n",(0,s.jsxs)(t.p,{children:["Anything that connects and authenticates to OpenBao to accomplish a task is a\n",(0,s.jsx)(t.strong,{children:"client"}),". For example, a user logging into a cluster to manage policies or a\nmachine-based system (application or cloud service) requesting a database token\nare both considered clients."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:"https://www.datocms-assets.com/2885/1617325020-valult-client-workflows.png",alt:"OpenBao Client Workflows"})}),"\n",(0,s.jsx)(t.p,{children:"While there are many different potential clients, the most common are:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Human users"})," interacting directly with OpenBao."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Applications and microservices"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Servers and platforms"})," like VMs, Docker containers, or Kubernetes pods."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Orchestrators"})," like Nomad, Terraform, Ansible, ACME, and other continuous\nintegration / continuous delivery (CI/CD) pipelines."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"OpenBao agents and proxies"})," that act on behalf of an application or\nmicroservice."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"identity-and-entity-assignment",children:"Identity and entity assignment"}),"\n",(0,s.jsx)(t.p,{children:"Authorized clients can connect to OpenBao with a variety of authentication methods."}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Authorization source"}),(0,s.jsx)(t.th,{children:"AuthN method"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Externally managed or SSO"}),(0,s.jsx)(t.td,{children:"Active Directory, LDAP, OIDC, JWT, GitHub, username+password"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Platform- or server-based"}),(0,s.jsx)(t.td,{children:"Kubernetes, Cert"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Self"}),(0,s.jsx)(t.td,{children:"AppRole, tokens with no associated authN path or role"})]})]})]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:"https://www.datocms-assets.com/2885/1617325030-vault-clients.png",alt:"OpenBao client types"})}),"\n",(0,s.jsxs)(t.p,{children:["When a client authenticates, OpenBao assigns a unique identifier\n(",(0,s.jsx)(t.strong,{children:"client entity"}),") in the ",(0,s.jsx)(t.a,{href:"/docs/secrets/identity",children:"OpenBao identity system"}),"\nbased on the authentication method used or a previously assigned alias.\n",(0,s.jsx)(t.strong,{children:"Entity aliases"})," let clients authenticate with multiple methods but still be\nassociated with a single policy, share resources, and count as the same entity,\nregardless of the authentication method used for a particular session."]}),"\n",(0,s.jsx)(t.h2,{id:"standard-entity-assignments",children:"Standard entity assignments"}),"\n",(0,s.jsx)(t.p,{children:"In addition to custom authentication methods configured with secure plugins,\nOpenBao supports many standardized authentication methods by default. "}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"AuthN method"}),(0,s.jsx)(t.th,{children:"Unique ID"}),(0,s.jsx)(t.th,{children:"Configured with"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/api-docs/auth/approle#create-update-approle",children:"AppRole"})}),(0,s.jsx)(t.td,{children:"Role ID"}),(0,s.jsx)(t.td,{children:"Not configurable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/api-docs/auth/jwt#create-role",children:"JWT/OIDC"})}),(0,s.jsx)(t.td,{children:"The presented claims (no default value)"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"user_claim"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/docs/auth/kerberos",children:"Kerberos"})}),(0,s.jsx)(t.td,{children:"Username"}),(0,s.jsx)(t.td,{children:"Not configurable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/api-docs/auth/kubernetes#create-role",children:"Kubernetes"})}),(0,s.jsx)(t.td,{children:"Service account UID"}),(0,s.jsx)(t.td,{children:"Not configurable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/docs/auth/ldap",children:"LDAP"})}),(0,s.jsx)(t.td,{children:"Username"}),(0,s.jsx)(t.td,{children:"Not configurable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/docs/auth/radius",children:"RADIUS"})}),(0,s.jsx)(t.td,{children:"Username"}),(0,s.jsx)(t.td,{children:"Not configurable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/api-docs/auth/cert#create-ca-certificate-role",children:"TLS Certificate"})}),(0,s.jsx)(t.td,{children:"Subject CommonName"}),(0,s.jsx)(t.td,{children:"Not configurable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/docs/auth/token",children:"Token"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"entity_alias"})}),(0,s.jsx)(t.td,{children:"Not configurable"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"/api-docs/auth/userpass#create-update-user",children:"Username/Password"})}),(0,s.jsx)(t.td,{children:"Username"}),(0,s.jsx)(t.td,{children:"Not configurable"})]})]})]}),"\n",(0,s.jsx)(t.p,{children:"Each authentication method has a unique ID string that corresponds to a client\nentity used for telemetry. For example, a microservice authenticating with\nAppRole takes the associated role ID as the entity. If you are running at scale\nand have multiple copies of the microservices using the same role id, the full\nset of instances will share the same identifier."}),"\n",(0,s.jsxs)(t.p,{children:["As a result, it is critical that you configure different clients\n(microservices, humans, applications, services, platforms, servers, or pipelines)\nin a way that results in distinct clients having unique identifiers. For example,\nthe role IDs should be different ",(0,s.jsx)(t.strong,{children:"between"})," two microservices, MicroserviceA and\nMicroServiceB, even if the ",(0,s.jsx)(t.strong,{children:"specific instances"})," of MicroServiceA and\nMicroServiceB share a common role ID."]}),"\n",(0,s.jsx)(t.h2,{id:"entity-assignment-with-acme",children:"Entity assignment with ACME"}),"\n",(0,s.jsxs)(t.p,{children:["OpenBao treats all ACME connections that authenticate under the same certificate\nidentifier (domain) as the same ",(0,s.jsx)(t.strong,{children:"certificate entity"})," for client count\ncalculations."]}),"\n",(0,s.jsx)(t.p,{children:"For example:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"ACME client requests (from the same server or separate servers) for the same\ncertificate identifier (a unique combination of CN,DNS, SANS and IP SANS)\nare treated as the same entities."}),"\n",(0,s.jsxs)(t.li,{children:["If an ACME client makes a request for ",(0,s.jsx)(t.code,{children:"a.test.com"}),", and subsequently makes a new\nrequest for ",(0,s.jsx)(t.code,{children:"b.test.com"})," and ",(0,s.jsx)(t.code,{children:"*.test.com"})," then two distinct entities will be created,\none for ",(0,s.jsx)(t.code,{children:"a.test.com"})," and another for the combination of ",(0,s.jsx)(t.code,{children:"b.test.com"})," and ",(0,s.jsx)(t.code,{children:"*.test.com"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Overlap of certificate identifiers from different ACME clients will be treated\nas the same entity e.g. if client 1 requests ",(0,s.jsx)(t.code,{children:"a.test.com"})," and client 2 requests\n",(0,s.jsx)(t.code,{children:"a.test.com"})," a single entity is created for both requests."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"entity-assignment-with-namespaces",children:"Entity assignment with namespaces"}),"\n",(0,s.jsx)(t.p,{children:"A namespace represents a isolated, logical space within a single OpenBao\ncluster and is typically used for administrative purposes."}),"\n",(0,s.jsxs)(t.p,{children:["When a client authenticates ",(0,s.jsx)(t.strong,{children:"within a given namespace"}),", OpenBao assigns the same\nclient entity to activities within any child namespaces because the namespaces\nexist within the same larger scope."]}),"\n",(0,s.jsxs)(t.p,{children:["When a client authenticates ",(0,s.jsx)(t.strong,{children:"across namespace boundaries"}),", OpenBao treats the\nsingle client as two distinct entities because the client is operating\nacross different scopes with different policy assignments and resources."]}),"\n",(0,s.jsx)(t.p,{children:"For example:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Different requests under parent and child namespaces from a single client\nauthenticated under the ",(0,s.jsx)(t.strong,{children:"parent"})," namespace are assigned ",(0,s.jsx)(t.strong,{children:"the same entity\nID"}),". All the client activities occur ",(0,s.jsx)(t.strong,{children:"within"})," the boundaries of the\nnamespace referenced in the original authentication request."]}),"\n",(0,s.jsxs)(t.li,{children:["Different requests under parent and child namespaces from a single client\nauthenticated under the ",(0,s.jsx)(t.strong,{children:"child"})," namespace are assigned ",(0,s.jsx)(t.strong,{children:"different entity\nIDs"}),". Some of the client activities occur ",(0,s.jsx)(t.strong,{children:"outside"})," the boundaries of the\nnamespace referenced in the original authentication request."]}),"\n",(0,s.jsxs)(t.li,{children:["Requests by the same client to two different namespaces, NAMESPACE",(0,s.jsx)("sub",{children:"A"}),"\nand NAMESPACE",(0,s.jsx)("sub",{children:"B"})," are assigned ",(0,s.jsx)(t.strong,{children:"different entity IDs"}),"."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"entity-assignment-with-non-entity-tokens",children:"Entity assignment with non-entity tokens"}),"\n",(0,s.jsxs)(t.p,{children:["OpenBao uses tokens as the core method for authentication. You can use tokens to\nauthenticate directly, or use token ",(0,s.jsx)(t.a,{href:"/docs/concepts/auth",children:"auth methods"}),"\nto dynamically generate tokens based on external identities."]}),"\n",(0,s.jsxs)(t.p,{children:["When clients authenticate with the ",(0,s.jsx)(t.a,{href:"/docs/auth/token",children:"token auth method"}),"\n",(0,s.jsx)(t.strong,{children:"without"})," a client identity, the result is a ",(0,s.jsx)(t.strong,{children:"non-entity token"}),". For example,\na service might use the token authentication method to create a token for a user\nwhose explicit identity is unknown."]}),"\n",(0,s.jsx)(t.p,{children:"Ultimately, non-entity tokens trace back to a particular client or purpose so\nOpenBao assigns unique entity IDs to non-entity tokens based on a combination of\nthe:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"assigned entity alias name (if present),"}),"\n",(0,s.jsx)(t.li,{children:"associated policies, and"}),"\n",(0,s.jsx)(t.li,{children:"namespace under which the token was created."}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["In ",(0,s.jsx)(t.strong,{children:"rare"})," cases, tokens may be created outside of the OpenBao identity system\n",(0,s.jsx)(t.strong,{children:"without"})," an associated entity or identity. OpenBao treats every unaffiliated\ntoken as a unique client for production usage. We strongly discourage the use of\nunaffiliated tokens and recommend that you always associate a token with an\nentity alias and token role."]}),"\n",(0,s.jsx)(t.admonition,{title:"Behavior of non-entity tokens",type:"note",children:(0,s.jsx)(t.p,{children:"All non-entity tokens with the same namespace and policy assignments are\ntreated as the same client entity."})}),"\n",(0,s.jsxs)(r.A,{children:[(0,s.jsx)(a.A,{value:"Related concepts",heading:"Related concepts",children:(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"/docs/concepts/client-count/counting",children:"Client count calculation"})}),(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"/docs/concepts/client-count/faq",children:"Client count FAQ"})})]})}),(0,s.jsx)(a.A,{value:"Related tutorials",heading:"Related tutorials",children:(0,s.jsx)("ul",{children:(0,s.jsx)("li",{children:(0,s.jsx)("a",{href:"/tutorials/auth-methods/identity",children:"Identity: Entities and Groups"})})})}),(0,s.jsx)(a.A,{value:"Other resources",heading:"Other resources",children:(0,s.jsx)("ul",{children:(0,s.jsx)("li",{children:(0,s.jsxs)(t.p,{children:["Article:\n",(0,s.jsx)("a",{href:"https://www.hashicorp.com/identity-based-security-and-low-trust-networks",children:"Identity-based Security and Low-trust Networks"})]})})})})]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},19365:(e,t,n)=>{n.d(t,{A:()=>a});n(96540);var s=n(34164);const i={tabItem:"tabItem_Ymn6"};var r=n(74848);function a(e){let{children:t,hidden:n,className:a}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,s.A)(i.tabItem,a),hidden:n,children:t})}},11470:(e,t,n)=>{n.d(t,{A:()=>w});var s=n(96540),i=n(34164),r=n(23104),a=n(56347),c=n(205),o=n(57485),l=n(31682),d=n(89466);function h(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:t,children:n}=e;return(0,s.useMemo)((()=>{const e=t??function(e){return h(e).map((e=>{let{props:{value:t,label:n,attributes:s,default:i}}=e;return{value:t,label:n,attributes:s,default:i}}))}(n);return function(e){const t=(0,l.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const i=(0,a.W6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,o.aZ)(r),(0,s.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(i.location.search);t.set(r,e),i.replace({...i.location,search:t.toString()})}),[r,i])]}function x(e){const{defaultValue:t,queryString:n=!1,groupId:i}=e,r=u(e),[a,o]=(0,s.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const s=n.find((e=>e.default))??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:t,tabValues:r}))),[l,h]=m({queryString:n,groupId:i}),[x,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[i,r]=(0,d.Dv)(n);return[i,(0,s.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:i}),j=(()=>{const e=l??x;return p({value:e,tabValues:r})?e:null})();(0,c.A)((()=>{j&&o(j)}),[j]);return{selectedValue:a,selectValue:(0,s.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);o(e),h(e),f(e)}),[h,f,r]),tabValues:r}}var f=n(92303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=n(74848);function b(e){let{className:t,block:n,selectedValue:s,selectValue:a,tabValues:c}=e;const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,r.a_)(),d=e=>{const t=e.currentTarget,n=o.indexOf(t),i=c[n].value;i!==s&&(l(t),a(i))},h=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=o.indexOf(e.currentTarget)+1;t=o[n]??o[0];break}case"ArrowLeft":{const n=o.indexOf(e.currentTarget)-1;t=o[n]??o[o.length-1];break}}t?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},t),children:c.map((e=>{let{value:t,label:n,attributes:r}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,ref:e=>o.push(e),onKeyDown:h,onClick:d,...r,className:(0,i.A)("tabs__item",j.tabItem,r?.className,{"tabs__item--active":s===t}),children:n??t},t)}))})}function y(e){let{lazy:t,children:n,selectedValue:i}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===i));return e?(0,s.cloneElement)(e,{className:"margin-top--md"}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:r.map(((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==i})))})}function v(e){const t=x(e);return(0,g.jsxs)("div",{className:(0,i.A)("tabs-container",j.tabList),children:[(0,g.jsx)(b,{...e,...t}),(0,g.jsx)(y,{...e,...t})]})}function w(e){const t=(0,f.A)();return(0,g.jsx)(v,{...e,children:h(e.children)},String(t))}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>c});var s=n(96540);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);