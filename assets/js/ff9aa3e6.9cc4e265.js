"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[52],{30953:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var s=n(74848),r=n(28453);const o={layout:"api",page_title:"/sys/generate-root - HTTP API",description:"The `/sys/generate-root/` endpoints are used to create a new root key for\nOpenBao."},l="/sys/generate-root",a={id:"system/generate-root",title:"/sys/generate-root",description:"The `/sys/generate-root/` endpoints are used to create a new root key for\nOpenBao.",source:"@site/content/api-docs/system/generate-root.mdx",sourceDirName:"system",slug:"/system/generate-root",permalink:"/openbao/api-docs/system/generate-root",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/api-docs/system/generate-root.mdx",tags:[],version:"current",frontMatter:{layout:"api",page_title:"/sys/generate-root - HTTP API",description:"The `/sys/generate-root/` endpoints are used to create a new root key for\nOpenBao."},sidebar:"apiSidebar",previous:{title:"/sys/generate-recovery-token",permalink:"/openbao/api-docs/system/generate-recovery-token"},next:{title:"/sys/ha-status",permalink:"/openbao/api-docs/system/ha-status"}},i={},d=[{value:"Read root generation progress",id:"read-root-generation-progress",level:2},{value:"Sample request",id:"sample-request",level:3},{value:"Sample response",id:"sample-response",level:3},{value:"Start root token generation",id:"start-root-token-generation",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Sample request",id:"sample-request-1",level:3},{value:"Sample response",id:"sample-response-1",level:3},{value:"Cancel root generation",id:"cancel-root-generation",level:2},{value:"Sample request",id:"sample-request-2",level:3},{value:"Provide key share to generate root",id:"provide-key-share-to-generate-root",level:2},{value:"Parameters",id:"parameters-1",level:3},{value:"Sample payload",id:"sample-payload",level:3},{value:"Sample request",id:"sample-request-3",level:3},{value:"Sample response",id:"sample-response-2",level:3}];function c(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"sysgenerate-root",children:(0,s.jsx)(t.code,{children:"/sys/generate-root"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"/sys/generate-root"})," endpoint is used to create a new root key for OpenBao."]}),"\n",(0,s.jsx)(t.h2,{id:"read-root-generation-progress",children:"Read root generation progress"}),"\n",(0,s.jsx)(t.p,{children:"This endpoint reads the configuration and process of the current root generation\nattempt."}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Method"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"GET"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"/sys/generate-root/attempt"})})]})})]}),"\n",(0,s.jsx)(t.h3,{id:"sample-request",children:"Sample request"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell-session",children:"$ curl \\\n    http://127.0.0.1:8200/v1/sys/generate-root/attempt\n"})}),"\n",(0,s.jsx)(t.h3,{id:"sample-response",children:"Sample response"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'{\n  "started": true,\n  "nonce": "2dbd10f1-8528-6246-09e7-82b25b8aba63",\n  "progress": 1,\n  "required": 3,\n  "encoded_token": "",\n  "pgp_fingerprint": "",\n  "otp_length": 24,\n  "complete": false\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:["If a root generation is started, ",(0,s.jsx)(t.code,{children:"progress"})," is how many unseal keys have been\nprovided for this generation attempt, where ",(0,s.jsx)(t.code,{children:"required"})," must be reached to\ncomplete. The ",(0,s.jsx)(t.code,{children:"nonce"})," for the current attempt and whether the attempt is\ncomplete is also displayed."]}),"\n",(0,s.jsx)(t.p,{children:"If a PGP key is being used to encrypt the final root\ntoken, its fingerprint will be returned."}),"\n",(0,s.jsx)(t.p,{children:"If an OTP is being used to encode the final root token it will be returned only\nonce, on the response to the start request."}),"\n",(0,s.jsx)(t.p,{children:"The OTP is a base62 string, with length of otp_length.\nThe raw bytes (char codes) of the token will be XOR'd with\nthis value before being returned as a response to the final unseal\nkey, encoded as base64."}),"\n",(0,s.jsx)(t.h2,{id:"start-root-token-generation",children:"Start root token generation"}),"\n",(0,s.jsx)(t.p,{children:"This endpoint initializes a new root generation attempt. Only a single root\ngeneration attempt can take place at a time."}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Method"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"POST"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"/sys/generate-root/attempt"})})]})})]}),"\n",(0,s.jsx)(t.h3,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"pgp_key"})," ",(0,s.jsx)(t.code,{children:"(string: <optional>)"})," \u2013 Specifies a base64-encoded PGP public key.\nThe raw bytes of the token will be encrypted with this value before being\nreturned to the final unseal key provider."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"sample-request-1",children:"Sample request"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell-session",children:"$ curl \\\n    --request POST \\\n    http://127.0.0.1:8200/v1/sys/generate-root/attempt\n"})}),"\n",(0,s.jsx)(t.h3,{id:"sample-response-1",children:"Sample response"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'{\n  "started": true,\n  "nonce": "2dbd10f1-8528-6246-09e7-82b25b8aba63",\n  "progress": 1,\n  "required": 3,\n  "encoded_token": "",\n  "otp": "2vPFYG8gUSW9npwzyvxXMug0",\n  "otp_length": 24,\n  "complete": false\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"cancel-root-generation",children:"Cancel root generation"}),"\n",(0,s.jsx)(t.p,{children:"This endpoint cancels any in-progress root generation attempt. This clears any\nprogress made. This must be called to change the OTP or PGP key being used."}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Method"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"DELETE"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"/sys/generate-root/attempt"})})]})})]}),"\n",(0,s.jsx)(t.h3,{id:"sample-request-2",children:"Sample request"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell-session",children:"$ curl \\\n    --request DELETE \\\n    http://127.0.0.1:8200/v1/sys/generate-root/attempt\n"})}),"\n",(0,s.jsx)(t.h2,{id:"provide-key-share-to-generate-root",children:"Provide key share to generate root"}),"\n",(0,s.jsx)(t.p,{children:"This endpoint is used to enter a single root key share to progress the root\ngeneration attempt. If the threshold number of root key shares is reached,\nOpenBao will complete the root generation and issue the new token. Otherwise,\nthis API must be called multiple times until that threshold is met. The attempt\nnonce must be provided with each call."}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Method"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Path"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"POST"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"/sys/generate-root/update"})})]})})]}),"\n",(0,s.jsx)(t.h3,{id:"parameters-1",children:"Parameters"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"key"})," ",(0,s.jsx)(t.code,{children:"(string: <required>)"})," \u2013 Specifies a single root key share."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"nonce"})," ",(0,s.jsx)(t.code,{children:"(string: <required>)"})," \u2013\xa0Specifies the nonce of the attempt."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"sample-payload",children:"Sample payload"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'{\n  "key": "acbd1234",\n  "nonce": "ad235"\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"sample-request-3",children:"Sample request"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell-session",children:"$ curl \\\n    --request POST \\\n    --data @payload.json \\\n    http://127.0.0.1:8200/v1/sys/generate-root/update\n"})}),"\n",(0,s.jsx)(t.h3,{id:"sample-response-2",children:"Sample response"}),"\n",(0,s.jsx)(t.p,{children:"This returns a JSON-encoded object indicating the attempt nonce, and completion\nstatus, and the encoded root token, if the attempt is complete."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'{\n  "started": true,\n  "nonce": "2dbd10f1-8528-6246-09e7-82b25b8aba63",\n  "progress": 3,\n  "required": 3,\n  "pgp_fingerprint": "",\n  "complete": true,\n  "encoded_token": "FPzkNBvwNDeFh4SmGA8c+w=="\n}\n'})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>a});var s=n(96540);const r={},o=s.createContext(r);function l(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);