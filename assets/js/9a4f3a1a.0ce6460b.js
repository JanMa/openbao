"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4363],{17902:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var t=s(74848),r=s(28453);const a={description:"Username templating are used in some secret engines to allow operators to define how dynamic usernames are generated."},i="Username templating",c={id:"concepts/username-templating",title:"Username templating",description:"Username templating are used in some secret engines to allow operators to define how dynamic usernames are generated.",source:"@site/content/docs/concepts/username-templating.mdx",sourceDirName:"concepts",slug:"/concepts/username-templating",permalink:"/openbao/docs/concepts/username-templating",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/concepts/username-templating.mdx",tags:[],version:"current",frontMatter:{description:"Username templating are used in some secret engines to allow operators to define how dynamic usernames are generated."},sidebar:"docs",previous:{title:"Password policies",permalink:"/openbao/docs/concepts/password-policies"},next:{title:"High Availability",permalink:"/openbao/docs/concepts/ha"}},d={},l=[{value:"Available functions",id:"available-functions",level:2},{value:"String/Character manipulation",id:"stringcharacter-manipulation",level:3},{value:"Generating values",id:"generating-values",level:3},{value:"Hashing",id:"hashing",level:3},{value:"Examples",id:"examples",level:2},{value:"Basic example",id:"basic-example",level:3},{value:"Custom functions",id:"custom-functions",level:3},{value:"Truncating to maximum length",id:"truncating-to-maximum-length",level:3}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"username-templating",children:"Username templating"}),"\n",(0,t.jsxs)(n.p,{children:["Some of the secrets engines that generate dynamic users for external systems provide the ability for OpenBao operators\nto customize how usernames are generated for said external systems. This customization feature uses the\n",(0,t.jsx)(n.a,{href:"https://golang.org/pkg/text/template/",children:"Go template language"}),". This page describes the basics of using these templates\nfor username generation but does not go into great depth of using the templating language for more advanced usages.\nSee the API documentation for the given secret engine to determine if it supports username templating and for more\ndetails on using it with that engine."]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"When customizing how usernames are generated, take care to ensure you have enough randomness to ensure uniqueness\notherwise multiple calls to create the credentials may interfere with each other."})}),"\n",(0,t.jsx)(n.p,{children:"In addition to the functionality built into the Go template language, a number of additional functions are available:"}),"\n",(0,t.jsx)(n.h2,{id:"available-functions",children:"Available functions"}),"\n",(0,t.jsx)(n.h3,{id:"stringcharacter-manipulation",children:"String/Character manipulation"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"lowercase"})," - Lowercases the input value.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{.FieldName | lowercase}}"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"replace"})," - Find/replace on the input value.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{.FieldName | replace - _}}"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"truncate"})," - truncates the input value to the specified number of characters.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{.FieldName | truncate 10}}"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"truncate_sha256"})," - Truncates the input value to the specified number of characters. The last 8 characters of the\nnew value will be replace by the first 8 characters of the SHA256 hash of the truncated characters.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{.FieldName | truncate_sha256 20}}"}),". If ",(0,t.jsx)(n.code,{children:"FieldName"})," is ",(0,t.jsx)(n.code,{children:"abcdefghijklmnopqrstuvwxyz"}),", all characters after\nthe 12th (",(0,t.jsx)(n.code,{children:"l"}),") are removed and SHA256 hashed (",(0,t.jsx)(n.code,{children:"872808ffbf...1886ca6f20"}),").\nThe first 8 characters of the hash (",(0,t.jsx)(n.code,{children:"872808ff"}),") are then appended to the end of the first 12 characters from the\noriginal value: ",(0,t.jsx)(n.code,{children:"abcdefghijkl872808ff"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"uppercase"})," - Uppercases the input value.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{.FieldName | uppercase}}"})]}),"\n",(0,t.jsx)(n.h3,{id:"generating-values",children:"Generating values"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"random"})," - Generates a random string from lowercase letters, uppercase letters, and numbers. Must include a\nnumber indicating how many characters to generate.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{random 20}}"})," generates 20 random characters"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"timestamp"})," - The current time. Must provide a formatting string based on Go\u2019s ",(0,t.jsx)(n.a,{href:"https://golang.org/pkg/time/",children:"time package"}),".",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:'{{timestamp "2006-01-02T15:04:05Z"}}'})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"unix_time"})," - The current unix timestamp (number of seconds since Jan 1 1970).",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{unix_time}}"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"unix_time_millis"})," - The current unix timestamp in milliseconds.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{unix_time_millis}}"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"uuid"})," - Generates a random UUID.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{uuid}}"})]}),"\n",(0,t.jsx)(n.h3,{id:"hashing",children:"Hashing"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"base64"})," - Base64 encodes the input value.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{.FieldName | base64}}"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"sha256"})," - SHA256 hashes the input value.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.strong,{children:"Example"}),": ",(0,t.jsx)(n.code,{children:"{{.FieldName | sha256}}"})]}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsxs)(n.p,{children:["Each secret engine provides a different set of data to the template. Please see the associated secret engine's\ndocumentation for details on what values are provided to the template. The examples below are modeled after the\n",(0,t.jsx)(n.a,{href:"/docs/secrets/databases",children:"Database engine's"})," data, however the specific fields that are provided from a given engine\nmay differ from these examples. Additionally, the time is assumed to be 2009-02-13 11:31:30PM GMT\n(unix timestamp: 1234567890) and random characters are the ordered english alphabet: ",(0,t.jsx)(n.code,{children:"abcdefghijklmnopqrstuvwxyz"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["Note: The space between ",(0,t.jsx)(n.code,{children:"{{"}),"/",(0,t.jsx)(n.code,{children:"}}"})," and the values/functions are optional.\nFor instance: ",(0,t.jsx)(n.code,{children:"{{.DisplayName}}"})," is equivalent to ",(0,t.jsx)(n.code,{children:"{{ .DisplayName }}"})]})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field name"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"DisplayName"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"token-with-display-name"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"RoleName"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"my_custom_database_role"})})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["To reference either of these fields, a ",(0,t.jsx)(n.code,{children:"."})," must be put in front of the field name: ",(0,t.jsx)(n.code,{children:"{{.DisplayName}}"}),". Custom functions\ndo not include a ",(0,t.jsx)(n.code,{children:"."})," in front of them: ",(0,t.jsx)(n.code,{children:"{{random 20}}"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"basic-example",children:"Basic example"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Template"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"{{.DisplayName}}_{{.RoleName}}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Username"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"token-with-display-name_my_custom_database_role\n"})}),"\n",(0,t.jsx)(n.p,{children:"This is a basic example that references the two fields that are provided to the template. In simplest terms, this is\na simple string substitution."}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"This example does not have any randomness and should not be used when generating dynamic usernames. The purpose is to\ndemonstrate referencing data within the Go template language."})}),"\n",(0,t.jsx)(n.h3,{id:"custom-functions",children:"Custom functions"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Template"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'FOO_{{.DisplayName | replace "-" "_" | uppercase}}_{{.RoleName | replace "-" "_" | uppercase}}_{{timestamp "2006_01_02T15_04_05Z" | replace "-" "_"}}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Username"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"FOO_TOKEN_WITH_DISPLAY_NAME_MY_CUSTOM_DATABASE_ROLE_2009_02_13T11_31_30Z_0700\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:'{{.DisplayName | replace "-" "_" | uppercase}}'})," - Replaces all dashes with underscores and then uppercases the display name.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.code,{children:'{{.RoleName | replace "-" "_" | uppercase}}'})," - Replaces all dashes with underscores and then uppercases the role name.",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.code,{children:'{{timestamp "2006_01_02T15_04_05Z" | replace "-" "_"}}'})," - Generates the current timestamp using the provided format and\nreplaces all dashes with underscores."]}),"\n",(0,t.jsx)(n.h3,{id:"truncating-to-maximum-length",children:"Truncating to maximum length"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Template"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'{{printf "v_%s_%s_%s_%s" (.DisplayName | truncate 8) (.RoleName | truncate 8) (random 20) (unix_time) | truncate 45}}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Username"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"v_token-wi_my_custo_abcdefghijklmnopqrst_1234\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:".DisplayName | truncate 8"})," truncates the display name to 8 characters (",(0,t.jsx)(n.code,{children:"token-wi"}),").",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.code,{children:".RoleName | truncate 8"})," truncates the role name to 8 characters (",(0,t.jsx)(n.code,{children:"my_custo"}),").",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.code,{children:"random 20"})," generates 20 random characters ",(0,t.jsx)(n.code,{children:"abcdefghijklmnopqrst"}),".",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.code,{children:"unix_time"})," generates the current timestamp as the number of seconds since January 1, 1970 (",(0,t.jsx)(n.code,{children:"1234567890"}),").",(0,t.jsx)("br",{})]}),"\n",(0,t.jsxs)(n.p,{children:["Each of these values are passed to ",(0,t.jsx)(n.code,{children:'printf "v_%s_%s_%s_%s"'})," which prepends them with ",(0,t.jsx)(n.code,{children:"v_"})," and puts an underscore between\neach field. This results in ",(0,t.jsx)(n.code,{children:"v_token-wi_my_custo_abcdefghijklmnopqrst_1234567890"}),". This value is then passed to\n",(0,t.jsx)(n.code,{children:"truncate 45"})," where the last 6 characters are removed which results in ",(0,t.jsx)(n.code,{children:"v_token-wi_my_custo_abcdefghijklmnopqrst_1234"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var t=s(96540);const r={},a=t.createContext(r);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);