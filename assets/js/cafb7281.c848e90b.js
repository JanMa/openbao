"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8477],{52146:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>l,frontMatter:()=>t,metadata:()=>r,toc:()=>h});var s=i(74848),o=i(28453);const t={description:"Documentation",displayed_sidebar:"docs"},a="Code organization",r={id:"contributing/code-organization",title:"Code organization",description:"Documentation",source:"@site/content/docs/contributing/code-organization.mdx",sourceDirName:"contributing",slug:"/contributing/code-organization",permalink:"/openbao/docs/contributing/code-organization",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/contributing/code-organization.mdx",tags:[],version:"current",frontMatter:{description:"Documentation",displayed_sidebar:"docs"},sidebar:"docs",previous:{title:"Contributing",permalink:"/openbao/docs/contributing/"},next:{title:"Overview",permalink:"/openbao/docs/rfcs/"}},c={},h=[{value:"API",id:"api",level:2},{value:"SDK",id:"sdk",level:2},{value:"UI",id:"ui",level:2},{value:"Website",id:"website",level:2},{value:"OpenBao CLI, server, and plugins",id:"openbao-cli-server-and-plugins",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"code-organization",children:"Code organization"}),"\n",(0,s.jsx)(n.p,{children:"OpenBao repository is organized into five main modules:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["An API client (",(0,s.jsxs)(n.a,{href:"https://github.com/openbao/openbao/tree/main/api",children:["in ",(0,s.jsx)(n.code,{children:"api/"})]}),")\nfor interacting with OpenBao instances,"]}),"\n",(0,s.jsxs)(n.li,{children:["A collection of useful helper modules\n(",(0,s.jsxs)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/",children:["in ",(0,s.jsx)(n.code,{children:"sdk/"})]}),"),"]}),"\n",(0,s.jsxs)(n.li,{children:["The Web UI, built with Ember and ",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/issues/189",children:"temporarily disabled"}),"\n(",(0,s.jsxs)(n.a,{href:"https://github.com/openbao/openbao/tree/main/ui/",children:["in ",(0,s.jsx)(n.code,{children:"ui/"})]}),"),"]}),"\n",(0,s.jsxs)(n.li,{children:["The API and documentation website (",(0,s.jsxs)(n.a,{href:"https://github.com/openbao/openbao/tree/main/website/",children:["in ",(0,s.jsx)(n.code,{children:"website/"})]}),"), and"]}),"\n",(0,s.jsxs)(n.li,{children:["The cli and server code, ",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/",children:"everywhere else"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Of these, ",(0,s.jsx)(n.code,{children:"api/"})," and ",(0,s.jsx)(n.code,{children:"sdk/"})," are separate Go modules meant to be importable\ninto other applications. The Go module in the root of the project is for\nthe server and is not meant to be externally importable."]}),"\n",(0,s.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,s.jsx)(n.p,{children:"The included API is a bespoke API client written in Go. Because this is\nexpected to be stable, we need to carefully consider whether a change will be\nbreaking to consumers of the library. Some key files are:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/main/api/client.go",children:(0,s.jsx)(n.code,{children:"api/client.go"})})," is\nthe main entry point of the client."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/main/api/logical.go",children:(0,s.jsx)(n.code,{children:"api/logical.go"})})," has\nbackend-agnostic utilities for speaking OpenBao API semantics."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/main/api/secret.go",children:(0,s.jsx)(n.code,{children:"api/secret.go"})})," has\nstructured response parsing."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/api/auth",children:(0,s.jsx)(n.code,{children:"api/auth"})})," has various\nspecialized authentication plugin helpers."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/search?q=repo%3Aopenbao%2Fopenbao%20api%2Fsys&type=code",children:(0,s.jsx)(n.code,{children:"api/sys_*.go"})}),",\n",(0,s.jsx)(n.a,{href:"https://github.com/search?q=repo%3Aopenbao%2Fopenbao%20api%2Fkv&type=code",children:(0,s.jsx)(n.code,{children:"api/kv*.go"})}),",\n",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/main/api/auth.go",children:(0,s.jsx)(n.code,{children:"api/auth.go"})}),", and\n",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/main/api/ssh.go",children:(0,s.jsx)(n.code,{children:"api/ssh.go"})})," have\nbackend-specific calls for various portions of the API space (such as\n",(0,s.jsx)(n.a,{href:"/api-docs/system",children:(0,s.jsx)(n.code,{children:"sys/"})}),", authenticating to OpenBao, or the\n",(0,s.jsxs)(n.a,{href:"/docs/secrets/ssh",children:[(0,s.jsx)(n.code,{children:"ssh"})," plugin"]}),")."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Upstream also includes ",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/issues/41",children:"OpenAPI-based client libraries"}),"\nthat haven't yet been forked; if maintainers are interested in helping to\nsupport these libraries, let us know!"]}),"\n",(0,s.jsx)(n.h2,{id:"sdk",children:"SDK"}),"\n",(0,s.jsxs)(n.p,{children:["The SDK module exists to share externally usable, independent modules with\npeople outside of OpenBao. These may be things useful in conjunction with\nOpenBao (e.g., ",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/plugin",children:(0,s.jsx)(n.code,{children:"sdk/plugin"})}),"\nfor building auth and secret plugins), they might be testing libraries\n(such as ",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/helper/testcluster",children:(0,s.jsx)(n.code,{children:"sdk/helper/testcluster"})}),"\nfor testing plugins or external projects that rely on OpenBao from Go tests),\nor they might be standalone libraries provided to the community (such as\n",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/helper/shamir",children:(0,s.jsx)(n.code,{children:"sdk/helper/shamir/"})}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Each of these packages are different and serve a different goal; some commonly\nused packages are:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/framework",children:(0,s.jsx)(n.code,{children:"sdk/framework/"})}),"\ncontains various HTTP helpers such as typing and parsing for request parameters."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/logical",children:(0,s.jsx)(n.code,{children:"sdk/logical/"})}),"\ncontains the type definitions for core and plugin interoperability, including\nrequests, responses, and the underlying storage model."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/plugin",children:(0,s.jsx)(n.code,{children:"sdk/plugin/"})}),"\ncontains the GRPC bindings for external auth and secret plugins."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/database",children:(0,s.jsx)(n.code,{children:"sdk/database/"})}),"\ncontains the same bindings but for external database plugins."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/physical",children:(0,s.jsx)(n.code,{children:"sdk/physical/"})}),"\ncontains the interface definition of a storage backend, including\nimplementations of the File and InMemory non-production backends."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/helper",children:(0,s.jsx)(n.code,{children:"sdk/helper/"})}),"\ncontains many external libraries. Some highlights are:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/helper/shamir",children:(0,s.jsx)(n.code,{children:"sdk/helper/shamir/"})}),"\nimplements Shamir's secret sharing and has been moved for external\nconsumption."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/helper/certutil",children:(0,s.jsx)(n.code,{children:"sdk/helper/certutil/"})}),"\nhas leaf and CA certificate creation code used by the PKI engine and\nthe database secrets engine."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/sdk/helper/ocsp",children:(0,s.jsx)(n.code,{children:"sdk/helper/ocsp/"})}),"\ncontains an OCSP client utilized by the cert auth method, originally\nforked from Snowflake."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Note that the SDK has a loose breakage policy: while we aim to minimize\ndisruption, the SDK firstly serves OpenBao's server and thus will be updated\nas requirements here change. As such, the SDK is versioned with a 0 major\nversion to indicate this potential lack of compatibility."}),"\n",(0,s.jsx)(n.h2,{id:"ui",children:"UI"}),"\n",(0,s.jsx)(n.p,{children:"The Web UI is built with Ember."}),"\n",(0,s.jsx)(n.h2,{id:"website",children:"Website"}),"\n",(0,s.jsxs)(n.p,{children:["The website is built ",(0,s.jsx)(n.a,{href:"https://docusaurus.io/",children:"with Docusaurus"})," and includes\ntwo main sections:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/api-docs",children:(0,s.jsx)(n.code,{children:"api-docs"})})," a hand-maintained API reference to all endpoints\nin OpenBao."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs",children:(0,s.jsx)(n.code,{children:"docs"})}),", for everything else, including information about\n",(0,s.jsx)(n.a,{href:"/docs/secrets/",children:"various"})," ",(0,s.jsx)(n.a,{href:"/docs/auth/",children:"plugins"}),", this\n",(0,s.jsx)(n.a,{href:"/docs/contributing/",children:"contributing guide"}),", and ",(0,s.jsx)(n.a,{href:"/docs/policies/",children:"various"}),"\n",(0,s.jsx)(n.a,{href:"/docs/rfcs/",children:"decisions"})," made by the TSC and the OpenBao community."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["To add a new page, create the ",(0,s.jsx)(n.code,{children:".mdx"})," file in the appropriate subfolder within\n",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/website/content/",children:(0,s.jsx)(n.code,{children:"website/content"})}),"\nand then add the page to the sidebar (if the page is under ",(0,s.jsx)(n.code,{children:"docs/"}),", then to\n",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/website/sidebars.ts",children:(0,s.jsx)(n.code,{children:"website/sidebars.ts"})}),"\nelse if the page is under ",(0,s.jsx)(n.code,{children:"api-docs/"}),", then to\n",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/website/sidebarsApi.ts",children:(0,s.jsx)(n.code,{children:"website/sidebarsApi.ts"})}),")."]}),"\n",(0,s.jsx)(n.h2,{id:"openbao-cli-server-and-plugins",children:"OpenBao CLI, server, and plugins"}),"\n",(0,s.jsx)(n.p,{children:"The remaining code is for the OpenBao CLI, server, and a few built-in plugins."}),"\n",(0,s.jsx)(n.p,{children:"At a high level, these directories are:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/audit/",children:(0,s.jsx)(n.code,{children:"audit/"})})," contains\ninterface definitions for auditing requests and responses."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/builtin/",children:(0,s.jsx)(n.code,{children:"builtin/"})})," contains\nthe builtin plugins:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/builtin/audit",children:(0,s.jsx)(n.code,{children:"builtin/audit/"})}),"\ncontains the built-in audit backends such as ",(0,s.jsx)(n.a,{href:"/docs/audit/file/",children:"file"})," or\n",(0,s.jsx)(n.a,{href:"/docs/audit/syslog/",children:"syslog"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/builtin/credential",children:(0,s.jsx)(n.code,{children:"builtin/credential/"})}),"\ncontains the built-in authentication plugins such as\n",(0,s.jsx)(n.a,{href:"/docs/auth/approle/",children:"AppRole"})," or ",(0,s.jsx)(n.a,{href:"/docs/auth/cert/",children:"cert"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/builtin/logical",children:(0,s.jsx)(n.code,{children:"builtin/logical/"})}),"\ncontains the built-in secret engines such as\n",(0,s.jsx)(n.a,{href:"/docs/secrets/pki/",children:"PKI"})," or ",(0,s.jsx)(n.a,{href:"/docs/secrets/kv/",children:"kv"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/builtin/plugin",children:(0,s.jsx)(n.code,{children:"builtin/plugin/"})}),"\ncontains a source-agnostic plugin wrapper (either using the builtin\nplugin or handling the GRPC connection to an external plugin)."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/command/",children:(0,s.jsx)(n.code,{children:"command/"})})," contains\nthe CLI interface definitions: each command is in a separate file connected\nthrough ",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/main/command/commands.go",children:(0,s.jsx)(n.code,{children:"command/commands.go"})}),".\nMany plugins reuse the same generic ",(0,s.jsx)(n.code,{children:"read"}),", ",(0,s.jsx)(n.code,{children:"write"}),", ",(0,s.jsx)(n.code,{children:"list"}),", ... commands,\nbut a few (like K/V or PKI) have plugin-specific commands. This also\nincludes Agent, Proxy, and Server configuration parsing and startup code,\nthough much of the functionality for the latter is elsewhere."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/helper/",children:(0,s.jsx)(n.code,{children:"helper/"})})," includes\nvarious internal libraries useful only in the context of OpenBao."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/http/",children:(0,s.jsx)(n.code,{children:"http/"})})," contains\nthe main server code ",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/42e77de61c145aa768ada9c1883f570e76e8708e/http/handler.go#L130-L132",children:"creating"}),"\nthe ",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/net/http#ServeMux",children:"http.ServeMux"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/internalshared/",children:(0,s.jsx)(n.code,{children:"internalshared/"})}),"\ncontains shared configuration objects used by Agent, Proxy, and Server,\naccessible to ",(0,s.jsx)(n.code,{children:"vault.Core"})," as well."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/physical/",children:(0,s.jsx)(n.code,{children:"physical/"})}),"\ncontains production quality physical storage backend implementations.\nThis currently only includes Raft."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/plugins/database/",children:(0,s.jsx)(n.code,{children:"plugins/database/"})}),"\ncontains the plugins for the database secrets engine to support creating\nshort-lived dynamic credentials for these database types."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/serviceregistration/",children:(0,s.jsx)(n.code,{children:"serviceregistration/"})}),"\ncontains helpers for supporting service registration against various\nproviders. This is only utilized by OpenBao Server."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/tree/main/vault/",children:(0,s.jsx)(n.code,{children:"vault/"})}),"\ncontains the ",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/main/vault/core.go",children:"Core"}),"\nof the server: this implements\n",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/main/vault/barrier.go",children:"barrier encryption"}),",\n",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/main/vault/identity_store.go",children:"identity storage"}),",\n",(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao/blob/main/vault/token_store.go",children:"token storage"}),",\nand many ",(0,s.jsx)(n.code,{children:"sys/"})," endpoint implementations."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Key dependencies of the server code are:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/hashicorp/go-secure-stdlib",children:(0,s.jsx)(n.code,{children:"go-secure-stdlib"})})," which\nis a collection of shared parsing and configuration utility libraries used\nby many plugins and the Core."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/go-kms-wrapping",children:(0,s.jsx)(n.code,{children:"go-kms-wrapping"})})," which\nimplements auto-unseal for various providers (such as Transit or GCP)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/hashicorp/raft",children:(0,s.jsx)(n.code,{children:"raft"})})," which implements the core Raft\nstorage backend."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/openbao/openbao-template",children:(0,s.jsx)(n.code,{children:"openbao-template"})})," which\nimplements templating for OpenBao Agent."]}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var s=i(96540);const o={},t=s.createContext(o);function a(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);