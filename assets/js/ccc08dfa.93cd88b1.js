"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5567],{99471:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var a=s(74848),t=s(28453);const i={sidebar_label:"LDAP",description:"The LDAP secret engine manages LDAP entry passwords."},c="LDAP secrets engine",r={id:"secrets/ldap",title:"LDAP secrets engine",description:"The LDAP secret engine manages LDAP entry passwords.",source:"@site/content/docs/secrets/ldap.mdx",sourceDirName:"secrets",slug:"/secrets/ldap",permalink:"/openbao/docs/secrets/ldap",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/secrets/ldap.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"LDAP",description:"The LDAP secret engine manages LDAP entry passwords."},sidebar:"docs",previous:{title:"Kubernetes",permalink:"/openbao/docs/secrets/kubernetes"},next:{title:"Overview",permalink:"/openbao/docs/secrets/pki/"}},o={},l=[{value:"Setup",id:"setup",level:2},{value:"Schemas",id:"schemas",level:3},{value:"OpenLDAP",id:"openldap",level:4},{value:"Resource access control facility (RACF)",id:"resource-access-control-facility-racf",level:4},{value:"Active directory (AD)",id:"active-directory-ad",level:4},{value:"Static credentials",id:"static-credentials",level:2},{value:"Setup",id:"setup-1",level:3},{value:"Password rotation",id:"password-rotation",level:3},{value:"Auto password rotation",id:"auto-password-rotation",level:3},{value:"Manual rotation",id:"manual-rotation",level:3},{value:"Deleting static roles",id:"deleting-static-roles",level:3},{value:"Dynamic credentials",id:"dynamic-credentials",level:2},{value:"Setup",id:"setup-2",level:3},{value:"LDIF entries",id:"ldif-entries",level:3},{value:"Active directory (AD)",id:"active-directory-ad-1",level:3},{value:"Active directory LDIF example",id:"active-directory-ldif-example",level:4},{value:"Service account Check-Out",id:"service-account-check-out",level:2},{value:"LDAP password policy",id:"ldap-password-policy",level:2},{value:"Tutorial",id:"tutorial",level:2},{value:"API",id:"api",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"ldap-secrets-engine",children:"LDAP secrets engine"}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note"}),": This engine can use external X.509 certificates as part of TLS or signature validation.\nVerifying signatures against X.509 certificates that use SHA-1 is deprecated and is no longer\nusable without a workaround. See the\n",(0,a.jsx)(n.a,{href:"/docs/deprecation/faq#q-what-is-the-impact-of-removing-support-for-x-509-certificates-with-signatures-that-use-sha-1",children:"deprecation FAQ"}),"\nfor more information."]})}),"\n",(0,a.jsx)(n.p,{children:"The LDAP secrets engine provides management of LDAP credentials as well as dynamic\ncreation of credentials. It supports integration with implementations of the LDAP\nv3 protocol, including OpenLDAP, Active Directory, and IBM Resource Access Control\nFacility (RACF)."}),"\n",(0,a.jsx)(n.p,{children:"The secrets engine has three primary features:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/secrets/ldap#static-credentials",children:"Static Credentials"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/secrets/ldap#dynamic-credentials",children:"Dynamic Credentials"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/secrets/ldap#service-account-check-out",children:"Service Account Check-Out"})}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Enable the LDAP secret engine:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ bao secrets enable ldap\n"})}),"\n",(0,a.jsxs)(n.p,{children:["By default, the secrets engine will mount at the name of the engine. To\nenable the secrets engine at a different path, use the ",(0,a.jsx)(n.code,{children:"-path"})," argument."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Configure the credentials that OpenBao uses to communicate with LDAP\nto generate passwords:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ bao write ldap/config \\\n    binddn=$USERNAME \\\n    bindpass=$PASSWORD \\\n    url=ldaps://138.91.247.105\n"})}),"\n",(0,a.jsx)(n.p,{children:"Note: it's recommended a dedicated entry management account be created specifically for OpenBao."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Rotate the root password so only OpenBao knows the credentials:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ bao write -f ldap/rotate-root\n"})}),"\n",(0,a.jsx)(n.p,{children:"Note: it's not possible to retrieve the generated password once rotated by OpenBao.\nIt's recommended a dedicated entry management account be created specifically for OpenBao."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"schemas",children:"Schemas"}),"\n",(0,a.jsx)(n.p,{children:"The LDAP Secret Engine supports three different schemas:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"openldap"})," (default)"]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"racf"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"ad"})}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"openldap",children:"OpenLDAP"}),"\n",(0,a.jsxs)(n.p,{children:["By default, the LDAP Secret Engine assumes the entry password is stored in ",(0,a.jsx)(n.code,{children:"userPassword"}),".\nThere are many object classes that provide ",(0,a.jsx)(n.code,{children:"userPassword"})," including for example:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"organization"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"organizationalUnit"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"organizationalRole"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"inetOrgPerson"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"person"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"posixAccount"})}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"resource-access-control-facility-racf",children:"Resource access control facility (RACF)"}),"\n",(0,a.jsxs)(n.p,{children:["For managing IBM's Resource Access Control Facility (RACF) security system, the secret\nengine must be configured to use the schema ",(0,a.jsx)(n.code,{children:"racf"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Generated passwords must be 8 characters or less to support RACF. The length of the\npassword can be configured using a ",(0,a.jsx)(n.a,{href:"/docs/concepts/password-policies",children:"password policy"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ bao write ldap/config \\\n\tbinddn=$USERNAME \\\n\tbindpass=$PASSWORD \\\n\turl=ldaps://138.91.247.105 \\\n\tschema=racf \\\n\tpassword_policy=racf_password_policy\n"})}),"\n",(0,a.jsx)(n.h4,{id:"active-directory-ad",children:"Active directory (AD)"}),"\n",(0,a.jsxs)(n.p,{children:["For managing Active Directory instances, the secret engine must be configured to use the\nschema ",(0,a.jsx)(n.code,{children:"ad"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ bao write ldap/config \\\n\tbinddn=$USERNAME \\\n\tbindpass=$PASSWORD \\\n\turl=ldaps://138.91.247.105 \\\n\tschema=ad\n"})}),"\n",(0,a.jsx)(n.h2,{id:"static-credentials",children:"Static credentials"}),"\n",(0,a.jsx)(n.h3,{id:"setup-1",children:"Setup"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Configure a static role that maps a name in OpenBao to an entry in LDAP.\nPassword rotation settings will be managed by this role."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ bao write ldap/static-role/lf-edge\\\n    dn='uid=lf-edge,ou=users,dc=lf-edge,dc=com' \\\n    username='openbao'\\\n    rotation_period=\"24h\"\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:'Request credentials for the "openbao" role:'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ bao read ldap/static-cred/lf-edge\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"password-rotation",children:"Password rotation"}),"\n",(0,a.jsx)(n.p,{children:"Passwords can be managed in two ways:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"automatic time based rotation"}),"\n",(0,a.jsx)(n.li,{children:"manual rotation"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"auto-password-rotation",children:"Auto password rotation"}),"\n",(0,a.jsxs)(n.p,{children:["Passwords will automatically be rotated based on the ",(0,a.jsx)(n.code,{children:"rotation_period"})," configured\nin the static role (minimum of 5 seconds). When requesting credentials for a static\nrole, the response will include the time before the next rotation (",(0,a.jsx)(n.code,{children:"ttl"}),")."]}),"\n",(0,a.jsxs)(n.p,{children:["Auto-rotation is currently only supported for static roles. The ",(0,a.jsx)(n.code,{children:"binddn"})," account used\nby OpenBao should be rotated using the ",(0,a.jsx)(n.code,{children:"rotate-root"})," endpoint to generate a password\nonly OpenBao will know."]}),"\n",(0,a.jsx)(n.h3,{id:"manual-rotation",children:"Manual rotation"}),"\n",(0,a.jsxs)(n.p,{children:["Static roles can be manually rotated using the ",(0,a.jsx)(n.code,{children:"rotate-role"})," endpoint. When manually\nrotated the rotation period will start over."]}),"\n",(0,a.jsx)(n.h3,{id:"deleting-static-roles",children:"Deleting static roles"}),"\n",(0,a.jsx)(n.p,{children:"Passwords are not rotated upon deletion of a static role. The password should be manually\nrotated prior to deleting the role or revoking access to the static role."}),"\n",(0,a.jsx)(n.h2,{id:"dynamic-credentials",children:"Dynamic credentials"}),"\n",(0,a.jsx)(n.h3,{id:"setup-2",children:"Setup"}),"\n",(0,a.jsxs)(n.p,{children:["Dynamic credentials can be configured by calling the ",(0,a.jsx)(n.code,{children:"/role/:role_name"})," endpoint:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ bao write ldap/role/dynamic-role \\\n  creation_ldif=@/path/to/creation.ldif \\\n  deletion_ldif=@/path/to/deletion.ldif \\\n  rollback_ldif=@/path/to/rollback.ldif \\\n  default_ttl=1h \\\n  max_ttl=24h\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Note: The ",(0,a.jsx)(n.code,{children:"rollback_ldif"})," argument is optional, but recommended. The statements within ",(0,a.jsx)(n.code,{children:"rollback_ldif"})," will be\nexecuted if the creation fails for any reason. This ensures any entities are removed in the event of a failure."]})}),"\n",(0,a.jsx)(n.p,{children:"To generate credentials:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ bao read ldap/creds/dynamic-role\nKey                    Value\n---                    -----\nlease_id               ldap/creds/dynamic-role/HFgd6uKaDomVMvJpYbn9q4q5\nlease_duration         1h\nlease_renewable        true\ndistinguished_names    [cn=v_token_dynamic-role_FfH2i1c4dO_1611952635,ou=users,dc=learn,dc=example]\npassword               xWMjkIFMerYttEbzfnBVZvhRQGmhpAA0yeTya8fdmDB3LXDzGrjNEPV2bCPE9CW6\nusername               v_token_testrole_FfH2i1c4dO_1611952635\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"distinguished_names"})," field is an array of DNs that are created from the ",(0,a.jsx)(n.code,{children:"creation_ldif"})," statements. If more than\none LDIF entry is included, the DN from each statement will be included in this field. Each entry in this field\ncorresponds to a single LDIF statement. No de-duplication occurs and order is maintained."]}),"\n",(0,a.jsx)(n.h3,{id:"ldif-entries",children:"LDIF entries"}),"\n",(0,a.jsxs)(n.p,{children:["User account management is provided through LDIF entries. The LDIF entries may be a base64-encoded version of the\nLDIF string. The string will be parsed and validated to ensure that it adheres to LDIF syntax. A good reference\nfor proper LDIF syntax can be found ",(0,a.jsx)(n.a,{href:"https://ldap.com/ldif-the-ldap-data-interchange-format/",children:"here"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Some important things to remember when crafting your LDIF entries:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"There should not be any trailing spaces on any line, including empty lines"}),"\n",(0,a.jsxs)(n.li,{children:["Each ",(0,a.jsx)(n.code,{children:"modify"})," block needs to be preceded with an empty line"]}),"\n",(0,a.jsxs)(n.li,{children:["Multiple modifications for a ",(0,a.jsx)(n.code,{children:"dn"})," can be defined in a single ",(0,a.jsx)(n.code,{children:"modify"})," block. Each modification needs to close\nwith a single dash (",(0,a.jsx)(n.code,{children:"-"}),")"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"active-directory-ad-1",children:"Active directory (AD)"}),"\n",(0,a.jsx)(n.p,{children:"For Active Directory, there are a few additional details that are important to remember:"}),"\n",(0,a.jsxs)(n.p,{children:["To create a user programmatically in AD, you first ",(0,a.jsx)(n.code,{children:"add"})," a user object and then ",(0,a.jsx)(n.code,{children:"modify"})," that user to provide a\npassword and enable the account."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Passwords in AD are set using the ",(0,a.jsx)(n.code,{children:"unicodePwd"})," field. This must be proceeded by two (2) colons (",(0,a.jsx)(n.code,{children:"::"}),")."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"When setting a password programmatically in AD, the following criteria must be met:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The password must be enclosed in double quotes (",(0,a.jsx)(n.code,{children:'" "'}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["The password must be in ",(0,a.jsxs)(n.a,{href:"https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/6e803168-f140-4d23-b2d3-c3a8ab5917d2",children:[(0,a.jsx)(n.code,{children:"UTF16LE"})," format"]})]}),"\n",(0,a.jsxs)(n.li,{children:["The password must be ",(0,a.jsx)(n.code,{children:"base64"}),"-encoded"]}),"\n",(0,a.jsxs)(n.li,{children:["Additional details can be found ",(0,a.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/troubleshoot/windows-server/identity/set-user-password-with-ldifde",children:"here"})]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Once a user's password has been set, it can be enabled. AD uses the ",(0,a.jsx)(n.code,{children:"userAccountControl"})," field for this purpose:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["To enable the account, set ",(0,a.jsx)(n.code,{children:"userAccountControl"})," to ",(0,a.jsx)(n.code,{children:"512"})]}),"\n",(0,a.jsxs)(n.li,{children:["You will likely also want to disable AD's password expiration for this dynamic user account. The\n",(0,a.jsx)(n.code,{children:"userAccountControl"})," value for this is: ",(0,a.jsx)(n.code,{children:"65536"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"userAccountControl"})," flags are cumulative, so to set both of the above two flags, add up the two values\n(",(0,a.jsx)(n.code,{children:"512 + 65536 = 66048"}),"): set ",(0,a.jsx)(n.code,{children:"userAccountControl"})," to ",(0,a.jsx)(n.code,{children:"66048"})]}),"\n",(0,a.jsxs)(n.li,{children:["See ",(0,a.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/troubleshoot/windows-server/identity/useraccountcontrol-manipulate-account-properties#property-flag-descriptions",children:"here"}),"\nfor details on ",(0,a.jsx)(n.code,{children:"userAccountControl"})," flags"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"sAMAccountName"})," is a common field when working with AD users. It is used to provide compatibility with legacy\nWindows NT systems and has a limit of 20 characters. Keep this in mind when defining your ",(0,a.jsx)(n.code,{children:"username_template"}),".\nSee ",(0,a.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/windows/win32/adschema/a-samaccountname",children:"here"})," for additional details."]}),"\n",(0,a.jsxs)(n.p,{children:["Since the default ",(0,a.jsx)(n.code,{children:"username_template"})," is longer than 20 characters which follows the template of ",(0,a.jsx)(n.code,{children:"v_{{.DisplayName}}_{{.RoleName}}_{{random 10}}_{{unix_time}}"}),", we recommend customising the ",(0,a.jsx)(n.code,{children:"username_template"})," on the role configuration to generate accounts with names less than 20 characters. Please refer to the ",(0,a.jsx)(n.a,{href:"/docs/concepts/username-templating",children:"username templating document"})," for more information."]}),"\n",(0,a.jsxs)(n.p,{children:["With regard to adding dynamic users to groups, AD doesn't let you directly modify a user's ",(0,a.jsx)(n.code,{children:"memberOf"})," attribute.\nThe ",(0,a.jsx)(n.code,{children:"member"})," attribute of a group and ",(0,a.jsx)(n.code,{children:"memberOf"})," attribute of a user are\n",(0,a.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/windows/win32/ad/linked-attributes",children:"linked attributes"}),". Linked attributes are\nforward link/back link pairs, with the forward link able to be modified. In the case of AD group membership, the\ngroup's ",(0,a.jsx)(n.code,{children:"member"})," attribute is the forward link. In order to add a newly-created dynamic user to a group, we also\nneed to issue a ",(0,a.jsx)(n.code,{children:"modify"})," request to the desired group and update the group membership with the new user."]}),"\n",(0,a.jsx)(n.h4,{id:"active-directory-ldif-example",children:"Active directory LDIF example"}),"\n",(0,a.jsxs)(n.p,{children:["The various ",(0,a.jsx)(n.code,{children:"*_ldif"})," parameters are templates that use the ",(0,a.jsx)(n.a,{href:"https://golang.org/pkg/text/template/",children:"go template"}),"\nlanguage. A complete LDIF example for creating an Active Directory user account is provided here for reference:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ldif",children:'dn: CN={{.Username}},OU=OpenBao,DC=adtesting,DC=lab\nchangetype: add\nobjectClass: top\nobjectClass: person\nobjectClass: organizationalPerson\nobjectClass: user\nuserPrincipalName: {{.Username}}@adtesting.lab\nsAMAccountName: {{.Username}}\n\ndn: CN={{.Username}},OU=OpenBao,DC=adtesting,DC=lab\nchangetype: modify\nreplace: unicodePwd\nunicodePwd::{{ printf "%q" .Password | utf16le | base64 }}\n-\nreplace: userAccountControl\nuserAccountControl: 66048\n-\n\ndn: CN=test-group,OU=OpenBao,DC=adtesting,DC=lab\nchangetype: modify\nadd: member\nmember: CN={{.Username}},OU=OpenBao,DC=adtesting,DC=lab\n-\n'})}),"\n",(0,a.jsx)(n.h2,{id:"service-account-check-out",children:"Service account Check-Out"}),"\n",(0,a.jsx)(n.p,{children:'Service account check-out provides a library of service accounts that can be checked out\nby a person or by machines. OpenBao will automatically rotate the password each time a\nservice account is checked in. Service accounts can be voluntarily checked in, or OpenBao\nwill check them in when their lending period (or, "ttl", in OpenBao\'s language) ends.'}),"\n",(0,a.jsxs)(n.p,{children:["The service account check-out functionality works with various ",(0,a.jsx)(n.a,{href:"/api-docs/secret/ldap#schema",children:"schemas"}),",\nincluding OpenLDAP, Active Directory, and RACF. In the following usage example, the secrets\nengine is configured to manage a library of service accounts in an Active Directory instance."]}),"\n",(0,a.jsx)(n.p,{children:"First we'll need to enable the LDAP secrets engine and tell it how to securely connect\nto an AD server."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao secrets enable ldap\nSuccess! Enabled the ad secrets engine at: ldap/\n\n$ bao write ldap/config \\\n    binddn=$USERNAME \\\n    bindpass=$PASSWORD \\\n    url=ldaps://138.91.247.105 \\\n    userdn='dc=example,dc=com'\n"})}),"\n",(0,a.jsx)(n.p,{children:"Our next step is to designate a set of service accounts for check-out."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao write ldap/library/accounting-team \\\n    service_account_names=fizz@example.com,buzz@example.com \\\n    ttl=10h \\\n    max_ttl=20h \\\n    disable_check_in_enforcement=false\n"})}),"\n",(0,a.jsxs)(n.p,{children:["In this example, the service account names of ",(0,a.jsx)(n.code,{children:"fizz@example.com"})," and ",(0,a.jsx)(n.code,{children:"buzz@example.com"})," have\nalready been created on the remote AD server. They've been set aside solely for OpenBao to handle.\nThe ",(0,a.jsx)(n.code,{children:"ttl"})," is how long each check-out will last before OpenBao checks in a service account,\nrotating its password during check-in. The ",(0,a.jsx)(n.code,{children:"max_ttl"})," is the maximum amount of time it can live\nif it's renewed. These default to ",(0,a.jsx)(n.code,{children:"24h"}),", and both use ",(0,a.jsx)(n.a,{href:"/docs/concepts/duration-format",children:"duration format strings"}),".\nAlso by default, a service account must be checked in by the same OpenBao entity or client token that\nchecked it out. However, if this behavior causes problems, set ",(0,a.jsx)(n.code,{children:"disable_check_in_enforcement=true"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"When a library of service accounts has been created, view their status at any time to see if they're\navailable or checked out."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao read ldap/library/accounting-team/status\nKey                 Value\n---                 -----\nbuzz@example.com    map[available:true]\nfizz@example.com    map[available:true]\n"})}),"\n",(0,a.jsx)(n.p,{children:"To check out any service account that's available, simply execute:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao write -f ldap/library/accounting-team/check-out\nKey                     Value\n---                     -----\nlease_id                ldap/library/accounting-team/check-out/EpuS8cX7uEsDzOwW9kkKOyGW\nlease_duration          10h\nlease_renewable         true\npassword                ?@09AZKh03hBORZPJcTDgLfntlHqxLy29tcQjPVThzuwWAx/Twx4a2ZcRQRqrZ1w\nservice_account_name    fizz@example.com\n"})}),"\n",(0,a.jsxs)(n.p,{children:["If the default ",(0,a.jsx)(n.code,{children:"ttl"})," for the check-out is higher than needed, set the check-out to last\nfor a shorter time by using:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao write ldap/library/accounting-team/check-out ttl=30m\nKey                     Value\n---                     -----\nlease_id                ldap/library/accounting-team/check-out/gMonJ2jB6kYs6d3Vw37WFDCY\nlease_duration          30m\nlease_renewable         true\npassword                ?@09AZerLLuJfEMbRqP+3yfQYDSq6laP48TCJRBJaJu/kDKLsq9WxL9szVAvL/E1\nservice_account_name    buzz@example.com\n"})}),"\n",(0,a.jsxs)(n.p,{children:['This can be a nice way to say, "Although I ',(0,a.jsx)(n.em,{children:"can"})," have a check-out for 24 hours, if I\nhaven't checked it in after 30 minutes, I forgot or I'm a dead instance, so you can just\ncheck it back in.\""]}),"\n",(0,a.jsx)(n.p,{children:"If no service accounts are available for check-out, OpenBao will return a 400 Bad Request."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao write -f ldap/library/accounting-team/check-out\nError writing data to ldap/library/accounting-team/check-out: Error making API request.\n\nURL: POST http://localhost:8200/v1/ldap/library/accounting-team/check-out\nCode: 400. Errors:\n\n* No service accounts available for check-out.\n"})}),"\n",(0,a.jsx)(n.p,{children:"To extend a check-out, renew its lease."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao lease renew ldap/library/accounting-team/check-out/0C2wmeaDmsToVFc0zDiX9cMq\nKey                Value\n---                -----\nlease_id           ldap/library/accounting-team/check-out/0C2wmeaDmsToVFc0zDiX9cMq\nlease_duration     10h\nlease_renewable    true\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Renewing a check-out means its current password will live longer, since passwords are rotated\nanytime a password is ",(0,a.jsx)(n.em,{children:"checked in"})," either by a caller, or by OpenBao because the check-out ",(0,a.jsx)(n.code,{children:"ttl"}),"\nends."]}),"\n",(0,a.jsx)(n.p,{children:"To check a service account back in for others to use, call:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao write -f ldap/library/accounting-team/check-in\nKey          Value\n---          -----\ncheck_ins    [fizz@example.com]\n"})}),"\n",(0,a.jsx)(n.p,{children:"Most of the time this will just work, but if multiple service accounts are checked out by the same\ncaller, OpenBao will need to know which one(s) to check in."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao write ldap/library/accounting-team/check-in service_account_names=fizz@example.com\nKey          Value\n---          -----\ncheck_ins    [fizz@example.com]\n"})}),"\n",(0,a.jsxs)(n.p,{children:["To perform a check-in, OpenBao verifies that the caller ",(0,a.jsx)(n.em,{children:"should"})," be able to check in a given service account.\nTo do this, OpenBao looks for either the same ",(0,a.jsx)(n.a,{href:"/tutorials/auth-methods/identity",children:"entity ID"}),"\nused to check out the service account, or the same client token."]}),"\n",(0,a.jsxs)(n.p,{children:["If a caller is unable to check in a service account, or simply doesn't try,\nOpenBao will check it back in automatically when the ",(0,a.jsx)(n.code,{children:"ttl"})," expires. However, if that is too long,\nservice accounts can be forcibly checked in by a highly privileged user through:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao write -f ldap/library/manage/accounting-team/check-in\nKey          Value\n---          -----\ncheck_ins    [fizz@example.com]\n"})}),"\n",(0,a.jsx)(n.p,{children:"Or, alternatively, revoking the secret's lease has the same effect."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell-session",children:"$ bao lease revoke ldap/library/accounting-team/check-out/PvBVG0m7pEg2940Cb3Jw3KpJ\nAll revocation operations queued successfully!\n"})}),"\n",(0,a.jsx)(n.h2,{id:"ldap-password-policy",children:"LDAP password policy"}),"\n",(0,a.jsx)(n.p,{children:"The LDAP secret engine does not hash or encrypt passwords prior to modifying\nvalues in LDAP. This behavior can cause plaintext passwords to be stored in LDAP."}),"\n",(0,a.jsx)(n.p,{children:"To avoid having plaintext passwords stored, the LDAP server should be configured\nwith an LDAP password policy (ppolicy, not to be confused with an OpenBao password\npolicy). A ppolicy can enforce rules such as hashing plaintext passwords by default."}),"\n",(0,a.jsxs)(n.p,{children:["The following is an example of an LDAP password policy to enforce hashing on the\ndata information tree (DIT) ",(0,a.jsx)(n.code,{children:"dc=openbao,dc=com"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"dn: cn=module{0},cn=config\nchangetype: modify\nadd: olcModuleLoad\nolcModuleLoad: ppolicy\n\ndn: olcOverlay={2}ppolicy,olcDatabase={1}mdb,cn=config\nchangetype: add\nobjectClass: olcPPolicyConfig\nobjectClass: olcOverlayConfig\nolcOverlay: {2}ppolicy\nolcPPolicyDefault: cn=default,ou=pwpolicies,dc=openbao,dc=com\nolcPPolicyForwardUpdates: FALSE\nolcPPolicyHashCleartext: TRUE\nolcPPolicyUseLockout: TRUE\n"})}),"\n",(0,a.jsx)(n.h2,{id:"tutorial",children:"Tutorial"}),"\n",(0,a.jsxs)(n.p,{children:["Refer to the ",(0,a.jsx)(n.a,{href:"/tutorials/secrets-management/openldap",children:"LDAP Secrets Engine"}),"\ntutorial to learn how to configure and use the LDAP secrets engine."]}),"\n",(0,a.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,a.jsxs)(n.p,{children:["The LDAP secrets engine has a full HTTP API. Please see the ",(0,a.jsx)(n.a,{href:"/api-docs/secret/ldap",children:"LDAP secrets engine API docs"}),"\nfor more details."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>r});var a=s(96540);const t={},i=a.createContext(t);function c(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);