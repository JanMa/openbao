"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7864],{73103:(e,o,i)=>{i.r(o),i.d(o,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var n=i(74848),t=i(28453);const s={description:"OIDC provider configuration for Google"},r=void 0,c={id:"auth/jwt/oidc-providers/google",title:"google",description:"OIDC provider configuration for Google",source:"@site/content/docs/auth/jwt/oidc-providers/google.mdx",sourceDirName:"auth/jwt/oidc-providers",slug:"/auth/jwt/oidc-providers/google",permalink:"/openbao/docs/auth/jwt/oidc-providers/google",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/auth/jwt/oidc-providers/google.mdx",tags:[],version:"current",frontMatter:{description:"OIDC provider configuration for Google"},sidebar:"docs",previous:{title:"gitlab",permalink:"/openbao/docs/auth/jwt/oidc-providers/gitlab"},next:{title:"ibmisam",permalink:"/openbao/docs/auth/jwt/oidc-providers/ibmisam"}},a={},l=[{value:"Google",id:"google",level:2},{value:"Optional google-specific configuration",id:"optional-google-specific-configuration",level:3},{value:"Setup",id:"setup",level:4},{value:"Configuration",id:"configuration",level:4},{value:"Role",id:"role",level:4}];function d(e){const o={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.h2,{id:"google",children:"Google"}),"\n",(0,n.jsxs)(o.p,{children:["Main reference: ",(0,n.jsx)(o.a,{href:"https://developers.google.com/identity/protocols/OAuth2",children:"Using OAuth 2.0 to Access Google APIs"})]}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsxs)(o.li,{children:["Visit the ",(0,n.jsx)(o.a,{href:"https://console.developers.google.com",children:"Google API Console"}),"."]}),"\n",(0,n.jsx)(o.li,{children:"Create or a select a project."}),"\n",(0,n.jsx)(o.li,{children:"Navigate to Menu > APIs & Services"}),"\n",(0,n.jsx)(o.li,{children:"Create a new credential via Credentials > Create Credentials > OAuth Client ID."}),"\n",(0,n.jsx)(o.li,{children:"Configure the OAuth Consent Screen. Application Name is required. Save."}),"\n",(0,n.jsx)(o.li,{children:'Select application type: "Web Application".'}),"\n",(0,n.jsxs)(o.li,{children:["Configure Authorized ",(0,n.jsx)(o.a,{href:"/docs/auth/jwt#redirect-uris",children:"Redirect URIs"}),"."]}),"\n",(0,n.jsx)(o.li,{children:"Save client ID and secret."}),"\n"]}),"\n",(0,n.jsx)(o.h3,{id:"optional-google-specific-configuration",children:"Optional google-specific configuration"}),"\n",(0,n.jsxs)(o.p,{children:["Google-specific configuration is available when using Google as an identity provider from the\nOpenBao JWT/OIDC auth method. The configuration allows OpenBao to obtain Google Workspace group membership and\nuser information during the JWT/OIDC authentication flow. The group membership obtained from Google Workspace\nmay be used for Identity group alias association. The user information obtained from Google Workspace can be\nused to copy claims data into resulting auth token and alias metadata via ",(0,n.jsx)(o.a,{href:"/api-docs/auth/jwt#claim_mappings",children:"claim_mappings"}),"."]}),"\n",(0,n.jsx)(o.h4,{id:"setup",children:"Setup"}),"\n",(0,n.jsx)(o.p,{children:"To set up the Google-specific handling, you'll need:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["A Google Workspace account with the ",(0,n.jsx)(o.a,{href:"https://support.google.com/a/answer/2405986?hl=en",children:"super admin role"}),"\nfor granting domain-wide delegation API client access."]}),"\n",(0,n.jsxs)(o.li,{children:["The ability to create a service account in ",(0,n.jsx)(o.a,{href:"https://console.developers.google.com/iam-admin/serviceaccounts",children:"Google Cloud Platform"}),"."]}),"\n",(0,n.jsxs)(o.li,{children:["To enable the ",(0,n.jsx)(o.a,{href:"https://console.developers.google.com/apis/api/admin.googleapis.com/overview",children:"Admin SDK API"}),"."]}),"\n",(0,n.jsxs)(o.li,{children:["An OAuth 2.0 application with an ",(0,n.jsx)(o.a,{href:"https://support.google.com/cloud/answer/10311615#user-type",children:"internal user type"}),".\nWe ",(0,n.jsx)(o.strong,{children:"do not"})," recommend using an external user type since it would allow ",(0,n.jsx)(o.em,{children:"any user"})," with a\nGoogle account to authenticate with OpenBao."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["The Google-specific handling that's used to fetch Google Workspace groups and user information in OpenBao uses\nGoogle Workspace Domain-Wide Delegation of Authority for authentication and authorization. You need to follow\n",(0,n.jsx)(o.strong,{children:"all steps"})," in the ",(0,n.jsx)(o.a,{href:"https://developers.google.com/workspace/guides/create-credentials#service-account",children:"guide"}),"\nto obtain the key file for a Google service account capable of making requests to the Google Workspace\n",(0,n.jsx)(o.a,{href:"https://developers.google.com/admin-sdk/directory/v1/guides/manage-users",children:"User Accounts"})," and\n",(0,n.jsx)(o.a,{href:"https://developers.google.com/admin-sdk/directory/v1/guides/manage-groups",children:"Groups"})," APIs."]}),"\n",(0,n.jsxs)(o.p,{children:["In ",(0,n.jsx)(o.strong,{children:"step 11"})," within the section titled\n",(0,n.jsx)(o.a,{href:"https://developers.google.com/workspace/guides/create-credentials#optional_set_up_domain-wide_delegation_for_a_service_account",children:"Optional: Set up domain-wide delegation for a service account"}),",\nthe only OAuth scopes that should be granted are:"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.code,{children:"https://www.googleapis.com/auth/admin.directory.group.readonly"})}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.code,{children:"https://www.googleapis.com/auth/admin.directory.user.readonly"})}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["~> This is an ",(0,n.jsx)(o.strong,{children:"important security step"})," in order to give the service account the least set of privileges\nthat enable the feature."]}),"\n",(0,n.jsx)(o.h4,{id:"configuration",children:"Configuration"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"provider"})," ",(0,n.jsx)(o.code,{children:"(string: <required>)"}),' - Name of the provider. Must be set to "gsuite".']}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"gsuite_service_account"})," ",(0,n.jsx)(o.code,{children:"(string: <required>)"})," - Either the path to or the contents of a Google service\naccount key file in JSON format. If given as a file path, it must refer to a file that's readable on\nthe host that OpenBao is running on. If given directly as JSON contents, the JSON must be properly escaped."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"gsuite_admin_impersonate"})," ",(0,n.jsx)(o.code,{children:"(string: <required>)"})," - Email address of a Google Workspace admin to impersonate."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"fetch_groups"})," ",(0,n.jsx)(o.code,{children:"(bool: false)"})," - If set to true, groups will be fetched from Google Workspace."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"fetch_user_info"})," ",(0,n.jsx)(o.code,{children:"(bool: false)"})," - If set to true, user info will be fetched from Google Workspace using the configured ",(0,n.jsx)(o.a,{href:"#user_custom_schemas",children:"user_custom_schemas"}),"."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"groups_recurse_max_depth"})," ",(0,n.jsx)(o.code,{children:"(int: <optional>)"})," - Group membership recursion max depth. Defaults to 0, which means don't recurse."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"user_custom_schemas"})," ",(0,n.jsx)(o.code,{children:"(string: <optional>)"})," - Comma-separated list of Google Workspace ",(0,n.jsx)(o.a,{href:"https://developers.google.com/admin-sdk/directory/v1/guides/manage-schemas",children:"custom schemas"}),".\nValues set for Google Workspace users using custom schema fields will be fetched and made available as claims that can be used with ",(0,n.jsx)(o.a,{href:"/api-docs/auth/jwt#claim_mappings",children:"claim_mappings"}),". Required if ",(0,n.jsx)(o.a,{href:"#fetch_user_info",children:"fetch_user_info"})," is set to true."]}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"Example configuration:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{children:'bao write auth/oidc/config -<<EOF\n{\n    "oidc_discovery_url": "https://accounts.google.com",\n    "oidc_client_id": "your_client_id",\n    "oidc_client_secret": "your_client_secret",\n    "default_role": "your_default_role",\n    "provider_config": {\n        "provider": "gsuite",\n        "gsuite_service_account": "/path/to/service-account.json",\n        "gsuite_admin_impersonate": "admin@gsuitedomain.com",\n        "fetch_groups": true,\n        "fetch_user_info": true,\n        "groups_recurse_max_depth": 5,\n        "user_custom_schemas": "Education,Preferences"\n    }\n}\nEOF\n'})}),"\n",(0,n.jsx)(o.h4,{id:"role",children:"Role"}),"\n",(0,n.jsxs)(o.p,{children:["The ",(0,n.jsx)(o.a,{href:"/api-docs/auth/jwt#user_claim",children:"user_claim"})," value of the role must be set to\none of either ",(0,n.jsx)(o.code,{children:"sub"})," or ",(0,n.jsx)(o.code,{children:"email"})," for the Google Workspace group and user information\nqueries to succeed."]}),"\n",(0,n.jsx)(o.p,{children:"Example role:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{children:'bao write auth/oidc/role/your_default_role \\\n    allowed_redirect_uris="http://localhost:8200/ui/vault/auth/oidc/oidc/callback,http://localhost:8250/oidc/callback" \\\n    user_claim="sub" \\\n    groups_claim="groups" \\\n    claim_mappings="/Education/graduation_date"="graduation_date" \\\n    claim_mappings="/Preferences/shirt_size"="shirt_size"\n'})})]})}function h(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},28453:(e,o,i)=>{i.d(o,{R:()=>r,x:()=>c});var n=i(96540);const t={},s=n.createContext(t);function r(e){const o=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function c(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(s.Provider,{value:o},e.children)}}}]);