"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7039],{50160:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var s=t(74848),i=t(28453);const r={sidebar_label:"Setup and Usage",description:"The PKI secrets engine for OpenBao generates TLS certificates."},a="PKI secrets engine - setup and usage",c={id:"secrets/pki/setup",title:"PKI secrets engine - setup and usage",description:"The PKI secrets engine for OpenBao generates TLS certificates.",source:"@site/content/docs/secrets/pki/setup.mdx",sourceDirName:"secrets/pki",slug:"/secrets/pki/setup",permalink:"/openbao/docs/secrets/pki/setup",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/secrets/pki/setup.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"Setup and Usage",description:"The PKI secrets engine for OpenBao generates TLS certificates."},sidebar:"docs",previous:{title:"Overview",permalink:"/openbao/docs/secrets/pki/"},next:{title:"Quick Start - Root CA Setup",permalink:"/openbao/docs/secrets/pki/quick-start-root-ca"}},o={},l=[{value:"Setup",id:"setup",level:2},{value:"Usage",id:"usage",level:2},{value:"API",id:"api",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"pki-secrets-engine---setup-and-usage",children:"PKI secrets engine - setup and usage"}),"\n",(0,s.jsx)(n.p,{children:"This document provides a brief overview of the setup and usage of the PKI\nSecrets Engine."}),"\n",(0,s.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(n.p,{children:"Most secrets engines must be configured in advance before they can perform their\nfunctions. These steps are usually completed by an operator or configuration\nmanagement tool."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Enable the PKI secrets engine:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"$ bao secrets enable pki\nSuccess! Enabled the pki secrets engine at: pki/\n"})}),"\n",(0,s.jsxs)(n.p,{children:["By default, the secrets engine will mount at the name of the engine. To\nenable the secrets engine at a different path, use the ",(0,s.jsx)(n.code,{children:"-path"})," argument."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Increase the TTL by tuning the secrets engine. The default value of 30 days may be too short, so increase it to 1 year:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"$ bao secrets tune -max-lease-ttl=8760h pki\nSuccess! Tuned the secrets engine at: pki/\n"})}),"\n",(0,s.jsx)(n.p,{children:"Note that individual roles can restrict this value to be shorter on a\nper-certificate basis. This just configures the global maximum for this\nsecrets engine."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Configure a CA certificate and private key. OpenBao can accept an existing key\npair, or it can generate its own self-signed root. In general, we recommend\nmaintaining your root CA outside of OpenBao and providing OpenBao a signed\nintermediate CA."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"$ bao write pki/root/generate/internal \\\n    common_name=my-website.com \\\n    ttl=8760h\n\nKey              Value\n---              -----\ncertificate      -----BEGIN CERTIFICATE-----...\nexpiration       1536807433\nissuing_ca       -----BEGIN CERTIFICATE-----...\nserial_number    7c:f1:fb:2c:6e:4d:99:0e:82:1b:08:0a:81:ed:61:3e:1d:fa:f5:29\n"})}),"\n",(0,s.jsx)(n.p,{children:"The returned certificate is purely informative. The private key is safely\nstored internally in OpenBao."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Update the CRL location and issuing certificates. These values can be updated\nin the future."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:'$ bao write pki/config/urls \\\n    issuing_certificates="http://127.0.0.1:8200/v1/pki/ca" \\\n    crl_distribution_points="http://127.0.0.1:8200/v1/pki/crl"\nSuccess! Data written to: pki/config/urls\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Configure a role that maps a name in OpenBao to a procedure for generating a\ncertificate. When users or machines generate credentials, they are generated\nagainst this role:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"$ bao write pki/roles/example-dot-com \\\n    allowed_domains=my-website.com \\\n    allow_subdomains=true \\\n    max_ttl=72h\nSuccess! Data written to: pki/roles/example-dot-com\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.p,{children:"After the secrets engine is configured and a user/machine has an OpenBao token with\nthe proper permission, it can generate credentials."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Generate a new credential by writing to the ",(0,s.jsx)(n.code,{children:"/issue"})," endpoint with the name\nof the role:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"$ bao write pki/issue/example-dot-com \\\n    common_name=www.my-website.com\n\nKey                 Value\n---                 -----\ncertificate         -----BEGIN CERTIFICATE-----...\nissuing_ca          -----BEGIN CERTIFICATE-----...\nprivate_key         -----BEGIN RSA PRIVATE KEY-----...\nprivate_key_type    rsa\nserial_number       1d:2e:c6:06:45:18:60:0e:23:d6:c5:17:43:c0:fe:46:ed:d1:50:be\n"})}),"\n",(0,s.jsx)(n.p,{children:"The output will include a dynamically generated private key and certificate\nwhich corresponds to the given role and expires in 72h (as dictated by our\nrole definition). The issuing CA and trust chain is also returned for\nautomation simplicity."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,s.jsxs)(n.p,{children:["The PKI secrets engine has a full HTTP API. Please see the\n",(0,s.jsx)(n.a,{href:"/api-docs/secret/pki",children:"PKI secrets engine API"})," for more\ndetails."]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var s=t(96540);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);