"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6777],{33682:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var i=s(74848),r=s(28453);const t={sidebar_label:"LDAP",description:'The "ldap" auth method allows users to authenticate with OpenBao using LDAP\ncredentials.'},o="LDAP auth method",a={id:"auth/ldap",title:"LDAP auth method",description:'The "ldap" auth method allows users to authenticate with OpenBao using LDAP\ncredentials.',source:"@site/content/docs/auth/ldap.mdx",sourceDirName:"auth",slug:"/auth/ldap",permalink:"/docs/auth/ldap",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/auth/ldap.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"LDAP",description:'The "ldap" auth method allows users to authenticate with OpenBao using LDAP\ncredentials.'},sidebar:"docs",previous:{title:"Kubernetes",permalink:"/docs/auth/kubernetes"},next:{title:"Overview",permalink:"/docs/auth/login-mfa/"}},c={},l=[{value:"A note on escaping",id:"a-note-on-escaping",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Via the CLI",id:"via-the-cli",level:3},{value:"Via the API",id:"via-the-api",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Connection parameters",id:"connection-parameters",level:3},{value:"Binding parameters",id:"binding-parameters",level:3},{value:"Binding - authenticated search",id:"binding---authenticated-search",level:4},{value:"Binding - anonymous search",id:"binding---anonymous-search",level:4},{value:"Alias dereferencing",id:"alias-dereferencing",level:4},{value:"Binding - user principal name (AD)",id:"binding---user-principal-name-ad",level:4},{value:"Group membership resolution",id:"group-membership-resolution",level:3},{value:"Other",id:"other",level:3},{value:"Examples:",id:"examples",level:2},{value:"Scenario 1",id:"scenario-1",level:3},{value:"Scenario 2",id:"scenario-2",level:3},{value:"Scenario 3",id:"scenario-3",level:3},{value:"LDAP group -&gt; policy mapping",id:"ldap-group---policy-mapping",level:2},{value:"Note on policy mapping",id:"note-on-policy-mapping",level:2},{value:"User lockout",id:"user-lockout",level:2},{value:"API",id:"api",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"ldap-auth-method",children:"LDAP auth method"}),"\n",(0,i.jsxs)(n.p,{children:["~> ",(0,i.jsx)(n.strong,{children:"Note"}),": This engine can use external X.509 certificates as part of TLS or signature validation.\nVerifying signatures against X.509 certificates that use SHA-1 is deprecated and is no longer\nusable without a workaround. See the\n",(0,i.jsx)(n.a,{href:"/docs/deprecation/faq#q-what-is-the-impact-of-removing-support-for-x-509-certificates-with-signatures-that-use-sha-1",children:"deprecation FAQ"}),"\nfor more information."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ldap"})," auth method allows authentication using an existing LDAP\nserver and user/password credentials. This allows OpenBao to be integrated\ninto environments using LDAP without duplicating the user/pass configuration\nin multiple places."]}),"\n",(0,i.jsxs)(n.p,{children:["The mapping of groups and users in LDAP to OpenBao policies is managed by using\nthe ",(0,i.jsx)(n.code,{children:"users/"})," and ",(0,i.jsx)(n.code,{children:"groups/"})," paths."]}),"\n",(0,i.jsx)(n.h2,{id:"a-note-on-escaping",children:"A note on escaping"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"It is up to the administrator"})," to provide properly escaped DNs. This\nincludes the user DN, bind DN for search, and so on."]}),"\n",(0,i.jsx)(n.p,{children:"The only DN escaping performed by this method is on usernames given at login\ntime when they are inserted into the final bind DN, and uses escaping rules\ndefined in RFC 4514."}),"\n",(0,i.jsx)(n.p,{children:"Additionally, Active Directory has escaping rules that differ slightly from the\nRFC; in particular it requires escaping of '#' regardless of position in the DN\n(the RFC only requires it to be escaped when it is the first character), and\n'=', which the RFC indicates can be escaped with a backslash, but does not\ncontain in its set of required escapes. If you are using Active Directory and\nthese appear in your usernames, please ensure that they are escaped, in\naddition to being properly escaped in your configured DNs."}),"\n",(0,i.jsxs)(n.p,{children:["For reference, see ",(0,i.jsx)(n.a,{href:"https://www.ietf.org/rfc/rfc4514.txt",children:"RFC 4514"})," and this\n",(0,i.jsx)(n.a,{href:"http://social.technet.microsoft.com/wiki/contents/articles/5312.active-directory-characters-to-escape.aspx",children:"TechNet post on characters to escape in Active\nDirectory"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsx)(n.h3,{id:"via-the-cli",children:"Via the CLI"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao login -method=ldap username=mitchellh\nPassword (will be hidden):\nSuccessfully authenticated! The policies that are associated\nwith this token are listed below:\n\nadmins\n"})}),"\n",(0,i.jsx)(n.h3,{id:"via-the-api",children:"Via the API"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:'$ curl \\\n    --request POST \\\n    --data \'{"password": "foo"}\' \\\n    http://127.0.0.1:8200/v1/auth/ldap/login/mitchellh\n'})}),"\n",(0,i.jsx)(n.p,{children:"The response will be in JSON. For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'{\n  "lease_id": "",\n  "renewable": false,\n  "lease_duration": 0,\n  "data": null,\n  "auth": {\n    "client_token": "c4f280f6-fdb2-18eb-89d3-589e2e834cdb",\n    "policies": [\n      "admins"\n    ],\n    "metadata": {\n      "username": "mitchellh"\n    },\n    "lease_duration": 0,\n    "renewable": false\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Auth methods must be configured in advance before users or machines can\nauthenticate. These steps are usually completed by an operator or configuration\nmanagement tool."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Enable the ldap auth method:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"$ bao auth enable ldap\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Configure connection details for your LDAP server, information on how to\nauthenticate users, and instructions on how to query for group membership. The\nconfiguration options are categorized and detailed below."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"connection-parameters",children:"Connection parameters"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"url"})," (string, required) - The LDAP server to connect to. Examples: ",(0,i.jsx)(n.code,{children:"ldap://ldap.myorg.com"}),", ",(0,i.jsx)(n.code,{children:"ldaps://ldap.myorg.com:636"}),". This can also be a comma-delineated list of URLs, e.g. ",(0,i.jsx)(n.code,{children:"ldap://ldap.myorg.com,ldaps://ldap.myorg.com:636"}),", in which case the servers will be tried in-order if there are errors during the connection process."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"starttls"})," (bool, optional) - If true, issues a ",(0,i.jsx)(n.code,{children:"StartTLS"})," command after establishing an unencrypted connection."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"insecure_tls"})," - (bool, optional) - If true, skips LDAP server SSL certificate verification - insecure, use with caution!"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"certificate"})," - (string, optional) - CA certificate to use when verifying LDAP server certificate, must be x509 PEM encoded."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"client_tls_cert"})," - (string, optional) - Client certificate to provide to the LDAP server, must be x509 PEM encoded."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"client_tls_key"})," - (string, optional) - Client certificate key to provide to the LDAP server, must be x509 PEM encoded."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"binding-parameters",children:"Binding parameters"}),"\n",(0,i.jsxs)(n.p,{children:["There are two alternate methods of resolving the user object used to authenticate the end user: ",(0,i.jsx)(n.em,{children:"Search"})," or ",(0,i.jsx)(n.em,{children:"User Principal Name"}),". When using ",(0,i.jsx)(n.em,{children:"Search"}),", the bind can be either anonymous or authenticated. User Principal Name is a method of specifying users supported by Active Directory. More information on UPN can be found ",(0,i.jsx)(n.a,{href:"https://msdn.microsoft.com/en-us/library/ms677605(v=vs.85).aspx#userPrincipalName",children:"here"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"binding---authenticated-search",children:"Binding - authenticated search"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"binddn"})," (string, optional) - Distinguished name of object to bind when performing user and group search. Example: ",(0,i.jsx)(n.code,{children:"cn=openbao,ou=Users,dc=example,dc=com"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bindpass"})," (string, optional) - Password to use along with ",(0,i.jsx)(n.code,{children:"binddn"})," when performing user search."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userdn"})," (string, optional) - Base DN under which to perform user search. Example: ",(0,i.jsx)(n.code,{children:"ou=Users,dc=example,dc=com"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userattr"})," (string, optional) - Attribute on user attribute object matching the username passed when authenticating. Examples: ",(0,i.jsx)(n.code,{children:"sAMAccountName"}),", ",(0,i.jsx)(n.code,{children:"cn"}),", ",(0,i.jsx)(n.code,{children:"uid"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userfilter"})," (string, optional) - Go template used to construct a ldap user search filter. The template can access the following context variables: [",(0,i.jsx)(n.code,{children:"UserAttr"}),", ",(0,i.jsx)(n.code,{children:"Username"}),"]. The default userfilter is ",(0,i.jsx)(n.code,{children:"({{.UserAttr}}={{.Username}})"})," or ",(0,i.jsx)(n.code,{children:"(userPrincipalName={{.Username}}@UPNDomain)"})," if the ",(0,i.jsx)(n.code,{children:"upndomain"})," parameter is set. The user search filter can be used to restrict what user can attempt to log in. For example, to limit login to users that are not contractors, you could write ",(0,i.jsx)(n.code,{children:"(&(objectClass=user)({{.UserAttr}}={{.Username}})(!(employeeType=Contractor)))"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["~> When specifying a ",(0,i.jsx)(n.code,{children:"userfilter"}),", either the templated value ",(0,i.jsx)(n.code,{children:"{{.UserAttr}}"})," or\nthe literal value that matches ",(0,i.jsx)(n.code,{children:"userattr"})," should be present in the filter to\nensure that the search returns a unique result that takes ",(0,i.jsx)(n.code,{children:"userattr"})," into\nconsideration for entity alias mapping purposes and avoid possible collisions on login."]}),"\n",(0,i.jsx)(n.h4,{id:"binding---anonymous-search",children:"Binding - anonymous search"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"discoverdn"})," (bool, optional) - If true, use anonymous bind to discover the bind DN of a user"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userdn"})," (string, optional) - Base DN under which to perform user search. Example: ",(0,i.jsx)(n.code,{children:"ou=Users,dc=example,dc=com"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userattr"})," (string, optional) - Attribute on user attribute object matching the username passed when authenticating. Examples: ",(0,i.jsx)(n.code,{children:"sAMAccountName"}),", ",(0,i.jsx)(n.code,{children:"cn"}),", ",(0,i.jsx)(n.code,{children:"uid"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"userfilter"})," (string, optional) - Go template used to construct a ldap user search filter. The template can access the following context variables: [",(0,i.jsx)(n.code,{children:"UserAttr"}),", ",(0,i.jsx)(n.code,{children:"Username"}),"]. The default userfilter is ",(0,i.jsx)(n.code,{children:"({{.UserAttr}}={{.Username}})"})," or ",(0,i.jsx)(n.code,{children:"(userPrincipalName={{.Username}}@UPNDomain)"})," if the ",(0,i.jsx)(n.code,{children:"upndomain"})," parameter is set. The user search filter can be used to restrict what user can attempt to log in. For example, to limit login to users that are not contractors, you could write ",(0,i.jsx)(n.code,{children:"(&(objectClass=user)({{.UserAttr}}={{.Username}})(!(employeeType=Contractor)))"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"deny_null_bind"})," (bool, optional) - This option prevents users from bypassing authentication when providing an empty password. The default is ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"anonymous_group_search"})," (bool, optional) - Use anonymous binds when performing LDAP group searches. Defaults to ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["~> When specifying a ",(0,i.jsx)(n.code,{children:"userfilter"}),", either the templated value ",(0,i.jsx)(n.code,{children:"{{.UserAttr}}"})," or\nthe literal value that matches ",(0,i.jsx)(n.code,{children:"userattr"})," should be present in the filter to\nensure that the search returns a unique result that takes ",(0,i.jsx)(n.code,{children:"userattr"})," into\nconsideration for entity alias mapping purposes and avoid possible collisions on login."]}),"\n",(0,i.jsx)(n.h4,{id:"alias-dereferencing",children:"Alias dereferencing"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"dereference_aliases"})," (string, optional) - Control how aliases are dereferenced when performing the search. Possible values are: ",(0,i.jsx)(n.code,{children:"never"}),", ",(0,i.jsx)(n.code,{children:"finding"}),", ",(0,i.jsx)(n.code,{children:"searching"}),", and ",(0,i.jsx)(n.code,{children:"always"}),". ",(0,i.jsx)(n.code,{children:"finding"})," will only dereference aliases during name resolution of the base. ",(0,i.jsx)(n.code,{children:"searching"})," will dereference aliases after name resolution."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"binding---user-principal-name-ad",children:"Binding - user principal name (AD)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"upndomain"})," (string, optional) - userPrincipalDomain used to construct the UPN string for the authenticating user. The constructed UPN will appear as ",(0,i.jsx)(n.code,{children:"[username]@UPNDomain"}),". Example: ",(0,i.jsx)(n.code,{children:"example.com"}),", which will cause OpenBao to bind as ",(0,i.jsx)(n.code,{children:"username@example.com"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"group-membership-resolution",children:"Group membership resolution"}),"\n",(0,i.jsx)(n.p,{children:"Once a user has been authenticated, the LDAP auth method must know how to resolve which groups the user is a member of. The configuration for this can vary depending on your LDAP server and your directory schema. There are two main strategies when resolving group membership - the first is searching for the authenticated user object and following an attribute to groups it is a member of. The second is to search for group objects of which the authenticated user is a member of. Both methods are supported."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"groupfilter"})," (string, optional) - Go template used when constructing the group membership query. The template can access the following context variables: [",(0,i.jsx)(n.code,{children:"UserDN"}),", ",(0,i.jsx)(n.code,{children:"Username"}),"]. The default is ",(0,i.jsx)(n.code,{children:"(|(memberUid={{.Username}})(member={{.UserDN}})(uniqueMember={{.UserDN}}))"}),", which is compatible with several common directory schemas. To support nested group resolution for Active Directory, instead use the following query: ",(0,i.jsx)(n.code,{children:"(&(objectClass=group)(member:1.2.840.113556.1.4.1941:={{.UserDN}}))"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"groupdn"})," (string, required) - LDAP search base to use for group membership search. This can be the root containing either groups or users. Example: ",(0,i.jsx)(n.code,{children:"ou=Groups,dc=example,dc=com"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"groupattr"})," (string, optional) - LDAP attribute to follow on objects returned by ",(0,i.jsx)(n.code,{children:"groupfilter"})," in order to enumerate user group membership. Examples: for groupfilter queries returning ",(0,i.jsx)(n.em,{children:"group"})," objects, use: ",(0,i.jsx)(n.code,{children:"cn"}),". For queries returning ",(0,i.jsx)(n.em,{children:"user"})," objects, use: ",(0,i.jsx)(n.code,{children:"memberOf"}),". The default is ",(0,i.jsx)(n.code,{children:"cn"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:"Note"}),": When using ",(0,i.jsx)(n.em,{children:"Authenticated Search"})," for binding parameters (see above) the distinguished name defined for ",(0,i.jsx)(n.code,{children:"binddn"})," is used for the group search. Otherwise, the authenticating user is used to perform the group search."]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"bao path-help"})," for more details."]}),"\n",(0,i.jsx)(n.h3,{id:"other",children:"Other"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"username_as_alias"})," (bool, optional) - If set to true, forces the auth method to use the username passed by the user as the alias name."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"max_page_size"})," (int, optional) - If set to a value greater than 0, the LDAP backend will use the LDAP server's paged search control to request pages of up to the given size. This can be used to avoid hitting the LDAP server's maximum result size limit. Otherwise, the LDAP backend will not use the paged search control."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples:"}),"\n",(0,i.jsx)(n.h3,{id:"scenario-1",children:"Scenario 1"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["LDAP server running on ",(0,i.jsx)(n.code,{children:"ldap.example.com"}),", port 389."]}),"\n",(0,i.jsxs)(n.li,{children:["Server supports ",(0,i.jsx)(n.code,{children:"STARTTLS"})," command to initiate encryption on the standard port."]}),"\n",(0,i.jsxs)(n.li,{children:["CA Certificate stored in file named ",(0,i.jsx)(n.code,{children:"ldap_ca_cert.pem"})]}),"\n",(0,i.jsxs)(n.li,{children:["Server is Active Directory supporting the userPrincipalName attribute. Users are identified as ",(0,i.jsx)(n.code,{children:"username@example.com"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Groups are nested, we will use ",(0,i.jsx)(n.code,{children:"LDAP_MATCHING_RULE_IN_CHAIN"})," to walk the ancestry graph."]}),"\n",(0,i.jsxs)(n.li,{children:["Group search will start under ",(0,i.jsx)(n.code,{children:"ou=Groups,dc=example,dc=com"}),". For all group objects under that path, the ",(0,i.jsx)(n.code,{children:"member"})," attribute will be checked for a match against the authenticated user."]}),"\n",(0,i.jsxs)(n.li,{children:["Group names are identified using their ",(0,i.jsx)(n.code,{children:"cn"})," attribute."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:'$ bao write auth/ldap/config \\\n    url="ldap://ldap.example.com" \\\n    userdn="ou=Users,dc=example,dc=com" \\\n    groupdn="ou=Groups,dc=example,dc=com" \\\n    groupfilter="(&(objectClass=group)(member:1.2.840.113556.1.4.1941:={{.UserDN}}))" \\\n    groupattr="cn" \\\n    upndomain="example.com" \\\n    certificate=@ldap_ca_cert.pem \\\n    insecure_tls=false \\\n    starttls=true\n...\n'})}),"\n",(0,i.jsx)(n.h3,{id:"scenario-2",children:"Scenario 2"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["LDAP server running on ",(0,i.jsx)(n.code,{children:"ldap.example.com"}),", port 389."]}),"\n",(0,i.jsxs)(n.li,{children:["Server supports ",(0,i.jsx)(n.code,{children:"STARTTLS"})," command to initiate encryption on the standard port."]}),"\n",(0,i.jsxs)(n.li,{children:["CA Certificate stored in file named ",(0,i.jsx)(n.code,{children:"ldap_ca_cert.pem"})]}),"\n",(0,i.jsx)(n.li,{children:"Server does not allow anonymous binds for performing user search."}),"\n",(0,i.jsxs)(n.li,{children:["Bind account used for searching is ",(0,i.jsx)(n.code,{children:"cn=openbao,ou=users,dc=example,dc=com"})," with password ",(0,i.jsx)(n.code,{children:"My$ecrt3tP4ss"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["User objects are under the ",(0,i.jsx)(n.code,{children:"ou=Users,dc=example,dc=com"})," organizational unit."]}),"\n",(0,i.jsxs)(n.li,{children:["Username passed to openbao when authenticating maps to the ",(0,i.jsx)(n.code,{children:"sAMAccountName"})," attribute."]}),"\n",(0,i.jsxs)(n.li,{children:["Group membership will be resolved via the ",(0,i.jsx)(n.code,{children:"memberOf"})," attribute of ",(0,i.jsx)(n.em,{children:"user"})," objects. That search will begin under ",(0,i.jsx)(n.code,{children:"ou=Users,dc=example,dc=com"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:'$ bao write auth/ldap/config \\\n    url="ldap://ldap.example.com" \\\n    userattr=sAMAccountName \\\n    userdn="ou=Users,dc=example,dc=com" \\\n    groupdn="ou=Users,dc=example,dc=com" \\\n    groupfilter="(&(objectClass=person)(uid={{.Username}}))" \\\n    groupattr="memberOf" \\\n    binddn="cn=openbao,ou=users,dc=example,dc=com" \\\n    bindpass=\'My$ecrt3tP4ss\' \\\n    certificate=@ldap_ca_cert.pem \\\n    insecure_tls=false \\\n    starttls=true\n...\n'})}),"\n",(0,i.jsx)(n.h3,{id:"scenario-3",children:"Scenario 3"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["LDAP server running on ",(0,i.jsx)(n.code,{children:"ldap.example.com"}),", port 636 (LDAPS)"]}),"\n",(0,i.jsxs)(n.li,{children:["CA Certificate stored in file named ",(0,i.jsx)(n.code,{children:"ldap_ca_cert.pem"})]}),"\n",(0,i.jsxs)(n.li,{children:["User objects are under the ",(0,i.jsx)(n.code,{children:"ou=Users,dc=example,dc=com"})," organizational unit."]}),"\n",(0,i.jsxs)(n.li,{children:["Username passed to OpenBao when authenticating maps to the ",(0,i.jsx)(n.code,{children:"uid"})," attribute."]}),"\n",(0,i.jsx)(n.li,{children:"User bind DN will be auto-discovered using anonymous binding."}),"\n",(0,i.jsxs)(n.li,{children:["Group membership will be resolved via any one of ",(0,i.jsx)(n.code,{children:"memberUid"}),", ",(0,i.jsx)(n.code,{children:"member"}),", or ",(0,i.jsx)(n.code,{children:"uniqueMember"})," attributes. That search will begin under ",(0,i.jsx)(n.code,{children:"ou=Groups,dc=example,dc=com"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Group names are identified using the ",(0,i.jsx)(n.code,{children:"cn"})," attribute."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:'$ bao write auth/ldap/config \\\n    url="ldaps://ldap.example.com" \\\n    userattr="uid" \\\n    userdn="ou=Users,dc=example,dc=com" \\\n    discoverdn=true \\\n    groupdn="ou=Groups,dc=example,dc=com" \\\n    certificate=@ldap_ca_cert.pem \\\n    insecure_tls=false \\\n    starttls=true\n...\n'})}),"\n",(0,i.jsx)(n.h2,{id:"ldap-group---policy-mapping",children:"LDAP group -> policy mapping"}),"\n",(0,i.jsx)(n.p,{children:"Next we want to create a mapping from an LDAP group to an OpenBao policy:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao write auth/ldap/groups/scientists policies=foo,bar\n"})}),"\n",(0,i.jsx)(n.p,{children:'This maps the LDAP group "scientists" to the "foo" and "bar" OpenBao policies.\nWe can also add specific LDAP users to additional (potentially non-LDAP)\ngroups. Note that policies can also be specified on LDAP users as well.'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao write auth/ldap/groups/engineers policies=foobar\n$ bao write auth/ldap/users/tesla groups=engineers policies=zoobar\n"})}),"\n",(0,i.jsx)(n.p,{children:'This adds the LDAP user "tesla" to the "engineers" group, which maps to\nthe "foobar" OpenBao policy. User "tesla" itself is associated with "zoobar"\npolicy.'}),"\n",(0,i.jsx)(n.p,{children:"Finally, we can test this by authenticating:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao login -method=ldap username=tesla\nPassword (will be hidden):\nSuccessfully authenticated! The policies that are associated\nwith this token are listed below:\n\ndefault, foobar, zoobar\n"})}),"\n",(0,i.jsx)(n.h2,{id:"note-on-policy-mapping",children:"Note on policy mapping"}),"\n",(0,i.jsx)(n.p,{children:"It should be noted that user -> policy mapping happens at token creation time. And changes in group membership on the LDAP server will not affect tokens that have already been provisioned. To see these changes, old tokens should be revoked and the user should be asked to reauthenticate."}),"\n",(0,i.jsx)(n.h2,{id:"user-lockout",children:"User lockout"}),"\n",(0,i.jsx)(n.p,{children:'If a user provides bad credentials several times in quick succession,\nOpenBao will stop trying to validate their credentials for a while, instead returning immediately\nwith a permission denied error. We call this behavior "user lockout". The time for which\na user will be locked out is called \u201clockout duration\u201d. The user will be able to login after the lockout\nduration has passed. The number of failed login attempts after which the user is locked out is called\n\u201clockout threshold\u201d. The lockout threshold counter is reset to zero after a few minutes without login attempts,\nor upon a successful login attempt. The duration after which the counter will be reset to zero\nafter no login attempts is called "lockout counter reset". This can defeat both automated and targeted requests\ni.e, user-based password guessing attacks as well as automated attacks.'}),"\n",(0,i.jsx)(n.p,{children:'The user lockout feature is enabled by default. The default values for "lockout threshold" is 5 attempts,\n"lockout duration" is 15 minutes, "lockout counter reset" is 15 minutes.'}),"\n",(0,i.jsx)(n.p,{children:"The user lockout feature can be disabled as follows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["It can be disabled globally using environment variable ",(0,i.jsx)(n.code,{children:"VAULT_DISABLE_USER_LOCKOUT"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["It can be disabled for all supported auth methods (ldap, userpass and approle) or a specific supported auth method using the ",(0,i.jsx)(n.code,{children:"disable_lockout"}),"\nparameter within ",(0,i.jsx)(n.code,{children:"user_lockout"})," stanza in configuration file.\nPlease see ",(0,i.jsx)(n.a,{href:"/docs/configuration/user-lockout#user_lockout-stanza",children:"user lockout configuration"})," for more details."]}),"\n",(0,i.jsxs)(n.li,{children:['It can be disabled for a specific auth mount using "auth tune". Please see ',(0,i.jsx)(n.a,{href:"/docs/commands/auth/tune",children:"auth tune command"}),"\nor ",(0,i.jsx)(n.a,{href:"/api-docs/system/auth#tune-auth-method",children:"auth tune api"})," for more details."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["~> ",(0,i.jsx)(n.strong,{children:"NOTE"}),": This feature is only supported by the userpass, ldap, and approle auth methods."]}),"\n",(0,i.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,i.jsxs)(n.p,{children:["The LDAP auth method has a full HTTP API. Please see the\n",(0,i.jsx)(n.a,{href:"/api-docs/auth/ldap",children:"LDAP auth method API"})," for more\ndetails."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(96540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);