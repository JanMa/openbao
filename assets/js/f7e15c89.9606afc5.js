"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7465],{15697:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var o=t(74848),s=t(28453);const a={sidebar_label:"Upgrade OpenBao HA installations",description:"Upgrade instructions for OpenBao HA. Be sure to read the Upgrading-OpenBao Guides as well."},r="OpenBao HA upgrades",i={id:"upgrading/vault-ha-upgrade",title:"OpenBao HA upgrades",description:"Upgrade instructions for OpenBao HA. Be sure to read the Upgrading-OpenBao Guides as well.",source:"@site/content/docs/upgrading/vault-ha-upgrade.mdx",sourceDirName:"upgrading",slug:"/upgrading/vault-ha-upgrade",permalink:"/openbao/docs/upgrading/vault-ha-upgrade",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/upgrading/vault-ha-upgrade.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"Upgrade OpenBao HA installations",description:"Upgrade instructions for OpenBao HA. Be sure to read the Upgrading-OpenBao Guides as well."},sidebar:"docs",previous:{title:"Overview",permalink:"/openbao/docs/upgrading/"},next:{title:"Upgrade plugins",permalink:"/openbao/docs/upgrading/plugins"}},d={},l=[{value:"HA installations",id:"ha-installations",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"openbao-ha-upgrades",children:"OpenBao HA upgrades"}),"\n",(0,o.jsx)(n.p,{children:"You should consider how to apply the steps described in this document to your\nparticular setup since HA setups can differ on whether a load balancer is in\nuse, what addresses clients are being given to connect to OpenBao (standby +\nleader, leader-only, or discovered via service discovery), etc."}),"\n",(0,o.jsx)(n.h2,{id:"ha-installations",children:"HA installations"}),"\n",(0,o.jsx)(n.p,{children:"Regardless of the method you use, do not fail over from a newer version of OpenBao\nto an older version. Our suggested procedure is designed to prevent this."}),"\n",(0,o.jsx)(n.p,{children:"Please note that OpenBao does not support true zero-downtime upgrades, but with\nproper upgrade procedure the downtime should be very short (a few hundred\nmilliseconds to a second depending on how the speed of access to the storage\nbackend)."}),"\n",(0,o.jsx)(n.p,{children:"Perform these steps on each standby:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Properly shut down OpenBao on the standby node via ",(0,o.jsx)(n.code,{children:"SIGINT"})," or ",(0,o.jsx)(n.code,{children:"SIGTERM"})]}),"\n",(0,o.jsxs)(n.li,{children:["Replace the OpenBao binary with the new version; ensure that ",(0,o.jsx)(n.code,{children:"mlock()"}),"\ncapability is added to the new binary with\n",(0,o.jsx)(n.a,{href:"/docs/configuration#disable_mlock",children:"setcap"})]}),"\n",(0,o.jsx)(n.li,{children:"Start the standby node"}),"\n",(0,o.jsx)(n.li,{children:"Unseal the standby node"}),"\n",(0,o.jsxs)(n.li,{children:["Verify ",(0,o.jsx)(n.code,{children:"bao status"})," shows correct Version and HA Mode is ",(0,o.jsx)(n.code,{children:"standby"})]}),"\n",(0,o.jsx)(n.li,{children:"Review the node's logs to ensure successful startup and unseal"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"At this point all standby nodes are upgraded and ready to take over. The\nupgrade will not complete until one of the upgraded standby nodes takes over\nactive duty."}),"\n",(0,o.jsx)(n.p,{children:"To complete the cluster upgrade:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Properly shut down the remaining (active) node"}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"It is important that you shut the node down properly.\nThis will perform a step-down and release the HA lock, allowing a standby\nnode to take over with a very short delay.\nIf you kill OpenBao without letting it release the lock, a standby node will\nnot be able to take over until the lock's timeout period has expired. This\nis backend-specific but could be ten seconds or more."})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:["Replace the OpenBao binary with the new version; ensure that ",(0,o.jsx)(n.code,{children:"mlock()"}),"\ncapability is added to the new binary with\n",(0,o.jsx)(n.a,{href:"/docs/configuration#disable_mlock",children:"setcap"})]}),"\n",(0,o.jsx)(n.li,{children:"Start the node"}),"\n",(0,o.jsx)(n.li,{children:"Unseal the node"}),"\n",(0,o.jsxs)(n.li,{children:["Verify ",(0,o.jsx)(n.code,{children:"bao status"})," shows correct Version and HA Mode is ",(0,o.jsx)(n.code,{children:"standby"})]}),"\n",(0,o.jsx)(n.li,{children:"Review the node's logs to ensure successful startup and unseal"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Internal upgrade tasks will happen after one of the upgraded standby nodes\ntakes over active duty."}),"\n",(0,o.jsx)(n.p,{children:"Be sure to also read and follow any instructions in the version-specific\nupgrade notes."})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var o=t(96540);const s={},a=o.createContext(s);function r(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);