"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5399],{44143:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>o});var i=s(74848),r=s(28453);const t={layout:"docs",page_title:"pki health-check - Command",description:'The "pki health-check" command verifies the health of the given PKI secrets\nengine mount against an optional configuration.'},l="pki health-check",c={id:"commands/pki/health-check",title:"pki health-check",description:'The "pki health-check" command verifies the health of the given PKI secrets\nengine mount against an optional configuration.',source:"@site/content/docs/commands/pki/health-check.mdx",sourceDirName:"commands/pki",slug:"/commands/pki/health-check",permalink:"/openbao/docs/commands/pki/health-check",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/commands/pki/health-check.mdx",tags:[],version:"current",frontMatter:{layout:"docs",page_title:"pki health-check - Command",description:'The "pki health-check" command verifies the health of the given PKI secrets\nengine mount against an optional configuration.'},sidebar:"docs",previous:{title:"pki",permalink:"/openbao/docs/commands/pki/"},next:{title:"pki verify-sign",permalink:"/openbao/docs/commands/pki/verify-sign"}},d={},o=[{value:"Examples",id:"examples",level:2},{value:"Usage",id:"usage",level:2},{value:"Return status and output",id:"return-status-and-output",level:2},{value:"Health checks",id:"health-checks",level:2},{value:"CA validity period",id:"ca-validity-period",level:3},{value:"CRL validity period",id:"crl-validity-period",level:3},{value:"Root certificate issued Non-CA leaves",id:"root-certificate-issued-non-ca-leaves",level:3},{value:"Role allows implicit localhost issuance",id:"role-allows-implicit-localhost-issuance",level:3},{value:"Role allows Glob-Based wildcard issuance",id:"role-allows-glob-based-wildcard-issuance",level:3},{value:"Role sets <code>no_store=false</code> and performance",id:"role-sets-no_storefalse-and-performance",level:3},{value:"Accessibility of audit information",id:"accessibility-of-audit-information",level:3},{value:"ACL policies allow problematic endpoints",id:"acl-policies-allow-problematic-endpoints",level:3},{value:"Allow If-Modified-Since requests",id:"allow-if-modified-since-requests",level:3},{value:"Auto-Tidy disabled",id:"auto-tidy-disabled",level:3},{value:"Tidy hasn&#39;t run",id:"tidy-hasnt-run",level:3},{value:"Too many certificates",id:"too-many-certificates",level:3},{value:"Enable ACME issuance",id:"enable-acme-issuance",level:3},{value:"ACME response headers",id:"acme-response-headers",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"pki-health-check",children:"pki health-check"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"pki health-check"})," command verifies the health of the given PKI secrets\nengine mount against an optional configuration."]}),"\n",(0,i.jsxs)(n.p,{children:["This runs with the permissions of the given token, reading various APIs from\nthe mount and ",(0,i.jsx)(n.code,{children:"/sys"})," against the given OpenBao server"]}),"\n",(0,i.jsxs)(n.p,{children:["Mounts need to be specified with any namespaces prefixed in the path, e.g.,\n",(0,i.jsx)(n.code,{children:"ns1/pki"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsxs)(n.p,{children:["Performs a basic health check against the ",(0,i.jsx)(n.code,{children:"pki-root"})," mount:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao pki health-check pki-root/\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Configuration can be specified using the ",(0,i.jsx)(n.code,{children:"-health-config"})," flag:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao pki health-check -health-config=mycorp-root.json pki-root/\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Using the ",(0,i.jsx)(n.code,{children:"-list"})," flag will show the list of health checks and any\nknown configuration values (with their defaults) that will be run\nagainst this mount:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao pki health-check -list pki-root/\n"})}),"\n",(0,i.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsx)(n.p,{children:"The following flags are unique to this command:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"-default-disabled"})," - When specified, results in all health checks being\ndisabled by default unless enabled by the configuration file explicitly.\nThe default is ",(0,i.jsx)(n.code,{children:"false"}),", meaning all default-enabled health checks will run."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"-health-config"})," ",(0,i.jsx)(n.code,{children:'(string: "")'})," - Path to JSON configuration file to\nmodify health check execution and parameters."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"-list"})," - When specified, no health checks are run, but all known health\nchecks are printed. Still requires a positional mount argument. The default\nis ",(0,i.jsx)(n.code,{children:"false"}),", meaning no listing is printed and health checks will execute."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"-return-indicator"})," ",(0,i.jsx)(n.code,{children:'(string: "default")'})," - Behavior of the return value\n(exit code) of this command:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"permission"}),", for exiting with a non-zero code when the tool lacks\npermissions or has a version mismatch with\nthe server;"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"critical"}),", for exiting with a non-zero code when a check returns a\ncritical status in addition to the above;"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"warning"}),", for exiting with a non-zero status when a check returns a\nwarning status in addition to the above;"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"informational"}),", for exiting with a non-zero status when a check\nreturns an informational status in addition to the above;"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"default"}),", for the default behavior based on severity of message\nand only returning a zero exit status when all checks have passed\nand no execution errors have occurred."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This command respects the ",(0,i.jsx)(n.code,{children:"-format"})," parameter to control the presentation of\noutput sent to stdout. Fatal errors that prevent health checks from executing\nmay not follow this formatting."]}),"\n",(0,i.jsx)(n.h2,{id:"return-status-and-output",children:"Return status and output"}),"\n",(0,i.jsx)(n.p,{children:"This command returns the following exit codes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0"})," - Everything is good."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"1"})," - Usage error (check CLI parameters)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"2"})," - Informational message from a health check."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"3"})," - Warning message from a health check."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"4"})," - Critical message from a health check."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"5"})," - A version mismatch between health check and OpenBao Server occurred,\npreventing one or more health checks from being fully run."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"6"})," - A permission denied message was returned from OpenBao Server for\none or more health checks."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Note that an exit code of ",(0,i.jsx)(n.code,{children:"5"})," (due to a version mismatch) is not necessarily\nfatal to the health check."]}),"\n",(0,i.jsxs)(n.p,{children:["Each health check outputs one or results in a list. This list contains a\nmapping of keys (",(0,i.jsx)(n.code,{children:"status"}),", ",(0,i.jsx)(n.code,{children:"status_code"}),", ",(0,i.jsx)(n.code,{children:"endpoint"}),", and ",(0,i.jsx)(n.code,{children:"message"}),") to\nvalues returned by the health check. An endpoint may occur in more than\none health check and is not necessarily guaranteed to exist on the server\n(e.g., using wildcards to indicate all matching paths have the same\nresult). Tabular form elides the status code, as this is meant to be\nconsumed programatically."]}),"\n",(0,i.jsx)(n.p,{children:"These correspond to the following health check status values:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["status ",(0,i.jsx)(n.code,{children:"not_applicable"})," / status code ",(0,i.jsx)(n.code,{children:"0"}),": exit code ",(0,i.jsx)(n.code,{children:"0"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["status ",(0,i.jsx)(n.code,{children:"ok"})," / status code ",(0,i.jsx)(n.code,{children:"1"}),": exit code ",(0,i.jsx)(n.code,{children:"0"})]}),"\n",(0,i.jsxs)(n.li,{children:["status ",(0,i.jsx)(n.code,{children:"informational"})," / status code ",(0,i.jsx)(n.code,{children:"2"}),": exit code ",(0,i.jsx)(n.code,{children:"2"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["status ",(0,i.jsx)(n.code,{children:"warning"})," / status code ",(0,i.jsx)(n.code,{children:"3"}),": exit code ",(0,i.jsx)(n.code,{children:"3"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["status ",(0,i.jsx)(n.code,{children:"critical"})," / status code ",(0,i.jsx)(n.code,{children:"4"}),": exit code ",(0,i.jsx)(n.code,{children:"4"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["status ",(0,i.jsx)(n.code,{children:"invalid_version"})," / status code ",(0,i.jsx)(n.code,{children:"5"}),": exit code ",(0,i.jsx)(n.code,{children:"5"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["status ",(0,i.jsx)(n.code,{children:"insufficient_permissions"})," / status code ",(0,i.jsx)(n.code,{children:"6"}),": exit code ",(0,i.jsx)(n.code,{children:"6"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"health-checks",children:"Health checks"}),"\n",(0,i.jsx)(n.p,{children:"The following health checks are currently implemented. More health checks may\nbe added in future releases and may default to being enabled."}),"\n",(0,i.jsx)(n.h3,{id:"ca-validity-period",children:"CA validity period"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"ca_validity_period"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Accessed APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"LIST /issuers"})," (unauthenticated)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"READ /issuer/:issuer_ref/json"})," (unauthenticated)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"root_expiry_critical"})," ",(0,i.jsx)(n.code,{children:"(duration: 182d)"})," - for a duration within which the root's lifetime is considered critical"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"intermediate_expiry_critical"})," ",(0,i.jsx)(n.code,{children:"(duration: 30d)"})," - for a duration within which the intermediate's lifetime is considered critical"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"root_expiry_warning"})," ",(0,i.jsx)(n.code,{children:"(duration: 365d)"})," -  for a duration within which the root's lifetime is considered warning"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"intermediate_expiry_warning"})," ",(0,i.jsx)(n.code,{children:"(duration: 60d)"})," - for a duration within which the intermediate's lifetime is considered warning"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"root_expiry_informational"})," ",(0,i.jsx)(n.code,{children:"(duration: 730d)"})," - for a duration within which the root's lifetime is considered informational"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"intermediate_expiry_informational"})," ",(0,i.jsx)(n.code,{children:"(duration: 180d)"})," - for a duration within which the intermediate's lifetime is considered informational"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This health check will check each issuer in the mount for validity status, returning a list. If a CA expires within the next 30 days, the result will be critical. If a root CA expires within the next 12 months or an intermediate CA within the next 2 months, the result will be a warning. If a root CA expires within 24 months or an intermediate CA within 6 months, the result will be informational."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Perform a ",(0,i.jsx)(n.a,{href:"/docs/secrets/pki/rotation-primitives",children:"CA rotation operation"}),"\nto check for CAs that are about to expire."]}),"\n",(0,i.jsx)(n.li,{children:"Migrate from expiring CAs to new CAs."}),"\n",(0,i.jsx)(n.li,{children:"Delete any expired CAs with one of the following options:"}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.a,{href:"/api-docs/secret/pki#tidy",children:"tidy"})," manually with ",(0,i.jsx)(n.code,{children:"bao write <mount>/tidy tidy_expired_issuers=true"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Use the OpenBao API to call ",(0,i.jsx)(n.a,{href:"/api-docs/secret/pki#delete-issuer",children:"delete issuer"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"crl-validity-period",children:"CRL validity period"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"crl_validity_period"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Accessed APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"LIST /issuers"})," (unauthenticated)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"READ /config/crl"})," (optional)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"READ /issuer/:issuer_ref/crl"})," (unauthenticated)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"READ /issuer/:issuer_ref/crl/delta"})," (unauthenticated)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"crl_expiry_pct_critical"})," ",(0,i.jsx)(n.code,{children:"(int: 95)"})," - the percentage of validity period after which a CRL should be considered critically close to expiry"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"delta_crl_expiry_pct_critical"})," ",(0,i.jsx)(n.code,{children:"(int: 95)"})," - the percentage of validity period after which a Delta CRL should be considered critically close to expiry"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This health check checks each issuer's CRL for validity status, returning a list. Unlike CAs, where a date-based duration makes sense due to effort required to successfully rotate, rotating CRLs are much easier, so a percentage based approach makes sense. If the chosen percentage exceeds that of the ",(0,i.jsx)(n.code,{children:"grace_period"})," from the CRL configuration, an informational message will be issued rather than OK."]}),"\n",(0,i.jsx)(n.p,{children:"For informational purposes, it reads the CRL config and suggests enabling auto-rebuild CRLs if not enabled."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"bao write"})," to enable CRL auto-rebuild:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao write <mount>/config/crl auto_rebuild=true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"root-certificate-issued-non-ca-leaves",children:"Root certificate issued Non-CA leaves"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"root_issued_leaves"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"LIST /issuers"})," (unauthenticated)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"READ /issuer/:issuer_ref/pem"})," (unauthenticated)"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"LIST /certs"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"READ /certs/:serial"})," (unauthenticated)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"certs_to_fetch"})," ",(0,i.jsx)(n.code,{children:"(int: 100)"})," - a quantity of leaf certificates to fetch to see if any leaves have been issued by a root directly."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This health check verifies whether a proper CA hierarchy is in use. We do this by fetching ",(0,i.jsx)(n.code,{children:"certs_to_fetch"})," leaf certificates (configurable) and seeing if they are a non-issuer leaf and if they were signed by a root issuer in this mount. If one is found, we'll issue a warning about this, and recommend setting up an intermediate CA."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Restrict the use of ",(0,i.jsx)(n.code,{children:"sign"}),", ",(0,i.jsx)(n.code,{children:"sign-verbatim"}),", ",(0,i.jsx)(n.code,{children:"issue"}),", and ACME APIs against\nthe root issuer."]}),"\n",(0,i.jsx)(n.li,{children:"Create an intermediary issuer in a different mount."}),"\n",(0,i.jsx)(n.li,{children:"Have the root issuer sign the new intermediary issuer."}),"\n",(0,i.jsx)(n.li,{children:"Issue new leaf certificates using the intermediary issuer."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"role-allows-implicit-localhost-issuance",children:"Role allows implicit localhost issuance"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"role_allows_localhost"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"LIST /roles"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /roles/:name"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),": (none)"]}),"\n",(0,i.jsxs)(n.p,{children:["Checks whether any roles exist that allow implicit localhost based issuance\n(",(0,i.jsx)(n.code,{children:"allow_localhost=true"}),") with a non-empty ",(0,i.jsx)(n.code,{children:"allowed_domains"})," value."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"allow_localhost"})," to ",(0,i.jsx)(n.code,{children:"false"})," for all roles."]}),"\n",(0,i.jsxs)(n.li,{children:["Update the ",(0,i.jsx)(n.code,{children:"allowed_domains"})," field with an explicit list of allowed\nlocalhost-like domains."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"role-allows-glob-based-wildcard-issuance",children:"Role allows Glob-Based wildcard issuance"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"role_allows_glob_wildcards"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"LIST /roles"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /roles/:name"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowed_roles"})," ",(0,i.jsx)(n.code,{children:"(list: nil)"})," - an allow-list of roles to ignore."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Check each role to see whether or not it allows wildcard issuance ",(0,i.jsx)(n.strong,{children:"and"})," glob\ndomains. Wildcards and globs can interact and result in nested wildcards among\nother (potentially dangerous) quirks."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Split any role that need both of ",(0,i.jsx)(n.code,{children:"allow_glob_domains"})," and ",(0,i.jsx)(n.code,{children:"allow_wildcard_certificates"})," to be true into two roles."]}),"\n",(0,i.jsxs)(n.li,{children:["Continue splitting roles until both of the following are true for all roles:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The role has ",(0,i.jsx)(n.code,{children:"allow_glob_domains"})," ",(0,i.jsx)(n.strong,{children:"or"})," ",(0,i.jsx)(n.code,{children:"allow_wildcard_certificates"}),", but\nnot both."]}),"\n",(0,i.jsxs)(n.li,{children:["Roles with ",(0,i.jsx)(n.code,{children:"allow_glob_domains"})," ",(0,i.jsx)(n.strong,{children:"and"})," ",(0,i.jsx)(n.code,{children:"allow_wildcard_certificates"})," are\nthe only roles required for ",(0,i.jsx)(n.strong,{children:"all"})," SANs on the certificate."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Add the roles that allow glob domains and wildcards to ",(0,i.jsx)(n.code,{children:"allowed_roles"})," so\nOpenBao ignores them in future checks."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"role-sets-no_storefalse-and-performance",children:["Role sets ",(0,i.jsx)(n.code,{children:"no_store=false"})," and performance"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"role_no_store_false"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"LIST /roles"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /roles/:name"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"LIST /certs"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /config/crl"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowed_roles"})," ",(0,i.jsx)(n.code,{children:"(list: nil)"})," - an allow-list of roles to ignore."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Checks each role to see whether ",(0,i.jsx)(n.code,{children:"no_store"})," is set to ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["OpenBao will provide warnings and performance will suffer if you have a large\nnumber of certificates without temporal CRL auto-rebuilding and set ",(0,i.jsx)(n.code,{children:"no_store"}),"\nto ",(0,i.jsx)(n.code,{children:"true"}),"."]})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Update none-ACME roles with ",(0,i.jsx)(n.code,{children:"no_store=false"}),". ",(0,i.jsx)(n.strong,{children:"NOTE"}),": Roles used for ACME\nissuance must have ",(0,i.jsx)(n.code,{children:"no_store"}),"  set to ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Set your certificate lifetimes as short as possible."}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.a,{href:"/api-docs/secret/pki#revoke-certificate",children:"BYOC revocations"})," to\nrevoke certificates as needed."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"accessibility-of-audit-information",children:"Accessibility of audit information"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"audit_visibility"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /sys/mounts/:mount/tune"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ignored_parameters"})," ",(0,i.jsx)(n.code,{children:"(list: nil)"})," - a list of parameters to ignore their HMAC status."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This health check checks whether audit information is accessible to log consumers, validating whether our list of safe and unsafe audit parameters are generally followed. These are informational responses, if any are present."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"bao secrets tune"})," to set the desired audit parameters:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao secrets tune \\\n  -audit-non-hmac-response-keys=certificate \\\n  -audit-non-hmac-response-keys=issuing_ca \\\n  -audit-non-hmac-response-keys=serial_number \\\n  -audit-non-hmac-response-keys=error \\\n  -audit-non-hmac-response-keys=ca_chain \\\n  -audit-non-hmac-request-keys=certificate \\\n  -audit-non-hmac-request-keys=issuer_ref \\\n  -audit-non-hmac-request-keys=common_name \\\n  -audit-non-hmac-request-keys=alt_names \\\n  -audit-non-hmac-request-keys=other_sans \\\n  -audit-non-hmac-request-keys=ip_sans \\\n  -audit-non-hmac-request-keys=uri_sans \\\n  -audit-non-hmac-request-keys=ttl \\\n  -audit-non-hmac-request-keys=not_after \\\n  -audit-non-hmac-request-keys=serial_number \\\n  -audit-non-hmac-request-keys=key_type \\\n  -audit-non-hmac-request-keys=private_key_format \\\n  -audit-non-hmac-request-keys=managed_key_name \\\n  -audit-non-hmac-request-keys=managed_key_id \\\n  -audit-non-hmac-request-keys=ou \\\n  -audit-non-hmac-request-keys=organization \\\n  -audit-non-hmac-request-keys=country \\\n  -audit-non-hmac-request-keys=locality \\\n  -audit-non-hmac-request-keys=province \\\n  -audit-non-hmac-request-keys=street_address \\\n  -audit-non-hmac-request-keys=postal_code \\\n  -audit-non-hmac-request-keys=permitted_dns_domains \\\n  -audit-non-hmac-request-keys=policy_identifiers \\\n  -audit-non-hmac-request-keys=ext_key_usage_oids \\\n  -audit-non-hmac-request-keys=csr \\\n   <mount>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"acl-policies-allow-problematic-endpoints",children:"ACL policies allow problematic endpoints"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"policy_allow_endpoints"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"LIST /sys/policy"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /sys/policy/:name"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowed_policies"})," ",(0,i.jsx)(n.code,{children:"(list: nil)"})," -  a list of policies to allow-list for access to insecure APIs."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This health check checks whether unsafe access to APIs (such as ",(0,i.jsx)(n.code,{children:"sign-intermediate"}),", ",(0,i.jsx)(n.code,{children:"sign-verbatim"}),", and ",(0,i.jsx)(n.code,{children:"sign-self-issued"}),") are allowed. Any findings are a critical result and should be rectified by the administrator or explicitly allowed."]}),"\n",(0,i.jsx)(n.h3,{id:"allow-if-modified-since-requests",children:"Allow If-Modified-Since requests"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"allow_if_modified_since"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /sys/internal/ui/mounts"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),": (none)"]}),"\n",(0,i.jsxs)(n.p,{children:["This health check verifies if the ",(0,i.jsx)(n.code,{children:"If-Modified-Since"})," header has been added to ",(0,i.jsx)(n.code,{children:"passthrough_request_headers"})," and if ",(0,i.jsx)(n.code,{children:"Last-Modified"})," header has been added to ",(0,i.jsx)(n.code,{children:"allowed_response_headers"}),". This is an informational message if both haven't been configured, or a warning if only one has been configured."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Update ",(0,i.jsx)(n.code,{children:"allowed_response_headers"})," and ",(0,i.jsx)(n.code,{children:"passthrough_request_headers"})," for all\npolicies with ",(0,i.jsx)(n.code,{children:"bao secrets tune"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:'$ bao secrets tune \\\n    -passthrough-request-headers="If-Modified-Since" \\\n    -allowed-response-headers="Last-Modified" \\\n    <mount>\n'})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Update ACME-specific headers with ",(0,i.jsx)(n.code,{children:"bao secrets tune"})," (if you are using ACME):"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:'$ bao secrets tune \\\n    -passthrough-request-headers="If-Modified-Since" \\\n    -allowed-response-headers="Last-Modified" \\\n    -allowed-response-headers="Replay-Nonce" \\\n    -allowed-response-headers="Link" \\\n    -allowed-response-headers="Location" \\\n    <mount>\n'})}),"\n",(0,i.jsx)(n.h3,{id:"auto-tidy-disabled",children:"Auto-Tidy disabled"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"enable_auto_tidy"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /config/auto-tidy"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"interval_duration_critical"})," ",(0,i.jsx)(n.code,{children:"(duration: 7d)"})," - the maximum allowed interval_duration to hit critical threshold."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"interval_duration_warning"})," ",(0,i.jsx)(n.code,{children:"(duration: 2d)"})," - the maximum allowed interval_duration to hit a warning threshold."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pause_duration_critical"})," ",(0,i.jsx)(n.code,{children:"(duration: 1s)"})," - the maximum allowed pause_duration to hit a critical threshold."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pause_duration_warning"})," ",(0,i.jsx)(n.code,{children:"(duration: 200ms)"})," - the maximum allowed pause_duration to hit a warning threshold."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This health check verifies that auto-tidy is enabled, with sane defaults for interval_duration and pause_duration. Any disabled findings will be informational, as this is a best-practice but not strictly required, but other findings w.r.t. ",(0,i.jsx)(n.code,{children:"interval_duration"})," or ",(0,i.jsx)(n.code,{children:"pause_duration"})," will be critical/warnings."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Remediation steps"})}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"bao write"})," to enable auto-tidy with the recommended defaults:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao write <mount>/config/auto-tidy \\\n    enabled=true \\\n    tidy_cert_store=true \\\n    tidy_revoked_certs=true \\\n    tidy_acme=true \\\n    tidy_revocation_queue=true \\\n    tidy_cross_cluster_revoked_certs=true \\\n    tidy_revoked_cert_issuer_associations=true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"tidy-hasnt-run",children:"Tidy hasn't run"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"tidy_last_run"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /tidy-status"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"last_run_critical"})," ",(0,i.jsx)(n.code,{children:"(duration: 7d)"})," - the critical delay threshold between when tidy should have last run."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"last_run_warning"})," ",(0,i.jsx)(n.code,{children:"(duration: 2d)"})," - the warning delay threshold between when tidy should have last run."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This health check verifies that tidy has run within the last run window. This can be critical/warning alerts as this can start to seriously impact OpenBao's performance."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Schedule a manual run of tidy with ",(0,i.jsx)(n.code,{children:"bao write"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao write <mount>/tidy \\\n    tidy_cert_store=true \\\n    tidy_revoked_certs=true \\\n    tidy_acme=true \\\n    tidy_revocation_queue=true \\\n    tidy_cross_cluster_revoked_certs=true \\\n    tidy_revoked_cert_issuer_associations=true\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Review the tidy status endpoint, ",(0,i.jsx)(n.code,{children:"bao read <mount>/tidy-status"})," for\nadditional information."]}),"\n",(0,i.jsx)(n.li,{children:"Re-configure auto-tidy based on the log information and results of your\nmanual run."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"too-many-certificates",children:"Too many certificates"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"too_many_certs"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /tidy-status"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"LIST /certs"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"count_critical"})," ",(0,i.jsx)(n.code,{children:"(int: 250000)"})," - the critical threshold at which there are too many certs."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"count_warning"})," ",(0,i.jsx)(n.code,{children:"(int: 50000)"})," - the warning threshold at which there are too many certs."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This health check verifies that this cluster has a reasonable number of certificates. Ideally this would be fetched from tidy's status or a new metric reporting format, but as a fallback when tidy hasn't run, a list operation will be performed instead."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Verify that tidy ran recently with ",(0,i.jsx)(n.code,{children:"bao read"}),":","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao read <mount>/tidy-status\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Schedule a manual run of tidy with ",(0,i.jsx)(n.code,{children:"bao write"}),":","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:"$ bao write <mount>/tidy \\\n  tidy_cert_store=true \\\n  tidy_revoked_certs=true \\\n  tidy_acme=true \\\n  tidy_revocation_queue=true \\\n  tidy_cross_cluster_revoked_certs=true \\\n  tidy_revoked_cert_issuer_associations=true\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Enable ",(0,i.jsx)(n.code,{children:"auto-tidy"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Make sure that you are not renewing certificates too soon. Certificate\nlifetimes should reflect the expected usage of the certificate. If the TTL is\nset appropriately, most certificates renew at approximately 2/3 of their\nlifespan."}),"\n",(0,i.jsxs)(n.li,{children:["Consider setting the ",(0,i.jsx)(n.code,{children:"no_store"})," field for all roles to ",(0,i.jsx)(n.code,{children:"true"})," and use ",(0,i.jsx)(n.a,{href:"/api-docs/secret/pki#revoke-certificate",children:"BYOC revocations"})," to avoid storage."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"enable-acme-issuance",children:"Enable ACME issuance"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"enable_acme_issuance"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /config/acme"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /config/cluster"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"LIST /issuers"})," (unauthenticated)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"READ /issuer/:issuer_ref/json"})," (unauthenticated)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),": (none)"]}),"\n",(0,i.jsx)(n.p,{children:"This health check verifies that ACME is enabled within a mount that contains an intermediary issuer, as this is considered a best-practice to support a self-rotating PKI infrastructure."}),"\n",(0,i.jsxs)(n.p,{children:["Review the ",(0,i.jsx)(n.a,{href:"/api-docs/secret/pki#acme-certificate-issuance",children:"ACME Certificate Issuance"}),"\nAPI documentation to learn about enabling ACME support in OpenBao."]}),"\n",(0,i.jsx)(n.h3,{id:"acme-response-headers",children:"ACME response headers"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name"}),": ",(0,i.jsx)(n.code,{children:"allow_acme_headers"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"APIs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"READ /sys/internal/ui/mounts"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Config Parameters"}),": (none)"]}),"\n",(0,i.jsxs)(n.p,{children:["This health check verifies if the ",(0,i.jsx)(n.code,{children:'"Replay-Nonce'}),", ",(0,i.jsx)(n.code,{children:"Link"}),", and ",(0,i.jsx)(n.code,{children:"Location"})," headers have been added to ",(0,i.jsx)(n.code,{children:"allowed_response_headers"}),", when the ACME feature is enabled. The ACME protocol will not work if these headers are not added to the mount."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remediation steps"}),":"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"bao secrets tune"})," to add the missing headers to ",(0,i.jsx)(n.code,{children:"allowed_response_headers"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell-session",children:'$ bao secrets tune \\\n  -allowed-response-headers="Last-Modified" \\\n  -allowed-response-headers="Replay-Nonce" \\\n  -allowed-response-headers="Link" \\\n  -allowed-response-headers="Location" \\\n  <mount>\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var i=s(96540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);