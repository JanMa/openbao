"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8663],{88096:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var s=t(74848),i=t(28453);const r={description:'The "debug" command monitors an OpenBao server, probing information about\nit for a certain duration.'},o="debug",a={id:"commands/debug",title:"debug",description:'The "debug" command monitors an OpenBao server, probing information about\nit for a certain duration.',source:"@site/content/docs/commands/debug.mdx",sourceDirName:"commands",slug:"/commands/debug",permalink:"/openbao/docs/commands/debug",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/commands/debug.mdx",tags:[],version:"current",frontMatter:{description:'The "debug" command monitors an OpenBao server, probing information about\nit for a certain duration.'},sidebar:"docs",previous:{title:"tune",permalink:"/openbao/docs/commands/auth/tune"},next:{title:"delete",permalink:"/openbao/docs/commands/delete"}},d={},l=[{value:"Permissions",id:"permissions",level:2},{value:"Capture targets",id:"capture-targets",level:2},{value:"Output layout",id:"output-layout",level:2},{value:"Examples",id:"examples",level:2},{value:"Usage",id:"usage",level:2},{value:"Command options",id:"command-options",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"debug",children:"debug"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"debug"})," command starts a process that monitors an OpenBao server, probing\ninformation about it for a certain duration."]}),"\n",(0,s.jsxs)(n.p,{children:["Gathering information about the state of the OpenBao cluster often requires the\noperator to access all necessary information via various API calls and terminal\ncommands. The ",(0,s.jsx)(n.code,{children:"debug"})," command aims to provide a simple workflow that produces a\nconsistent output to help operators retrieve and share information about the\nserver in question."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"debug"})," command honors the same variables that the base command\naccepts, such as the token stored via a previous login or the environment\nvariables ",(0,s.jsx)(n.code,{children:"VAULT_TOKEN"})," and ",(0,s.jsx)(n.code,{children:"VAULT_ADDR"}),". The token used determines the\npermissions and, in turn, the information that ",(0,s.jsx)(n.code,{children:"debug"})," may be able to collect.\nThe address specified determines the target server that will be probed against."]}),"\n",(0,s.jsx)(n.p,{children:"If the command is interrupted, the information collected up until that\npoint gets persisted to an output directory."}),"\n",(0,s.jsx)(n.h2,{id:"permissions",children:"Permissions"}),"\n",(0,s.jsxs)(n.p,{children:["Regardless of whether a particular target is provided, the ability for ",(0,s.jsx)(n.code,{children:"debug"}),"\nto fetch data for the target depends on the token provided. Some targets, such\nas ",(0,s.jsx)(n.code,{children:"server-status"}),", queries unauthenticated endpoints which means that it can be\nqueried all the time. Other targets require the token to have ACL permissions to\nquery the matching endpoint in order to get a proper response. Any errors\nencountered during capture due to permissions or otherwise will be logged in the\nindex file."]}),"\n",(0,s.jsx)(n.p,{children:"The following policy can be used for generating debug packages with all targets:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-hcl",children:'path "auth/token/lookup-self" {\n  capabilities = ["read"]\n}\n\npath "sys/pprof/*" {\n  capabilities = ["read"]\n}\n\npath "sys/config/state/sanitized" {\n  capabilities = ["read"]\n}\n\npath "sys/monitor" {\n  capabilities = ["read"]\n}\n\npath "sys/host-info" {\n  capabilities = ["read"]\n}\n\npath "sys/in-flight-req" {\n  capabilities = ["read"]\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"capture-targets",children:"Capture targets"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"-target"})," flag can be specified multiple times to capture specific\ninformation when debug is running. By default, it captures all information."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Target"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"config"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Sanitized version of the configuration state."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"host"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Information about the instance running the server, such as CPU, memory, and disk."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"metrics"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Telemetry information."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"pprof"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Runtime profiling data, including heap, CPU, goroutine, and trace profiling."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"replication-status"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Replication status."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.code,{children:"server-status"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Health and seal status."})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Note that the ",(0,s.jsx)(n.code,{children:"config"}),", ",(0,s.jsx)(n.code,{children:"host"}),",",(0,s.jsx)(n.code,{children:"metrics"}),", and ",(0,s.jsx)(n.code,{children:"pprof"})," targets are only queried\non active nodes due to the the fact that the information\npertains to the local node and the request should not be forwarded."]}),"\n",(0,s.jsxs)(n.p,{children:["Additionally, host information is not available on the OpenBSD platform due to\nlibrary limitations in fetching the data without enabling ",(0,s.jsx)(n.code,{children:"cgo"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"output-layout",children:"Output layout"}),"\n",(0,s.jsx)(n.p,{children:"The output of the bundled information, once decompressed, is contained within a\nsingle directory. Each target, with the exception of profiling data, is captured\nin a single file. For each of those targets collection is represented as a JSON\narray object, with each entry captured at each interval as a JSON object."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell-session",children:"$ tree openbao-debug-2019-10-15T21-44-49Z/\nopenbao-debug-2019-10-15T21-44-49Z/\n\u251c\u2500\u2500 2019-10-15T21-44-49Z\n\u2502\xa0\xa0 \u251c\u2500\u2500 goroutine.prof\n\u2502\xa0\xa0 \u251c\u2500\u2500 heap.prof\n\u2502\xa0\xa0 \u251c\u2500\u2500 profile.prof\n\u2502\xa0\xa0 \u2514\u2500\u2500 trace.out\n\u251c\u2500\u2500 2019-10-15T21-45-19Z\n\u2502\xa0\xa0 \u251c\u2500\u2500 goroutine.prof\n\u2502\xa0\xa0 \u251c\u2500\u2500 heap.prof\n\u2502\xa0\xa0 \u251c\u2500\u2500 profile.prof\n\u2502\xa0\xa0 \u2514\u2500\u2500 trace.out\n\u251c\u2500\u2500 2019-10-15T21-45-49Z\n\u2502\xa0\xa0 \u251c\u2500\u2500 goroutine.prof\n\u2502\xa0\xa0 \u251c\u2500\u2500 heap.prof\n\u2502\xa0\xa0 \u251c\u2500\u2500 profile.prof\n\u2502\xa0\xa0 \u2514\u2500\u2500 trace.out\n\u251c\u2500\u2500 2019-10-15T21-46-19Z\n\u2502\xa0\xa0 \u251c\u2500\u2500 goroutine.prof\n\u2502\xa0\xa0 \u251c\u2500\u2500 heap.prof\n\u2502\xa0\xa0 \u251c\u2500\u2500 profile.prof\n\u2502\xa0\xa0 \u2514\u2500\u2500 trace.out\n\u251c\u2500\u2500 2019-10-15T21-46-49Z\n\u2502\xa0\xa0 \u251c\u2500\u2500 goroutine.prof\n\u2502\xa0\xa0 \u2514\u2500\u2500 heap.prof\n\u251c\u2500\u2500 config.json\n\u251c\u2500\u2500 host_info.json\n\u251c\u2500\u2500 index.json\n\u251c\u2500\u2500 metrics.json\n\u251c\u2500\u2500 replication_status.json\n\u2514\u2500\u2500 server_status.json\n"})}),"\n",(0,s.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(n.p,{children:"Start debug using reasonable defaults:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell-session",children:"$ bao debug\n"})}),"\n",(0,s.jsx)(n.p,{children:"Start debug with different duration, intervals, and metrics interval values, and\nskip compression:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell-session",children:"$ bao debug -duration=1m -interval=10s -metrics-interval=5s -compress=false\n"})}),"\n",(0,s.jsx)(n.p,{children:"Start debug with specific targets:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell-session",children:"$ bao debug -target=host -target=metrics\n"})}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsxs)(n.p,{children:["The following flags are available in addition to the ",(0,s.jsx)(n.a,{href:"/docs/commands",children:"standard set of\nflags"})," included on all commands."]}),"\n",(0,s.jsx)(n.h3,{id:"command-options",children:"Command options"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"-compress"})," ",(0,s.jsx)(n.code,{children:"(bool: true)"})," - Toggles whether to compress output package The\ndefault is true."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"-duration"})," ",(0,s.jsx)(n.code,{children:'(int or time string: "2m")'})," - Duration to run the command. The\ndefault is 2m0s."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"-interval"})," ",(0,s.jsx)(n.code,{children:'(int or time string: "30s")'})," - The polling interval at which to\ncollect profiling data and server state. The default is 30s."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"-log-format"})," ",(0,s.jsx)(n.code,{children:'(string: "standard")'}),' - Log format to be captured if "log"\ntarget specified. Supported values are "standard" and "json". The default is\n"standard".']}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"-metrics-interval"})," ",(0,s.jsx)(n.code,{children:'(int or time string: "10s")'})," - The polling interval at\nwhich to collect metrics data. The default is 10s."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"-output"})," ",(0,s.jsx)(n.code,{children:"(string)"})," - Specifies the output path for the debug package. Defaults\nto an time-based generated file name."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"-target"})," ",(0,s.jsx)(n.code,{children:"(string: all targets)"})," - Target to capture, defaulting to all if\nnone specified. This can be specified multiple times to capture multiple\ntargets. Available targets are: config, host, metrics, pprof,\nreplication-status, server-status."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(96540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);