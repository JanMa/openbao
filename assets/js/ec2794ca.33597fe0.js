"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3277],{38058:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var t=n(74848),r=n(28453);const a={sidebar_label:"API proxy",description:"OpenBao Proxy's API Proxy functionality allows you to use OpenBao Proxy's API as a proxy for OpenBao's API."},i="OpenBao proxy API proxy",s={id:"agent-and-proxy/proxy/apiproxy",title:"OpenBao proxy API proxy",description:"OpenBao Proxy's API Proxy functionality allows you to use OpenBao Proxy's API as a proxy for OpenBao's API.",source:"@site/content/docs/agent-and-proxy/proxy/apiproxy.mdx",sourceDirName:"agent-and-proxy/proxy",slug:"/agent-and-proxy/proxy/apiproxy",permalink:"/docs/agent-and-proxy/proxy/apiproxy",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/agent-and-proxy/proxy/apiproxy.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"API proxy",description:"OpenBao Proxy's API Proxy functionality allows you to use OpenBao Proxy's API as a proxy for OpenBao's API."},sidebar:"docs",previous:{title:"Overview",permalink:"/docs/agent-and-proxy/proxy/"},next:{title:"Overview",permalink:"/docs/agent-and-proxy/proxy/caching/"}},c={},l=[{value:"Functionality",id:"functionality",level:2},{value:"Using Auto-Auth token",id:"using-auto-auth-token",level:2},{value:"Forcing Auto-Auth token",id:"forcing-auto-auth-token",level:2},{value:"Configuration (<code>api_proxy</code>)",id:"configuration-api_proxy",level:2},{value:"Example configuration",id:"example-configuration",level:3}];function u(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.h1,{id:"openbao-proxy-api-proxy",children:"OpenBao proxy API proxy"}),"\n",(0,t.jsx)(o.p,{children:"OpenBao Proxy's API Proxy functionality allows you to use OpenBao Proxy's API as a proxy\nfor OpenBao's API."}),"\n",(0,t.jsx)(o.h2,{id:"functionality",children:"Functionality"}),"\n",(0,t.jsxs)(o.p,{children:["The ",(0,t.jsxs)(o.a,{href:"/docs/agent#listener-stanza",children:[(0,t.jsx)(o.code,{children:"listener"})," stanza"]})," for OpenBao Proxy configures a listener for OpenBao Proxy. If\nits ",(0,t.jsx)(o.code,{children:"role"})," is not set to ",(0,t.jsx)(o.code,{children:"metrics_only"}),", it will act as a proxy for the OpenBao server that\nhas been configured in the ",(0,t.jsxs)(o.a,{href:"/docs/agent-and-proxy/proxy#vault-stanza",children:[(0,t.jsx)(o.code,{children:"vault"})," stanza"]})," of Proxy Agent. This enables access to the OpenBao\nAPI from the Proxy API, and can be configured to optionally allow or force the automatic use of\nthe Auto-Auth token for these requests, as described below."]}),"\n",(0,t.jsxs)(o.p,{children:["If a ",(0,t.jsx)(o.code,{children:"listener"})," has been configured alongside a ",(0,t.jsx)(o.code,{children:"cache"})," stanza, the API Proxy will\nfirst attempt to utilize the cache subsystem for qualifying requests, before forwarding the\nrequest to OpenBao. See the ",(0,t.jsx)(o.a,{href:"/docs/agent-and-proxy/proxy/caching",children:"caching docs"})," for more information on caching."]}),"\n",(0,t.jsx)(o.h2,{id:"using-auto-auth-token",children:"Using Auto-Auth token"}),"\n",(0,t.jsxs)(o.p,{children:["OpenBao Proxy allows for easy authentication to OpenBao in a wide variety of\nenvironments using ",(0,t.jsx)(o.a,{href:"/docs/agent-and-proxy/autoauth",children:"Auto-Auth"}),". By setting the\n",(0,t.jsx)(o.code,{children:"use_auto_auth_token"})," (see below) configuration, clients will not be required\nto provide an OpenBao token to the requests made to the Agent. When this\nconfiguration is set, if the request doesn't already bear a token, then the\nauto-auth token will be used to forward the request to the OpenBao server. This\nconfiguration will be overridden if the request already has a token attached,\nin which case, the token present in the request will be used to forward the\nrequest to the OpenBao server."]}),"\n",(0,t.jsx)(o.h2,{id:"forcing-auto-auth-token",children:"Forcing Auto-Auth token"}),"\n",(0,t.jsxs)(o.p,{children:["OpenBao Proxy can be configured to force the use of the auto-auth token by using\nthe value ",(0,t.jsx)(o.code,{children:"force"})," for the ",(0,t.jsx)(o.code,{children:"use_auto_auth_token"})," option. This configuration\noverrides the default behavior described above in ",(0,t.jsx)(o.a,{href:"/docs/agent-and-proxy/proxy/apiproxy#using-auto-auth-token",children:"Using Auto-Auth\nToken"}),", and instead ignores any\nexisting OpenBao token in the request and instead uses the auto-auth token."]}),"\n",(0,t.jsxs)(o.h2,{id:"configuration-api_proxy",children:["Configuration (",(0,t.jsx)(o.code,{children:"api_proxy"}),")"]}),"\n",(0,t.jsxs)(o.p,{children:["The top level ",(0,t.jsx)(o.code,{children:"api_proxy"})," block has the following configuration entries:"]}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.code,{children:"use_auto_auth_token"})," ",(0,t.jsx)(o.code,{children:"(bool/string: false)"})," - If set, the requests made to Agent\nwithout an OpenBao token will be forwarded to the OpenBao server with the\nauto-auth token attached. If the requests already bear a token, this\nconfiguration will be overridden and the token in the request will be used to\nforward the request to the OpenBao server. If set to ",(0,t.jsx)(o.code,{children:'"force"'})," Agent will use the\nauto-auth token, overwriting the attached OpenBao token if set."]}),"\n"]}),"\n",(0,t.jsx)(o.h3,{id:"example-configuration",children:"Example configuration"}),"\n",(0,t.jsxs)(o.p,{children:["Here is an example of a ",(0,t.jsx)(o.code,{children:"listener"})," configuration alongside ",(0,t.jsx)(o.code,{children:"api_proxy"})," configuration to force the use of the auto_auth token\nand enforce consistency."]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-hcl",children:'# Other OpenBao proxy configuration blocks\n# ...\n\napi_proxy {\n  use_auto_auth_token = "force"\n}\n\nlistener "tcp" {\n    address = "127.0.0.1:8100"\n    tls_disable = true\n}\n'})})]})}function d(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},28453:(e,o,n)=>{n.d(o,{R:()=>i,x:()=>s});var t=n(96540);const r={},a=t.createContext(r);function i(e){const o=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function s(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:o},e.children)}}}]);