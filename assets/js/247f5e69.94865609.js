"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[303],{71486:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var s=n(74848),o=n(28453);const i={description:"Providing measures against misbehaving applications and users overdrawing resources in OpenBao."},a="Resource quotas",r={id:"concepts/resource-quotas",title:"Resource quotas",description:"Providing measures against misbehaving applications and users overdrawing resources in OpenBao.",source:"@site/content/docs/concepts/resource-quotas.mdx",sourceDirName:"concepts",slug:"/concepts/resource-quotas",permalink:"/docs/concepts/resource-quotas",draft:!1,unlisted:!1,editUrl:"https://github.com/openbao/openbao/tree/main/website/content/docs/concepts/resource-quotas.mdx",tags:[],version:"current",frontMatter:{description:"Providing measures against misbehaving applications and users overdrawing resources in OpenBao."},sidebar:"docs",previous:{title:"Recovery mode",permalink:"/docs/concepts/recovery-mode"},next:{title:"Overview",permalink:"/docs/concepts/client-count/"}},c={},l=[{value:"Rate limit quotas",id:"rate-limit-quotas",level:2},{value:"Exempt routes",id:"exempt-routes",level:2},{value:"Tutorial",id:"tutorial",level:2},{value:"API",id:"api",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"resource-quotas",children:"Resource quotas"}),"\n",(0,s.jsx)(t.p,{children:"Every single interaction with OpenBao, whether to put secrets into the key/value\nstore or to generate new pairs of database credentials for the MySQL database,\nneeds to go through OpenBao\u2019s API."}),"\n",(0,s.jsx)(t.p,{children:"One side effect of the API driven model is that applications and users can\nmisbehave by overwhelming system resources through consistent and high volume API\nrequests resulting in denial-of-service issues in some OpenBao nodes or even the\nentire OpenBao cluster. This risk is significantly increased when OpenBao API endpoints\nare exposed to thousands or millions of services deployed across a global infrastructure,\nespecially in use cases of OpenBao where OpenBao is deployed as a service for internal\ndevelopers."}),"\n",(0,s.jsx)(t.p,{children:"OpenBao provides a feature, resource quotas, that allows OpenBao operators to specify\nlimits on resources used in OpenBao. Specifically, OpenBao allows operators to create\nand configure API rate limits."}),"\n",(0,s.jsx)(t.h2,{id:"rate-limit-quotas",children:"Rate limit quotas"}),"\n",(0,s.jsxs)(t.p,{children:["OpenBao allows operators to create rate limit quotas which enforce API rate\nlimiting using a ",(0,s.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Token_bucket",children:"token bucket"})," algorithm.\nA rate limit quota can be created at the root level or defined on a namespace,\nmount, or full API path by specifying a ",(0,s.jsx)(t.code,{children:"path"})," when creating the quota. The rate\nlimiter is applied to each unique client IP address on a per-node basis (i.e. rate limit\nquotas are not replicated). A client may invoke ",(0,s.jsx)(t.code,{children:"rate"})," requests at any given second,\nafter which they may invoke additional requests at ",(0,s.jsx)(t.code,{children:"rate"})," per-second."]}),"\n",(0,s.jsxs)(t.p,{children:["A rate limit quota defined at the root level (i.e. empty ",(0,s.jsx)(t.code,{children:"path"}),") is inherited by\nall namespaces and mounts. It acts as a single rate limiter for the entire OpenBao\nAPI. A rate limit quota defined on a namespace takes precedence over the global\nrate limit quota, a rate limit quota defined for a mount takes precedence over\nthe global and namespace rate limit quotas, and a rate limit quota defined for\na specific path will take precedence over global, namespace, and mount quotas.\nAdditionally, quotas defined with a ",(0,s.jsx)(t.code,{children:"role"})," to limit login requests made using\nthat role on the specified auth mount will take precedence over all other quotas.\nIn other words, the most specific quota rule will be applied."]}),"\n",(0,s.jsxs)(t.p,{children:["A rate limit can be created with an optional ",(0,s.jsx)(t.code,{children:"block_interval"}),", such that when set\nto a non-zero value, any client that hits a rate limit threshold will be blocked\nfrom all subsequent requests for a duration of ",(0,s.jsx)(t.code,{children:"block_interval"})," seconds."]}),"\n",(0,s.jsxs)(t.p,{children:["OpenBao also allows the inspection of the state of rate limiting in an OpenBao node\nthrough various ",(0,s.jsx)(t.a,{href:"/docs/internals/telemetry#Resource-Quota-Metrics",children:"metrics"})," exposed\nand through enabling optional audit logging."]}),"\n",(0,s.jsx)(t.h2,{id:"exempt-routes",children:"Exempt routes"}),"\n",(0,s.jsxs)(t.p,{children:["By default, the following paths are exempt from rate limiting. However, OpenBao\noperators can override the set of paths that are exempt from all rate limit\nresource quotas by updating the ",(0,s.jsx)(t.code,{children:"rate_limit_exempt_paths"})," configuration field."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"sys/generate-recovery-token/attempt"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"sys/generate-recovery-token/update"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"sys/generate-root/attempt"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"sys/generate-root/update"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"sys/health"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"sys/seal-status"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"sys/unseal"})}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"tutorial",children:"Tutorial"}),"\n",(0,s.jsxs)(t.p,{children:["Refer to ",(0,s.jsx)(t.a,{href:"/tutorials/operations/resource-quotas",children:"Protecting OpenBao with Resource\nQuotas"})," for a\nstep-by-step tutorial."]}),"\n",(0,s.jsx)(t.h2,{id:"api",children:"API"}),"\n",(0,s.jsxs)(t.p,{children:["Rate limit quotas can be managed over the HTTP API. Please see\n",(0,s.jsx)(t.a,{href:"/api-docs/system/rate-limit-quotas",children:"Rate Limit Quotas API"})," for more details."]})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>r});var s=n(96540);const o={},i=s.createContext(o);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);