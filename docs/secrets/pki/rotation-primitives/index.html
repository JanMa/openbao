<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-secrets/pki/rotation-primitives" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">PKI secrets engine - rotation primitives | OpenBao</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://janma.github.io/openbao/docs/secrets/pki/rotation-primitives/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="PKI secrets engine - rotation primitives | OpenBao"><meta data-rh="true" name="description" content="The PKI secrets engine for OpenBao generates TLS certificates."><meta data-rh="true" property="og:description" content="The PKI secrets engine for OpenBao generates TLS certificates."><link data-rh="true" rel="icon" href="/openbao/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://janma.github.io/openbao/docs/secrets/pki/rotation-primitives/"><link data-rh="true" rel="alternate" href="https://janma.github.io/openbao/docs/secrets/pki/rotation-primitives/" hreflang="en"><link data-rh="true" rel="alternate" href="https://janma.github.io/openbao/docs/secrets/pki/rotation-primitives/" hreflang="x-default"><link rel="stylesheet" href="/openbao/assets/css/styles.28fe8a88.css">
<script src="/openbao/assets/js/runtime~main.9d852785.js" defer="defer"></script>
<script src="/openbao/assets/js/main.43001c87.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/openbao/"><div class="navbar__logo"><img src="/openbao/img/logo.svg" alt="OpenBao Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/openbao/img/logo.svg" alt="OpenBao Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OpenBao</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/openbao/docs/">Docs</a><a class="navbar__item navbar__link" href="/openbao/api-docs/">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/openbao/openbao" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/agent-and-proxy/">OpenBao agent and OpenBao proxy</a><button aria-label="Expand sidebar category &#x27;OpenBao agent and OpenBao proxy&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/audit/">Audit devices</a><button aria-label="Expand sidebar category &#x27;Audit devices&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/auth/">Auth methods</a><button aria-label="Expand sidebar category &#x27;Auth methods&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/browser-support/">OpenBao UI browser support</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/commands/">OpenBao commands (CLI)</a><button aria-label="Expand sidebar category &#x27;OpenBao commands (CLI)&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/concepts/">Concepts</a><button aria-label="Expand sidebar category &#x27;Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/configuration/">OpenBao configuration</a><button aria-label="Expand sidebar category &#x27;OpenBao configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/deprecation/">Feature deprecation notice and plans</a><button aria-label="Expand sidebar category &#x27;Feature deprecation notice and plans&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/faq/">Product features FAQ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/get-started/developer-qs/">get-started</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/glossary/">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/">Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/install/">Installing OpenBao</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/internals/">OpenBao internals</a><button aria-label="Expand sidebar category &#x27;OpenBao internals&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/platform/">Platforms</a><button aria-label="Expand sidebar category &#x27;Platforms&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/plugins/">Plugin system</a><button aria-label="Expand sidebar category &#x27;Plugin system&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/policies/">Policies</a><button aria-label="Expand sidebar category &#x27;Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/release-notes/">Release notes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/openbao/docs/secrets/">Secrets engines</a><button aria-label="Collapse sidebar category &#x27;Secrets engines&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/secrets/cubbyhole/">Cubbyhole secrets engine</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/openbao/docs/secrets/databases/">Databases</a><button aria-label="Expand sidebar category &#x27;Databases&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/openbao/docs/secrets/identity/">Identity secrets engine</a><button aria-label="Expand sidebar category &#x27;Identity secrets engine&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/secrets/kubernetes/">Kubernetes secrets engine</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/openbao/docs/secrets/kv/">KV secrets engine</a><button aria-label="Expand sidebar category &#x27;KV secrets engine&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/secrets/ldap/">LDAP secrets engine</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/openbao/docs/secrets/pki/">PKI secrets engine</a><button aria-label="Collapse sidebar category &#x27;PKI secrets engine&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/secrets/pki/considerations/">PKI secrets engine - considerations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/secrets/pki/quick-start-intermediate-ca/">PKI secrets engine - quick start - intermediate CA setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/secrets/pki/quick-start-root-ca/">PKI secrets engine - quick start - root CA setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/openbao/docs/secrets/pki/rotation-primitives/">PKI secrets engine - rotation primitives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/secrets/pki/setup/">PKI secrets engine - setup and usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/secrets/pki/troubleshooting-acme/">Troubleshoot PKI Secrets Engine and ACME</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/secrets/rabbitmq/">RabbitMQ secrets engine</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/openbao/docs/secrets/ssh/">SSH secrets engine</a><button aria-label="Expand sidebar category &#x27;SSH secrets engine&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/secrets/totp/">TOTP secrets engine</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/openbao/docs/secrets/transit/">Transit secrets engine</a><button aria-label="Expand sidebar category &#x27;Transit secrets engine&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/openbao/docs/upgrading/">Upgrading OpenBao</a><button aria-label="Expand sidebar category &#x27;Upgrading OpenBao&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/use-cases/">Use cases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/what-is-openbao/">What is OpenBao?</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/openbao/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/openbao/docs/secrets/"><span itemprop="name">Secrets engines</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/openbao/docs/secrets/pki/"><span itemprop="name">PKI secrets engine</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">PKI secrets engine - rotation primitives</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>PKI secrets engine - rotation primitives</h1>
<p>OpenBao&#x27;s PKI Secrets Engine supports multiple issuers in a single mount point.
By using the certificate types below, rotation can be accomplished in various
situations involving both root and intermediate CAs managed by OpenBao.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="x509-certificate-fields">X.509 certificate fields<a href="#x509-certificate-fields" class="hash-link" aria-label="Direct link to X.509 certificate fields" title="Direct link to X.509 certificate fields">​</a></h2>
<p>X.509 is a complex specification; modern implementations tend to refer to
<a href="https://datatracker.ietf.org/doc/html/rfc5280" target="_blank" rel="noopener noreferrer">RFC 5280</a> for specific
details. For validation of certificates, both RFC 5280 and the TLS
validation <a href="https://datatracker.ietf.org/doc/html/rfc6125" target="_blank" rel="noopener noreferrer">RFC 6125</a> are
important for understanding how to achieve rotation.</p>
<p>The following is a simplification of these standards for the purpose of
this document.</p>
<p>Every X.509 certificate begins with an asymmetric key pair, using an algorithm
like RSA or ECDSA. This key pair is used to create a Certificate Signing
Request (CSR), which contains a set of fields the requester would like in the
final certificate (but, it is up to the Certificate Authority (CA) to decide what
fields to take from the CSR and which to override). The CSR also contains the
public key of the pair, which is signed by the private key of the key pair to
prove possession. Usually, the requester would ask for attributes in the
Subject field of the CSR or in the Subject Alternative Name extension CSR to
be respected in the final certificate. It is up to the CA if these values are
trusted or not. When approved by the issuing authority (which may be backed by
this asymmetric key itself in the case of a root self-signed certificate), the
authority attaches the Subject of <em>its</em> certificate to the issued certificate in
the Issuer field, assigns a unique serial number to the issued certificate, and
signs the set of fields with its private key, thus creating the certificate.</p>
<p>There are some important restrictions here:</p>
<ul>
<li>One certificate can only have one Issuer, but this issuer is identified by
the Subject on the issuing certificate and its public key.</li>
<li>One key pair can be used for multiple certificates, but one certificate can
only have one backing key material.</li>
</ul>
<p>The following fields on the final certificate are relevant to rotation:</p>
<ul>
<li>The backing <a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.1.2.7" target="_blank" rel="noopener noreferrer">public</a>
and private key material (Subject Public Key Info).<!-- -->
<ul>
<li>Note that the private key is not included in the certificate but is
uniquely determined by the public key material.</li>
</ul>
</li>
<li>The <a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.1.2.6" target="_blank" rel="noopener noreferrer">Subject</a> of the certificate.<!-- -->
<ul>
<li>This identifies the entity to which the certificate was issued. While the
SAN values (in the <a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.6" target="_blank" rel="noopener noreferrer">Subject Alternative Name</a>
extension) is useful when validating TLS Server certificates against the
negotiated hostname and URI, it isn&#x27;t generally relevant for the purposes
of validating intermediate certificate chains or in rotation.</li>
</ul>
</li>
<li>The <a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.1.2.5" target="_blank" rel="noopener noreferrer">Validity</a>
period of this certificate.<!-- -->
<ul>
<li>Notably, RFC 5280 does not place any requirements around the issued
certificate&#x27;s validity period relative to the validity period of the
issuing certificate. However, it <a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.1.2.5" target="_blank" rel="noopener noreferrer">does state</a>
that certificates ought to be revoked if their status cannot be maintained
up to their notAfter date. This is why OpenBao&#x27;s <code>/pki/issuer/:issuer_ref</code>
configuration endpoint maintains the <code>leaf_not_after_behavior</code> per-issuer
rather than per-role.</li>
<li>Additionally, some browsers will place ultimate trust in the certificates
in their trust stores, even when these certificates are expired.<!-- -->
<ul>
<li>Note that this only applies to certificates in the trust store; validity
periods will still be enforced for certificates not in the store (such
as intermediates).</li>
</ul>
</li>
</ul>
</li>
<li>The <a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.1.2.4" target="_blank" rel="noopener noreferrer">Issuer</a> and
<a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.1.1.3" target="_blank" rel="noopener noreferrer">signatureValue</a>
of this certificate.<!-- -->
<ul>
<li>In the issued certificate&#x27;s Issuer field, the issuing certificate places
its own Subject value. This allows the issuer to be identified later
(without having to try signature validation against every known local
certificate), when validating the presented certificate and chain.</li>
<li>The signature over the entire certificate (by the issuer&#x27;s private key)
is then placed in the signatureValue field.</li>
</ul>
</li>
<li>The optional <a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.1" target="_blank" rel="noopener noreferrer">Authority Key Identifier</a>
field.<!-- -->
<ul>
<li>This field can contain either (or both) of two values:<!-- -->
<ul>
<li>The hash of the issuer&#x27;s public key. This extension is set and this
value is filled in by OpenBao.</li>
<li>The Issuer&#x27;s Subject and Serial Number. This value is not set by OpenBao.</li>
</ul>
</li>
<li>The latter is a dangerous restriction for the purposes of rotation: it
prevents cross-signing and reissuance as the new issuing certificates
(while having the same backing key material) will have different serial
numbers. See the <a href="#limitations-of-primitives">Limitations of Primitives</a>
section below for more information on this restriction.</li>
</ul>
</li>
<li>The <a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.1.2.2" target="_blank" rel="noopener noreferrer">Serial Number</a>
of this certificate.<!-- -->
<ul>
<li>This field is unique to a specific issuer; when a certificate is
reissued by its parent authority, it will always have a different serial
number field.</li>
</ul>
</li>
<li>The <a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.13" target="_blank" rel="noopener noreferrer">CRL distribution</a>
point field.<!-- -->
<ul>
<li>This is a field detailing where a CRL is expected to exist for this
certificate and under which CRL issuers (defaulting to the issuing
certificate itself) the CRL is expected to be signed by. This is mostly
informational and for server software like nginx, OpenBao&#x27;s Cert Auth method,
and Apache, CRLs are provided to the server, rather than having the
server fetch CRLs for certificates automatically.</li>
<li>Note that root certificates (in browsers trust stores) are generally not
considered revocable. However, if an intermediate is revoked by serial,
it will appear on its parent&#x27;s CRL, and may prevent rotation from
happening.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="x509-rotation-primitives">X.509 rotation primitives<a href="#x509-rotation-primitives" class="hash-link" aria-label="Direct link to X.509 rotation primitives" title="Direct link to X.509 rotation primitives">​</a></h2>
<p>Rotation (from an organizational standpoint) can only safely happen with
certain intermediate X.509 certificates being issued. To distinguish the two
types of certificates used to achieve rotation, this document notates them
as <em>primitives</em>.</p>
<p>Rotation of an end-entity certificate is trivial from an X.509 trust chain
perspective; this process happens every day and should only depend on what is
in the trust store and not the end-entity certificate itself. In OpenBao, the
requester would hit the various issuance endpoints (<code>/pki/issue/:name</code> or
<code>/pki/sign/:name</code> -- or use the unsafe <code>/pki/sign-verbatim</code>) and swap out the
old certificate with the new certificate and reload the configuration or
restart the service. Other parts of the organizations might use
<a href="https://datatracker.ietf.org/doc/html/rfc8555" target="_blank" rel="noopener noreferrer">ACME</a> for certificate issuance
and rotation, especially if the service is public-facing (and thus needs to
be issued by a Public CA). Given it was signed by a trusted root, any devices
connecting to the service would not know the difference.</p>
<p>Rotation of intermediate certificates is almost as easy. Assuming a decent
operational setup (wherein during end-entity issuance, the full certificate
chain is updated in the service&#x27;s configuration), this should be as easy as
creating a new intermediate CA, signing it against the root CA, and then
beginning issuance against the new intermediate certificate. In OpenBao, if
the intermediate is generated in an existing mount path (or is moved into
such), the requesting entity shouldn&#x27;t care much. Under ACME, Let&#x27;s Encrypt
has successfully rotated intermediates to present a cross-signed chain
(<a href="https://letsencrypt.org/2020/12/21/extending-android-compatibility.html" target="_blank" rel="noopener noreferrer">for older Android devices</a>).
Assuming the old intermediate&#x27;s parent(s) are still valid and trusted,
certificates issued under old intermediates should continue to validate.</p>
<p>The hard part of rotation--calling for the use of these primitives--is
rotating root certificates. These live in every device&#x27;s trust store and
are hard to update from an organization-wide operational perspective.
Unless the organization can swap out roots almost instantaneously and
simultaneously (e.g., via an agent) with no missed devices, this process
will likely span months.</p>
<p>To make this process lower risk, there are various primitive certificate
types that use the <a href="#x-509-certificate-fields">above certificate fields</a>.
Key to their success is the following note:</p>
<p>~&gt; Note: While certificates are added to the trust store, it is ultimately
the associated key material that determines trust: two issuer certificates
with the same subject but different public keys cannot validate the same
leaf certificate; only if the keys are the same can this occur.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cross-signed-primitive">Cross-Signed primitive<a href="#cross-signed-primitive" class="hash-link" aria-label="Direct link to Cross-Signed primitive" title="Direct link to Cross-Signed primitive">​</a></h3>
<p>This is the most common type of rotation primitive. A common CSR is signed by
two CAs, resulting in two certificates. These certificates must have the same
Subject (but may have different Issuers and will have different Serial Numbers)
and the same backing key material, to allow certificates they sign to be
trusted by either variant.</p>
<p>Note that, due to restrictions in how end-entity certificates are used and
validated (services and validation libraries expect only one), cross-signing
most typically only applies to intermediate.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="a-note-on-cross-signed-roots">A note on Cross-Signed roots<a href="#a-note-on-cross-signed-roots" class="hash-link" aria-label="Direct link to A note on Cross-Signed roots" title="Direct link to A note on Cross-Signed roots">​</a></h4>
<p>Technically, cross-signing can occur between two roots, allowing trust bundles
with either root to validate certs issued through the other. However, this
process creates a certificate that is effectively an intermediate (as it is
no longer self-signed) and usually must be served alongside the trust chain.
Given this restriction, it&#x27;s preferable to instead cross-sign the top-level
intermediates under the root unless strictly necessary when the old root
certificate has been used to directly issue leaf certificates.</p>
<p>So, the rest of this process flow assumes an intermediate is being
cross-signed as this is more common.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="process-flow">Process flow<a href="#process-flow" class="hash-link" aria-label="Direct link to Process flow" title="Direct link to Process flow">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        -------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       | generate key pair | -------------&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -------------------                 ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           |            |                   ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --------------        --------------       ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| generate CSR |      | generate CSR |      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --------------        --------------       ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         |                   |              ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -----------         -----------         ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   | signed by |       | signed by |        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   | root A    |       | root B    |        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -----------         -----------         ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here, a key pair was generated at some point in time. Two CSRs are created and
sent to two different root authorities (Root A and Root B). These result in two
separate certificates (potentially with different validity periods) with the
same Subject and same backing key material.</p>
<p>Note that this cross-signing need not happen simultaneously; there could be a
gap of several years between the first and second certificate. Additionally,
there&#x27;s no limit on the number of cross-signed &quot;duplicate&quot; (used loosely--with
the same subject and key material) certificates: this could be cross-signed
by many different root certificates if necessary and desired.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="certificate-hierarchy">Certificate hierarchy<a href="#certificate-hierarchy" class="hash-link" aria-label="Direct link to Certificate hierarchy" title="Direct link to Certificate hierarchy">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> --------                                            --------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| root A |                                          | root B |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --------                                            --------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |                                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ----------------                            ----------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| intermediate C |  &lt;- same key material -&gt; | intermediate D |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ----------------              |             ----------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      -------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     | leaf certificates |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      -------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The above process results in two trust paths: either of root A or root B (or
both) could exist in the client&#x27;s trust stores and the leaf certificate would
validate correctly. Because the same key material is used for both intermediate
certificates (C and D), the issued leaf certificate&#x27;s signature field would
be the same regardless of which intermediate was contacted.</p>
<p>Cross-signing is thus a unifying primitive; two separate trust paths now join
into a single one, by having leaf certificate&#x27;s issuer field to point to two
separate paths (via duplication of the certificate in the chain) and would be
conditionally validated based on which root is present in the trust store.</p>
<p>This construct is documented and used in several places:</p>
<ul>
<li><a href="https://letsencrypt.org/certificates/" target="_blank" rel="noopener noreferrer">https://letsencrypt.org/certificates/</a></li>
<li><a href="https://scotthelme.co.uk/cross-signing-alternate-trust-paths-how-they-work/" target="_blank" rel="noopener noreferrer">https://scotthelme.co.uk/cross-signing-alternate-trust-paths-how-they-work/</a></li>
<li><a href="https://security.stackexchange.com/questions/14043/what-is-the-use-of-cross-signing-certificates-in-x-509" target="_blank" rel="noopener noreferrer">https://security.stackexchange.com/questions/14043/what-is-the-use-of-cross-signing-certificates-in-x-509</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="execution-in-openbao">Execution in OpenBao<a href="#execution-in-openbao" class="hash-link" aria-label="Direct link to Execution in OpenBao" title="Direct link to Execution in OpenBao">​</a></h4>
<p>To create a cross-signed certificate in OpenBao, use the <a href="/openbao/api-docs/secret/pki/#generate-intermediate-csr"><code>/intermediate/cross-sign</code>
endpoint</a>. Here, when creating
a cross-signature to all <code>cert B</code> to be validated by <code>cert A</code>, provide the values
(<code>key_ref</code>, all Subject parts, &amp;c) for <code>cert B</code> during intermediate generation.
Then sign this CSR (using the <a href="/openbao/api-docs/secret/pki/#sign-intermediate"><code>/issuer/:issuer_ref/sign-intermediate</code>
endpoint</a>) with <code>cert A</code>&#x27;s reference
and provide necessary values from <code>cert B</code> (e.g., Subject parts). <code>cert A</code> may
live outside OpenBao. Finally, import the cross-signed certificate into OpenBao
<a href="/openbao/api-docs/secret/pki/#import-ca-certificates-and-keys">using the <code>/issuers/import/cert</code> endpoint</a>.</p>
<p>If this process succeeded, and both <code>cert A</code> and <code>cert B</code> and their key
material lives in OpenBao, the newly imported cross-signed certificate
will have a <code>ca_chain</code> response field <a href="/openbao/api-docs/secret/pki/#read-issuer">during read</a>
containing <code>cert A</code>, and <code>cert B</code>&#x27;s <code>ca_chain</code> will contain the cross-signed
cert and its <code>ca_chain</code> value.</p>
<p>~&gt; Note: Regardless of issuer type, is important to provide all relevant
parameters as they were originally; OpenBao does not infer e.g., the Subject
name parameters from the existing issuer; it merely reuses the same key
material.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="notes-on-manual_chain">Notes on <code>manual_chain</code><a href="#notes-on-manual_chain" class="hash-link" aria-label="Direct link to notes-on-manual_chain" title="Direct link to notes-on-manual_chain">​</a></h5>
<p>If an intermediate is cross-signed and imported into the same mount as its
pair, OpenBao will not detect the cross-signed pairs during automatic chain
building. As a result, leaf issuance will have a chain that only includes
one of these pairs of chains. This is because the leaf issuance&#x27;s <code>ca_chain</code>
parameter copies the value from signing issuer directly, rather than computing
its own copy of the chain.</p>
<p>To fix this, update the <code>manual_chain</code> field on the <a href="/openbao/api-docs/secret/pki/#update-issuer">issuers</a>
to include the chains of both pairs. For instance, given <code>intA</code> signed by
<code>rootA</code> and <code>intB</code> signed by <code>rootB</code> as its cross-signed version, one
could do the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bao patch pki/issuer/intA manual_chain=self,rootA,intB,rootB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bao patch pki/issuer/intB manual_chain=self,rootB,intA,rootA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will ensure that issuance with either copy of the intermediate reports
the full cross-signed chain when signing leaf certs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reissuance-primitive">Reissuance primitive<a href="#reissuance-primitive" class="hash-link" aria-label="Direct link to Reissuance primitive" title="Direct link to Reissuance primitive">​</a></h3>
<p>The second most common type of rotation primitive. In this scheme, the existing
key material is used to generate a new certificate, usually at a much later
point in time from the existing issuance.</p>
<p>While similar to the cross-signed primitive, this one differs in that usually
the reissuance happens after the original certificate expires or is close to
expiration and is reissued by the original root CA. In the event of a
self-signed certificate (e.g., a root certificate), this parent certificate
would be itself. In both cases, this changes the contents of the certificate
(due to the new serial number) but allows all existing leaf signatures to
still validate.</p>
<p>Unlike the cross-signed primitive, this primitive type can be used on all
types of certificates (including leaves, intermediates, and roots).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="process-flow-1">Process flow<a href="#process-flow-1" class="hash-link" aria-label="Direct link to Process flow" title="Direct link to Process flow">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">          -------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         | generate key pair | ---------------&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          -------------------                   ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           |              |                     ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --------------           --------------        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| generate CSR |   &lt;-&gt;   | generate CSR |       ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --------------           --------------        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         |                    |                 ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ------------------      ------------------     ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| signed by issuer | -&gt; | signed by issuer | -&gt; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ------------------      ------------------     ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this process flow, a single key pair is generated at some point in time
and stored. The CSR (with same requested fields) is generated from this
common key material and signed by the same issuer at multiple points in
time, preserving all critical fields (Subject, Issuer, &amp;c). While there is
strictly no limit on the number of times a key can be reissued, at some point
safety would dictate the key material should be rotated instead of being
continually reissued.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="certificate-hierarchy-1">Certificate hierarchy<a href="#certificate-hierarchy-1" class="hash-link" aria-label="Direct link to Certificate hierarchy" title="Direct link to Certificate hierarchy">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">                          ------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              -----------| root |-------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             /            ------              \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---------------                           ---------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| original cert | &lt;- same key material -&gt; | reissued cert |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---------------              |            ---------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      -------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     | leaf certificates |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      -------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that while this again results in two trust paths, depending on which
intermediate certificate is presented and is still valid, only a root need be
trusted. When a reissued certificate is a root certificate, the issuance link is
simply self-loop. But, in this case, note that both certificates are
(technically) valid issuers of each other. This means it should be possible to
provide a reissued root certificate in the TLS certificate chain and have it
chain back to an existing root certificate in a trust store.</p>
<p>This primitive type is thus an incrementing primitive; the life cycle of an
existing key is extended into the future by issuing a new certificate with the
same key material from the existing authority.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="execution-in-openbao-1">Execution in OpenBao<a href="#execution-in-openbao-1" class="hash-link" aria-label="Direct link to Execution in OpenBao" title="Direct link to Execution in OpenBao">​</a></h4>
<p>To create a reissued root certificate in OpenBao, use <a href="/openbao/api-docs/secret/pki/#generate-root"><code>/issuers/generate/root/existing</code>
endpoint</a>. This allows the generation of a new
root certificate with the existing key material (via the <code>key_ref</code> request parameter).
If this process succeeded, when <a href="/openbao/api-docs/secret/pki/#read-issuer">reading the issuer</a>
(via <code>GET /issuer/:issuer_ref</code>), both issuers (old and reissued) will appear in
each others&#x27; <code>ca_chain</code> response field (unless prevented so by a <code>manual_chain</code>
value).</p>
<p>To create a reissued intermediate certificate in OpenBao, this is a three step
process:</p>
<ol>
<li>Use the <a href="/openbao/api-docs/secret/pki/#generate-intermediate-csr"><code>/issuers/generate/intermediate/existing</code>
endpoint</a>
to generate a new CSR with the existing key material with the <code>key_ref</code>
request parameter.</li>
<li>Sign this CSR via the same signing process under the same issuer. This
step is specific to the parent CA, which may or may not be OpenBao.</li>
<li>Finally, use the <a href="/openbao/api-docs/secret/pki/#import-ca-certificates-and-keys"><code>/intermediate/set-signed</code> endpoint</a>
to import the signed certificate from step 2.</li>
</ol>
<p>If the process to reissue an intermediate certificate succeeded, when
<a href="/openbao/api-docs/secret/pki/#read-issuer">reading the issuer</a> (via
<code>GET /issuer/:issuer_ref</code>), both issuers (old and reissued) will have
the same <code>ca_chain</code> response field, except for the first entry (unless
prevented so by a <code>manual_chain</code> value).</p>
<p>~&gt; Note: Regardless of issuer type, is important to provide all relevant
parameters as they were originally; OpenBao does not infer e.g., the Subject
name parameters from the existing issuer; it merely reuses the same key
material.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="temporal-primitives">Temporal primitives<a href="#temporal-primitives" class="hash-link" aria-label="Direct link to Temporal primitives" title="Direct link to Temporal primitives">​</a></h3>
<p>We can use the above primitive types to rotate roots and intermediates to new
keys and extend their lifetimes. This time-based rotation is what ultimately
allows us to rotate root certificates.</p>
<p>There&#x27;s two main variants of this: a <strong>forward</strong> primitive, wherein an old
certificate is used to bless new key material, and a <strong>backwards</strong> primitive,
wherein a new certificate is used to bless old key material. Both of these
primitives are independently used by Let&#x27;s Encrypt in the aforementioned
chain of trust document:</p>
<ul>
<li>The link from DST Root CA X3 to ISRG Root X1 is an example of a forward
primitive.</li>
<li>The link from ISRG Root X1 to R3 (which was originally signed by DST Root
CA X3) is an example of a backwards primitive.</li>
</ul>
<p>For most organizations with a hierarchical structured CA setup, cross-signing
all intermediates with both the new and old root CAs is sufficient for root
rotation.</p>
<p>However, for organizations which have directly issued leaf certificates from a
root, the old root will need to be reissued under the new root (with shorter
duration) to allow these certificates to continue to validate. This combines
both of the above primitives (cross-signing and reissuance) into a single
backwards primitive step. In the future, these organizations should probably
move to a more standard, hierarchical setup.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="limitations-of-primitives">Limitations of primitives<a href="#limitations-of-primitives" class="hash-link" aria-label="Direct link to Limitations of primitives" title="Direct link to Limitations of primitives">​</a></h3>
<p>The certificate&#x27;s <a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.2.1.1" target="_blank" rel="noopener noreferrer">Authority Key Identifier</a>
extension field may contain either or both of the issuer&#x27;s keyIdentifier
(a hash of the public key) or both the issuer&#x27;s Subject and Serial Number
fields. Generating certificates with the latter enabled (luckily not possible
in OpenBao, especially so since OpenBao uses strictly random serial numbers)
prevents building a proper cross-signed chain without re-issuing the same
serial number, which will not work with most browsers&#x27; trust stores and
validation engines, due to <a href="https://support.mozilla.org/en-US/kb/Certificate-contains-the-same-serial-number-as-another-certificate" target="_blank" rel="noopener noreferrer">caching of
certificates</a>
used in successful validations. In the strictest sense, when using a
cross-signing primitive (from a different CA), the intermediate could be reissued
with the same serial number, assuming no previous certificate was issued by that
CA with that serial. This does not work when using a reissuance primitive as these
are technically the same authority and thus this authority must issue
certificates with unique serial numbers.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="suggested-root-rotation-procedure">Suggested root rotation procedure<a href="#suggested-root-rotation-procedure" class="hash-link" aria-label="Direct link to Suggested root rotation procedure" title="Direct link to Suggested root rotation procedure">​</a></h2>
<p>The following is a suggested process for achieving root rotation easily and
without (outage) impact to the broader organization, assuming <a href="/openbao/docs/secrets/pki/considerations/#use-a-ca-hierarchy">best
practices</a> are
being followed. Some adaption will be necessary.</p>
<p>Note that this process takes time. How much time is dependent on the
automation level and operational awareness of the organization.</p>
<ol>
<li>
<p><a href="/openbao/api-docs/secret/pki/#generate-root">Generate</a> the new root
certificate. For clarity, it is suggested to use a new common name
to distinguish it from the old root certificate. Key material need
not be the same.</p>
</li>
<li>
<p><a href="#cross-signed-primitive">Cross-sign</a> all existing intermediates.
It is important to update the manual chain on the issuers as discussed
in that section, as we assume servers are configured to combine the
<code>certificate</code> field with the <code>ca_chain</code> field on renewal and issuance,
thus getting the cross-signed intermediates.</p>
</li>
<li>
<p>Encourage rotation to pickup the new cross-signed intermediates. With
short-lived certificates, this should <a href="/openbao/docs/secrets/pki/considerations/#automate-leaf-certificate-renewal">happen
automatically</a>.
However, for some long-lived certs, it is suggested to rotate them
manually and proactively. This step takes time, and depends on the
types of certificates issued (e.g., server certs, code signing, or client
auth).</p>
</li>
<li>
<p>Once <em>all</em> chains have been updated, new systems can be brought online
with only the new root certificate, and connect to all existing systems.</p>
</li>
<li>
<p>Existing systems can now be migrated with a one-shot root switch: the
new root can be added and the old root can be removed at the same time.
Assuming the above step 3 can be achieved in a reasonable amount of time,
this decreases the time it takes to move the majority of systems over to
fully using the new root and no longer trusting the old root. This step
also takes time, depending on how quickly the organization can migrate
roots and ensure all such systems are migrated. If some systems are
offline and only infrequently online (or, if they have hard-coded
certificate stores and need to reach obsolescence first), the organization
might not be ready to move on to future steps.</p>
</li>
<li>
<p>At this point, since all systems now use the new root, it is safe to remove
or archive the old root and intermediates, updating the manual chain to
point strictly to the new intermediate+root.</p>
</li>
</ol>
<p>At this point, rotation is fully completed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tutorial">Tutorial<a href="#tutorial" class="hash-link" aria-label="Direct link to Tutorial" title="Direct link to Tutorial">​</a></h2>
<p>Refer to the <a href="/openbao/tutorials/secrets-management/pki-engine/">Build Your Own Certificate Authority (CA)</a>
guide for a step-by-step tutorial.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="api">API<a href="#api" class="hash-link" aria-label="Direct link to API" title="Direct link to API">​</a></h2>
<p>The PKI secrets engine has a full HTTP API. Please see the
<a href="/openbao/api-docs/secret/pki/">PKI secrets engine API</a> for more
details.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/openbao/openbao/tree/main/website/content/docs/secrets/pki/rotation-primitives.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/openbao/docs/secrets/pki/quick-start-root-ca/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">PKI secrets engine - quick start - root CA setup</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/openbao/docs/secrets/pki/setup/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">PKI secrets engine - setup and usage</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#x509-certificate-fields" class="table-of-contents__link toc-highlight">X.509 certificate fields</a></li><li><a href="#x509-rotation-primitives" class="table-of-contents__link toc-highlight">X.509 rotation primitives</a><ul><li><a href="#cross-signed-primitive" class="table-of-contents__link toc-highlight">Cross-Signed primitive</a></li><li><a href="#reissuance-primitive" class="table-of-contents__link toc-highlight">Reissuance primitive</a></li><li><a href="#temporal-primitives" class="table-of-contents__link toc-highlight">Temporal primitives</a></li><li><a href="#limitations-of-primitives" class="table-of-contents__link toc-highlight">Limitations of primitives</a></li></ul></li><li><a href="#suggested-root-rotation-procedure" class="table-of-contents__link toc-highlight">Suggested root rotation procedure</a></li><li><a href="#tutorial" class="table-of-contents__link toc-highlight">Tutorial</a></li><li><a href="#api" class="table-of-contents__link toc-highlight">API</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/openbao/docs/">Intro</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openbao/openbao/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://chat.lfx.linuxfoundation.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat Server<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://wiki.lfedge.org/display/OH/OpenBao+%28Hashicorp+Vault+Fork+effort%29+FAQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openbao/openbao" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 The OpenBao Authors. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>