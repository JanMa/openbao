<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-rfcs/paginated-lists" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.0">
<title data-rh="true">Paginated lists | OpenBao</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://janma.github.io/openbao/docs/rfcs/paginated-lists/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Paginated lists | OpenBao"><meta data-rh="true" name="description" content="An OpenBao RFCs for paginating lists in the API, CLI, and storage backends."><meta data-rh="true" property="og:description" content="An OpenBao RFCs for paginating lists in the API, CLI, and storage backends."><link data-rh="true" rel="icon" href="/openbao/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://janma.github.io/openbao/docs/rfcs/paginated-lists/"><link data-rh="true" rel="alternate" href="https://janma.github.io/openbao/docs/rfcs/paginated-lists/" hreflang="en"><link data-rh="true" rel="alternate" href="https://janma.github.io/openbao/docs/rfcs/paginated-lists/" hreflang="x-default"><link rel="stylesheet" href="/openbao/assets/css/styles.21d6cb17.css">
<script src="/openbao/assets/js/runtime~main.6f3294b2.js" defer="defer"></script>
<script src="/openbao/assets/js/main.91832dc9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#ffba00;color:#091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY">The documentation is still work in progress. If you find any mistakes, please open an <a href="https://github.com/openbao/openbao/issues" target="_blank">issue</a></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/openbao/"><div class="navbar__logo"><img src="/openbao/img/logo-black.svg" alt="OpenBao Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/openbao/img/logo-white.svg" alt="OpenBao Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OpenBao</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/openbao/docs/">Docs</a><a class="navbar__item navbar__link" href="/openbao/api-docs/">API</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://github.com/openbao/openbao/discussions" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub Discussions<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://chat.lfx.linuxfoundation.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Chat Server<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://wiki.lfedge.org/display/OH/OpenBao+%28Hashicorp+Vault+Fork+effort%29+FAQ" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/openbao/openbao" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/what-is-openbao/">What is OpenBao?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/use-cases/">Use cases</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/get-started/developer-qs/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/browser-support/">Browser Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/install/">Installing OpenBao</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/internals/">Internals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/concepts/">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/configuration/">Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/commands/">Commands (CLI)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/agent-and-proxy/">OpenBao Agent and Proxy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/secrets/">Secret Engines</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/auth/">Auth Methods</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/audit/">Audit Devices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/plugins/">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/upgrading/">Upgrade Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/release-notes/">Release Notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/deprecation/">Deprecation Notices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/policies/">Policies</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/contributing/">Contributing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/openbao/docs/rfcs/">RFCs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/rfcs/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/openbao/docs/rfcs/paginated-lists/">Paginated lists</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/openbao/docs/faq/">FAQ</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/glossary/">Glossary</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/openbao/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">RFCs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Paginated lists</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Paginated lists</h1>
<p><strong>Status</strong>: this landed in <a href="https://github.com/openbao/openbao/pull/170" target="_blank" rel="noopener noreferrer">PR #170</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>OpenBao&#x27;s <code>LIST</code> Plugin APIs presently only supports returning all keys within a tree, resulting in many performance issues (memory and compute). By implementing pagination, the caller can limit the number of responses and thus reduce both the client&#x27;s and server&#x27;s instantaneous resource consumption.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="problem-statement">Problem statement<a href="#problem-statement" class="hash-link" aria-label="Direct link to Problem statement" title="Direct link to Problem statement">​</a></h2>
<p><code>LIST</code> APIs in plugins historically have been forced to be authenticated, to mitigate DoS likelihood. This is because many secrets engines (and other areas of OpenBao) have unbounded creation, and thus, unbounded lists. For example, <a href="https://developer.hashicorp.com/vault/api-docs/secret/kv/kv-v2#create-update-secret" target="_blank" rel="noopener noreferrer">K/V allows</a> an arbitrary number of keys within a path, PKI places all <a href="https://developer.hashicorp.com/vault/api-docs/secret/pki#list-certificates" target="_blank" rel="noopener noreferrer">(valid or revoked) certificates</a> in a single path by serial number, and Transit allows <a href="https://developer.hashicorp.com/vault/api-docs/secret/transit#create-key" target="_blank" rel="noopener noreferrer">arbitrary key creation</a> (again, placed within a single path in storage). Browsing these potentially large collections (either via UI or an API client) is unwieldy and causes resource consumption on both the client and server. This often makes it hard for users to find what they&#x27;re looking for.</p>
<p>Furthermore, certain operations (like PKI&#x27;s tidy operation) requires <code>List(...)</code>ing the entire collection in order to prune them; this requires the collection of items fits in memory of the server. However, this operation can be interrupted, whether through explicit pauses and releasing and re-acquiring locks. Keeping this entire collection in memory thus reduces the amount of resources for regular operations to continue. In extreme cases, thousands of mounts with 100k-1m leaf certificates per mount have been observed; this leads to around 100MB+ of memory just for the list, per mount, potentially requiring 100GB+ of memory for all mounts to be able to tidy in parallel.</p>
<p>These limitations are discussed in various upstream issues, e.g., <a href="https://github.com/hashicorp/vault/issues/21164" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/vault/issues/21164</a> or <a href="https://github.com/hashicorp/vault/issues/21041" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/vault/issues/21041</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="user-facing-description">User-facing description<a href="#user-facing-description" class="hash-link" aria-label="Direct link to User-facing description" title="Direct link to User-facing description">​</a></h2>
<p>Efficient pagination allows incremental discovery over large data sets. For instance, the web UI will load the first subset of data much more quickly and subsequent navigation to later pages will happen much more quickly. Similarly, periodic scripts that need to iterate over a large quantity of data can do so more efficiently than requesting an entire list up front.</p>
<p>However, note that this pagination is not intended to be bound to a transaction: entries may not be present if they were created after a given page range was iterated over.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h4>
<p>Given a storage prefix with keys like:</p>
<ul>
<li><code>abcd</code></li>
<li><code>efgh</code></li>
<li><code>ijkl</code></li>
<li><code>mnop</code></li>
<li><code>qrst</code></li>
<li><code>uwxy</code></li>
</ul>
<p>Then:</p>
<ul>
<li><code>List(...)</code>, <code>ListPage(..., &quot;&quot;, -1)</code>, <code>ListPage(..., &quot;&quot;, 0)</code>, <code>ListPage(..., &quot;&quot;, 6)</code>, and <code>ListPage(..., &quot;&quot;, 1000)</code> would return all of them.</li>
<li><code>ListPage(..., &quot;a&quot;, -1)</code> would also return all of them, as <code>&quot;a&quot; &lt; &quot;abcd&quot;</code>.</li>
<li><code>ListPage(..., &quot;b&quot;, -1)</code> would return <code>efgh</code> through <code>uwxy</code></li>
<li><code>ListPage(..., &quot;b&quot;, 2)</code> would return <code>efgh</code> and <code>ijkl</code></li>
<li><code>ListPage(..., &quot;ijkl&quot;, 1)</code> would return <code>mnop</code>.</li>
<li><code>ListPage(..., &quot;z&quot;, -1)</code> would return nothing.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="technical-description">Technical description<a href="#technical-description" class="hash-link" aria-label="Direct link to Technical description" title="Direct link to Technical description">​</a></h2>
<p>This RFC proposes a unified storage &amp; plugin pagination API, <code>ListPage(...)</code>, taking three parameters:</p>
<ul>
<li><code>prefix</code>, a tree in storage to list the keys under. This is the existing parameter to <code>List(...)</code>.</li>
<li><code>after</code>, a string key which may or may not be present within the directory to list keys appearing after alphabetically. This defaults to the empty string, meaning the first entry will be included. This value is exclusive so if <code>after</code> is a key within the tree, it will not be included in this page of results.</li>
<li><code>limit</code>, a number of items to return. When non-positive (zero or negative), it will return all items. Defaults to zero.</li>
</ul>
<p>The return value is the same as <code>List(...)</code>, namely the (now filtered via pagination) list of results or an err if one occurred. Notably, no new error cases are required here: the behavior of <code>after</code> (if not present) is similar to that of a binary search (in that the next value is returned) and the behavior of <code>limit</code> should gracefully handle negative values.</p>
<p>This API will need to be exposed throughout the internal physical and storage APIs, but also through to many plugin &amp; system <code>LIST</code> API endpoints. Concretely:</p>
<ul>
<li>Raft, in-memory, and file physical storage backends will need to implement these APIs. Of these, Raft is the suggested production backend and thus requires the most care. However, boltdb (the underlying K/V storage mechanism) already has a <code>c.Seek(...)</code> method that provides efficient implementation of the functionality we want.</li>
<li>Many interfaces (such as <code>logical.Storage</code> and <code>physical.Backend</code> and the plugin GRPC interface) will need to be updated to include the new storage function.</li>
<li><code>api.Client</code> will need to implement a new <code>ListPage</code> Plugin API interface, and the <code>bao list</code> CLI will need <code>-after</code> and <code>-limit</code> flags.</li>
<li>Many plugins will need to be incrementally updated, so that any of their <code>LIST</code> Plugin APIs will add <code>after</code> and <code>limit</code> parameters.</li>
<li>And, eventually, the UI will need to be incrementally updated, so that expensive lists (such as PKI&#x27;s leaf and issuer lists) use the new pagination functionality.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rationale-and-alternatives">Rationale and alternatives<a href="#rationale-and-alternatives" class="hash-link" aria-label="Direct link to Rationale and alternatives" title="Direct link to Rationale and alternatives">​</a></h2>
<p>The resource consumption and DoS prevention benefits justify this change.</p>
<p>An alternative proposal, not necessarily exclusive, is to implement filtering as suggested in <a href="https://github.com/hashicorp/vault/issues/24046" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/vault/issues/24046</a>. The core of this request articulates concerns about performance, which this addresses, though note that <em>searching</em> for a particular key would still require many requests to the server (to exhaust the list -- rather than the search being performed on the server itself). If this is still desired after implementing this proposal, IMO, this can be implemented then. Note that the combination of the two (filter + paginate) still makes sense in general, if the number of matching entries is large.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="downsides">Downsides<a href="#downsides" class="hash-link" aria-label="Direct link to Downsides" title="Direct link to Downsides">​</a></h2>
<p>Notably, this pagination API does not contain a cursor reference: subsequent calls may obscure or contain data created after the initial calls. For many use cases, this is sufficient; when this is not and a single consistent view is required, it is suggested to continue to use the unrestricted <code>LIST</code> API.</p>
<p>Furthermore, while transactions are not yet expose to storage plugins, it is not clear how this would interact with that capability, if and when implemented.</p>
<p>Lastly, this places an increased burden on maintainers of other storage backends: this is the first breaking change from upstream w.r.t. the physical storage backend; if anyone wished to re-add support for a non-Raft backend, they would now need to implement this functionality. This solidifies API-compatibility only for non-Raft storage backends, preventing seal compatibility without changes on the maintainers&#x27; parts. However, a quick, non-performant implementat (used in the File and encryptedKeyStorage implementations) is to do a binary search (for <code>after</code>) and then apply the <code>limit</code>, after doing a regular <code>List(...)</code> call. This is less performant than ideal, but contains the performance loss to the storage backend in question.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ecosystem-compatibility">Ecosystem compatibility<a href="#ecosystem-compatibility" class="hash-link" aria-label="Direct link to Ecosystem compatibility" title="Direct link to Ecosystem compatibility">​</a></h3>
<p>Not immediately clear is how ecosystem compatibility works with GRPC; this is worth investigating more.</p>
<p>Consider two scenarios:</p>
<ol>
<li>A plugin built against Vault&#x27;s SDK, running on OpenBao. Presumably, no compatibility issues would occur as this would strictly use a common subset of calls.</li>
<li>A plugin built against OpenBao&#x27;s SDK, running on Vault. Here, <del>assuming the missing server GRPC implementation doesn&#x27;t cause the plugin to panic</del>, OpenBao&#x27;s SDK could implement the <code>log(n)</code> re-implementation of <code>ListPage(...)</code> (used by the file storage backend) that assumes <code>List(...)</code> returns in sorted order. This can provide a compatibility shim so plugins could be buitl and progressively take advantage of the new call, and trap the error from propagating.</li>
</ol>
<p>The second of these cases is more worrying, though, from the PoC below, looks to be OK.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-implications">Security implications<a href="#security-implications" class="hash-link" aria-label="Direct link to Security implications" title="Direct link to Security implications">​</a></h2>
<p>This improves the security posture of <code>LIST</code> operations. Policies and engines can, if desired, now enforce a positive value on the <code>limit</code> parameter, thereby preventing expensive, unbounded <code>LIST</code> operations that could cause a soft DoS on the server. With the right storage backend (Raft), this is efficient.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="userdeveloper-experience">User/developer experience<a href="#userdeveloper-experience" class="hash-link" aria-label="Direct link to User/developer experience" title="Direct link to User/developer experience">​</a></h2>
<p>User experience will greatly improve as a result of this. No pagination will occur by default, so existing workloads will be unchanged, but as developers change integrations, both behind the scenes in the official UI but also elsewhere within apps calling <code>LIST</code> endpoints with the new pagination parameters, performance will improve everywhere.</p>
<p>The experience is also forgiving: if <code>after</code> is not provided, or a weird value for <code>limit</code> is applied, the result is handled gracefully.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="unresolved-questions">Unresolved questions<a href="#unresolved-questions" class="hash-link" aria-label="Direct link to Unresolved questions" title="Direct link to Unresolved questions">​</a></h2>
<p>Interaction with transactional storage remains untested and unknown. This can likely not to be much of an issue (as it is implemented the same was as a <code>LIST</code> operation is), but when transactions are added to the Storage,</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="related-issues">Related issues<a href="#related-issues" class="hash-link" aria-label="Direct link to Related issues" title="Direct link to Related issues">​</a></h2>
<p>Upstream issues (subset of known ones):</p>
<ul>
<li><a href="https://github.com/hashicorp/vault/issues/21164" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/vault/issues/21164</a></li>
<li><a href="https://github.com/hashicorp/vault/issues/21041" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/vault/issues/21041</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proof-of-concept">Proof of concept<a href="#proof-of-concept" class="hash-link" aria-label="Direct link to Proof of concept" title="Direct link to Proof of concept">​</a></h2>
<p>See: <a href="https://github.com/cipherboy/openbao/pull/new/paginated-lists" target="_blank" rel="noopener noreferrer">https://github.com/cipherboy/openbao/pull/new/paginated-lists</a></p>
<p>To try it out: check out the branch locally and build according to instructions in the README.</p>
<p>Then start a bao server in one terminal:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bao server -dev -dev-listen-address=&quot;0.0.0.0:$port&quot; -dev-root-token-id=devroot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And initialize state in another:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bao secrets enable pki</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bao write pki/root/generate/internal key_type=ed25519 issuer_name=&quot;root-x1&quot; common_name=&quot;Root X1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bao write pki/root/generate/internal key_type=ed25519 issuer_name=&quot;root-x2&quot; common_name=&quot;Root X2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bao write pki/roles/testing-ed25519 allow_any_name=true key_type=ed25519</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bao write pki/roles/testing-rsa allow_any_name=true key_type=rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ for i in `seq 1 10`; do bao write pki/issue/testing-ed25519 common_name=example.com ttl=5s ; done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now listing should work via the CLI:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bao list -detailed pki/issuers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Keys                                    is_default    issuer_name    key_id                                  serial_number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----                                    ----------    -----------    ------                                  -------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">54d97997-55d1-0b76-a2cf-ba8a6cdec2cb    false         root-x2        19836fbb-1f02-1e65-26a4-1c678c585ae6    74:77:fb:8e:95:ef:bd:69:0f:66:0d:04:dd:ad:01:2b:60:51:e6:3c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">79859a88-482c-40e4-c889-2da7f5327b29    true          root-x1        517ff4db-f26c-9aa5-0bf6-f145dda9396f    26:8c:34:74:59:78:88:72:b7:9e:b7:1b:a9:33:a1:a5:c2:2b:1b:02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bao list -detailed -limit=1 pki/issuers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Keys                                    is_default    issuer_name    key_id                                  serial_number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----                                    ----------    -----------    ------                                  -------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">54d97997-55d1-0b76-a2cf-ba8a6cdec2cb    false         root-x2        19836fbb-1f02-1e65-26a4-1c678c585ae6    74:77:fb:8e:95:ef:bd:69:0f:66:0d:04:dd:ad:01:2b:60:51:e6:3c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bao list pki/roles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testing-ed25519</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testing-rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bao list -after=testing-ed25519 pki/roles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testing-rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bao list -after=7 -limit=2 pki/certs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">74:77:fb:8e:95:ef:bd:69:0f:66:0d:04:dd:ad:01:2b:60:51:e6:3c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">77:bd:a5:75:91:29:06:48:10:dd:eb:1b:59:4b:90:91:08:ed:ef:af</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/openbao/openbao/tree/main/website/content/docs/rfcs/paginated-lists.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/openbao/docs/rfcs/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/openbao/docs/faq/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FAQ for product and features</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#problem-statement" class="table-of-contents__link toc-highlight">Problem statement</a></li><li><a href="#user-facing-description" class="table-of-contents__link toc-highlight">User-facing description</a></li><li><a href="#technical-description" class="table-of-contents__link toc-highlight">Technical description</a></li><li><a href="#rationale-and-alternatives" class="table-of-contents__link toc-highlight">Rationale and alternatives</a></li><li><a href="#downsides" class="table-of-contents__link toc-highlight">Downsides</a><ul><li><a href="#ecosystem-compatibility" class="table-of-contents__link toc-highlight">Ecosystem compatibility</a></li></ul></li><li><a href="#security-implications" class="table-of-contents__link toc-highlight">Security implications</a></li><li><a href="#userdeveloper-experience" class="table-of-contents__link toc-highlight">User/developer experience</a></li><li><a href="#unresolved-questions" class="table-of-contents__link toc-highlight">Unresolved questions</a></li><li><a href="#related-issues" class="table-of-contents__link toc-highlight">Related issues</a></li><li><a href="#proof-of-concept" class="table-of-contents__link toc-highlight">Proof of concept</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OpenBao a Series of LF Projects, LLC <br> For web site terms of use, trademark policy and other project policies please see <a href="https://lfprojects.org">lfprojects.org</a>. <br>  OpenBao is a <a href="https://wiki.lfedge.org/display/LE/Stage+1%3A+At+Large">Stage One project</a> at <a href="https://www.lfedge.org/"><img src="/openbao/img/lfedge-logo.svg" alt="LF Edge Logo" width="90px"></a>.</div></div></div></footer></div>
</body>
</html>