<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/integrated-storage/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Integrated storage | OpenBao</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://janma.github.io/openbao/docs/concepts/integrated-storage/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Integrated storage | OpenBao"><meta data-rh="true" name="description" content="Learn about the integrated raft storage in OpenBao."><meta data-rh="true" property="og:description" content="Learn about the integrated raft storage in OpenBao."><link data-rh="true" rel="icon" href="/openbao/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://janma.github.io/openbao/docs/concepts/integrated-storage/"><link data-rh="true" rel="alternate" href="https://janma.github.io/openbao/docs/concepts/integrated-storage/" hreflang="en"><link data-rh="true" rel="alternate" href="https://janma.github.io/openbao/docs/concepts/integrated-storage/" hreflang="x-default"><link rel="stylesheet" href="/openbao/assets/css/styles.a7459e73.css">
<script src="/openbao/assets/js/runtime~main.905ad1f5.js" defer="defer"></script>
<script src="/openbao/assets/js/main.e1fe259b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/openbao/"><div class="navbar__logo"><img src="/openbao/img/logo.svg" alt="OpenBao Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/openbao/img/logo.svg" alt="OpenBao Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OpenBao</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/openbao/docs/">Docs</a><a class="navbar__item navbar__link" href="/openbao/api-docs/">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/openbao/openbao" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/what-is-openbao/">What is OpenBao?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/use-cases/">Use cases</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/get-started/developer-qs/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/browser-support/">Browser Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/install/">Installing OpenBao</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/internals/">Internals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/openbao/docs/concepts/">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/dev-server/">&#x27;Dev&#x27; Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/seal/">Seal/Unseal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/lease/">Lease, renew, and revoke</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/auth/">Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/tokens/">Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/identity/">Identity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/oidc-provider/">OIDC provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/response-wrapping/">Response wrapping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/policies/">Policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/password-policies/">Password policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/username-templating/">Username templating</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/ha/">High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/storage/">Storage</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/openbao/docs/concepts/integrated-storage/">Integrated Storage</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/openbao/docs/concepts/integrated-storage/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/integrated-storage/autopilot/">Autopilot</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/pgp-gpg-keybase/">PGP, GnuPG and Keybase</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/recovery-mode/">Recovery mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/resource-quotas/">Resource quotas</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/openbao/docs/concepts/client-count/">Client Clount</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/transform/">Transform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/mount-migration/">Mount migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/duration-format/">Duration string format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/user-lockout/">User lockout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/events/">Events</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/configuration/">Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/commands/">Commands (CLI)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/agent-and-proxy/">OpenBao Agent and Proxy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/secrets/">Secret Engines</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/auth/">Auth Methods</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/audit/">Audit Devices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/plugins/">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/platform/">Platforms</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/upgrading/">Upgrade Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/release-notes/">Release Notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/deprecation/">Deprecation Notices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/policies/">Policies</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/faq/">FAQ</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/glossary/">Glossary</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/openbao/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Concepts</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Integrated Storage</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Overview</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Integrated storage</h1>
<p>OpenBao supports a number of storage options for the durable storage of OpenBao&#x27;s
information. This Integrated Storage backend does not rely on any third party
systems, implements high availability semantics and provides backup/restore
workflows.</p>
<p>The option stores OpenBao&#x27;s data on the server&#x27;s filesystem and
uses a consensus protocol to replicate data to each server in the cluster. More
information on the internals of Integrated Storage can be found in the
<a href="/openbao/docs/internals/integrated-storage/">Integrated Storage internals
documentation</a>. Additionally, the
<a href="/openbao/docs/configuration/storage/raft/">Configuration</a> docs can help in configuring
OpenBao to use Integrated Storage.</p>
<p>The sections below go into various details on how to operate OpenBao with
Integrated Storage.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="server-to-server-communication">Server-to-Server communication<a href="#server-to-server-communication" class="hash-link" aria-label="Direct link to Server-to-Server communication" title="Direct link to Server-to-Server communication">​</a></h2>
<p>Once nodes are joined to one another they begin to communicate using mTLS over
OpenBao&#x27;s cluster port. The cluster port defaults to <code>8201</code>. The TLS information
is exchanged at join time and is rotated on a cadence.</p>
<p>A requirement for Integrated Storage is that the
<a href="/openbao/docs/concepts/ha/#per-node-cluster-address"><code>cluster_addr</code></a> configuration option
is set. This allows OpenBao to assign an address to the node ID at join time.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-membership">Cluster membership<a href="#cluster-membership" class="hash-link" aria-label="Direct link to Cluster membership" title="Direct link to Cluster membership">​</a></h2>
<p>This section will outline how to bootstrap and manage a cluster of OpenBao nodes
running Integrated Storage.</p>
<p>Integrated Storage is bootstrapped during the <a href="/openbao/tutorials/getting-started/getting-started-deploy/#initializing-the-vault">initialization
process</a>,
and results in a cluster of size 1. Depending on the <a href="/openbao/docs/internals/integrated-storage/#deployment-table">desired deployment
size</a>, nodes can be joined
to the active OpenBao node.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="joining-nodes">Joining nodes<a href="#joining-nodes" class="hash-link" aria-label="Direct link to Joining nodes" title="Direct link to Joining nodes">​</a></h3>
<p>Joining is the process of taking an uninitialized OpenBao node and making it a
member of an existing cluster. In order to authenticate the new node to the
cluster it must use the same seal mechanism. If using a Auto Unseal the node
must be configured to use the same KMS provider and Key as the cluster it&#x27;s
attempting to join. If using a Shamir seal the unseal keys must be provided to
the new node before the join process can complete. Once a node has successfully
joined, data from the active node can begin to replicate to it. Once a node has
been joined it cannot be re-joined to a different cluster.</p>
<p>You can either join the node automatically via the config file or manually through the
API (both methods described below). When joining a node, the API address of the leader node must be used. We
recommend setting the <a href="/openbao/docs/concepts/ha/#direct-access"><code>api_addr</code></a> configuration
option on all nodes to make joining simpler.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="retry_join-configuration"><code>retry_join</code> configuration<a href="#retry_join-configuration" class="hash-link" aria-label="Direct link to retry_join-configuration" title="Direct link to retry_join-configuration">​</a></h4>
<p>This method enables setting one, or more, target leader nodes in the config file.
When an uninitialized OpenBao server starts up it will attempt to join each potential
leader that is defined, retrying until successful. When one of the specified
leaders become active this node will successfully join. When using Shamir seal,
the joined nodes will still need to be unsealed manually. When using Auto Unseal
the node will be able to join and unseal automatically.</p>
<p>An example <a href="/openbao/docs/configuration/storage/raft/#retry_join-stanza"><code>retry_join</code></a>
config can be seen below:</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">storage &quot;raft&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path    = &quot;/var/raft/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  node_id = &quot;node3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retry_join {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    leader_api_addr = &quot;https://node1.openbao.local:8200&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retry_join {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    leader_api_addr = &quot;https://node2.openbao.local:8200&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note, in each <a href="/openbao/docs/configuration/storage/raft/#retry_join-stanza"><code>retry_join</code></a>
stanza, you may provide a single
<a href="/openbao/docs/configuration/storage/raft/#leader_api_addr"><code>leader_api_addr</code></a> or
<a href="/openbao/docs/configuration/storage/raft/#auto_join"><code>auto_join</code></a> value. When a cloud
<a href="/openbao/docs/configuration/storage/raft/#auto_join"><code>auto_join</code></a> configuration value is
provided, OpenBao will use <a href="https://github.com/hashicorp/go-discover" target="_blank" rel="noopener noreferrer">go-discover</a>
to automatically attempt to discover and resolve potential Raft leader
addresses.</p>
<p>See the go-discover
<a href="https://github.com/hashicorp/go-discover/blob/master/README.md" target="_blank" rel="noopener noreferrer">README</a> for
details on the format of the <a href="/openbao/docs/configuration/storage/raft/#auto_join"><code>auto_join</code></a> value.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">storage &quot;raft&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path    = &quot;/var/raft/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  node_id = &quot;node3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retry_join {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_join = &quot;provider=aws region=eu-west-1 tag_key=openbao tag_value=... access_key_id=... secret_access_key=...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By default, OpenBao will attempt to reach discovered peers using HTTPS and port 8200. Operators may override these through the
<a href="/openbao/docs/configuration/storage/raft/#auto_join_scheme"><code>auto_join_scheme</code></a> and
<a href="/openbao/docs/configuration/storage/raft/#auto_join_port"><code>auto_join_port</code></a> fields
respectively.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">storage &quot;raft&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path    = &quot;/var/raft/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  node_id = &quot;node3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retry_join {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_join = &quot;provider=aws region=eu-west-1 tag_key=openbao tag_value=... access_key_id=... secret_access_key=...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_join_scheme = &quot;http&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_join_port = 8201</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="join-from-the-cli">Join from the CLI<a href="#join-from-the-cli" class="hash-link" aria-label="Direct link to Join from the CLI" title="Direct link to Join from the CLI">​</a></h4>
<p>Alternatively you can use the <a href="/openbao/docs/commands/operator/raft/#join"><code>join</code> CLI
command</a> or the API to join a node. The
active node&#x27;s API address will need to be specified:</p>
<div class="language-shell-session codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell-session codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bao operator raft join https://node1.openbao.local:8200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="removing-peers">Removing peers<a href="#removing-peers" class="hash-link" aria-label="Direct link to Removing peers" title="Direct link to Removing peers">​</a></h3>
<p>Removing a peer node is a necessary step when you no longer want the node in the
cluster. This could happen if the node is rotated for a new one, the hostname
permanently changes and can no longer be accessed, you&#x27;re attempting to shrink
the size of the cluster, or for many other reasons. Removing the peer will
ensure the cluster stays at the desired size, and that quorum is maintained.</p>
<p>To remove the peer you can issue a
<a href="/openbao/docs/commands/operator/raft/#remove-peer"><code>remove-peer</code></a> command and provide the
node ID you wish to remove:</p>
<div class="language-shell-session codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell-session codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bao operator raft remove-peer node1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Peer removed successfully!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="listing-peers">Listing peers<a href="#listing-peers" class="hash-link" aria-label="Direct link to Listing peers" title="Direct link to Listing peers">​</a></h3>
<p>To see the current peer set for the cluster you can issue a
<a href="/openbao/docs/commands/operator/raft/#list-peers"><code>list-peers</code></a> command. All the voting
nodes that are listed here contribute to the quorum and a majority must be alive
for Integrated Storage to continue to operate.</p>
<div class="language-shell-session codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell-session codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bao operator raft list-peers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node     Address                   State       Voter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----     -------                   -----       -----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node1    node1.openbao.local:8201    follower    true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node2    node2.openbao.local:8201    follower    true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node3    node3.openbao.local:8201    leader      true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="integrated-storage-and-tls">Integrated storage and TLS<a href="#integrated-storage-and-tls" class="hash-link" aria-label="Direct link to Integrated storage and TLS" title="Direct link to Integrated storage and TLS">​</a></h2>
<p>We&#x27;ve glossed over some details in the above sections on bootstrapping clusters.
The instructions are sufficient for most cases, but some users have run into
problems when using auto-join and TLS in conjunction with things like auto-scaling.
The issue is that <a href="https://github.com/hashicorp/go-discover" target="_blank" rel="noopener noreferrer">go-discover</a> on
most platforms returns IPs (not hostnames), and because the IPs aren&#x27;t knowable
in advance, the TLS certificates used to secure the OpenBao API port don&#x27;t contain
these IPs in their IP SANs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="openbao-networking-recap">OpenBao networking recap<a href="#openbao-networking-recap" class="hash-link" aria-label="Direct link to OpenBao networking recap" title="Direct link to OpenBao networking recap">​</a></h3>
<p>Before we explore solutions to this problem, let&#x27;s recapitulate how OpenBao nodes
speak to one another.</p>
<p>OpenBao exposes two TCP ports: <a href="/openbao/docs/configuration/#api_addr">the API port</a> and
<a href="/openbao/docs/configuration/#cluster_addr">the cluster port</a>.</p>
<p>The API port is where clients send their OpenBao HTTP requests.</p>
<p>For a single-node OpenBao cluster you don&#x27;t worry about a cluster port as it won&#x27;t be used.</p>
<p>When you have multiple nodes, you also need a cluster port. This is used by OpenBao
nodes to issue RPCs to one another, e.g. to forward requests from a standby node
to the active node, or when Raft is in use, to handle leader election and
replication of stored data.</p>
<p>The cluster port is secured using a TLS certificate that the OpenBao active node
generates internally. It&#x27;s clear how this can work when not using integrated
storage: every node has at least read access to storage, so once the active
node has persisted the certificate, the standby nodes can fetch it, and all
agree on how cluster traffic should be encrypted.</p>
<p>It&#x27;s less clear how this works with Integrated Storage, as there is a chicken
and egg problem. Nodes don&#x27;t have a shared view of storage until the raft
cluster has been formed, but we&#x27;re trying to form the raft cluster! To solve
this problem, an OpenBao node must speak to another OpenBao node using the API port
instead of the cluster port. This is currently the only situation in which
OpenBao does this.</p>
<ul>
<li><code>node2</code> wants to join the cluster, so issues challenge API request to existing member <code>node1</code></li>
<li><code>node1</code> replies to challenge request with (1) an encrypted random UUID and (2) seal config</li>
<li><code>node2</code> must decrypt UUID using seal; if using auto-unseal can do it directly, if using Shamir must wait for user to provide enough unseal keys to perform decryption</li>
<li><code>node2</code> sends decrypted UUID back to <code>node1</code> using answer API</li>
<li><code>node1</code> sees <code>node2</code> can be trusted (since it has seal access) and replies with a bootstrap package which includes the cluster TLS certificate and private key</li>
<li><code>node2</code> gets sent a raft snapshot over the cluster port</li>
</ul>
<p>After this procedure the new node will never again send traffic to the API port.
All subsequent inter-node communication will use the cluster port.</p>
<p><img decoding="async" loading="lazy" alt="Raft Join Process" src="/openbao/assets/images/raft-join-detailed-1fafbe82aaa1390b1f1b17049977fb80.png" width="1600" height="1026" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="assisted-raft-join-techniques">Assisted raft join techniques<a href="#assisted-raft-join-techniques" class="hash-link" aria-label="Direct link to Assisted raft join techniques" title="Direct link to Assisted raft join techniques">​</a></h3>
<p>The simplest option is to do it by hand: issue <a href="/openbao/docs/commands/operator/raft/#join"><code>raft join</code></a> commands specifying the explicit names
or IPs of the nodes to join to. In this section we look at other TLS-compatible
options that lend themselves more to automation.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="autojoin-with-tls-servername">Autojoin with TLS servername<a href="#autojoin-with-tls-servername" class="hash-link" aria-label="Direct link to Autojoin with TLS servername" title="Direct link to Autojoin with TLS servername">​</a></h4>
<p>The simplest option might be to specify a
<a href="/openbao/docs/configuration/storage/raft/#leader_tls_servername"><code>leader_tls_servername</code></a>
in the <a href="/openbao/docs/configuration/storage/raft/#retry_join-stanza"><code>retry_join</code></a>
stanza which matches a <a href="https://en.wikipedia.org/wiki/Subject_Alternative_Name" target="_blank" rel="noopener noreferrer">DNS
SAN</a> in the certificate.</p>
<p>Note that names in a certificate&#x27;s DNS SAN don&#x27;t actually have to be registered
in a DNS server. Your nodes may have no names found in DNS, while still
using certificate(s) that contain this shared <code>servername</code> in their DNS SANs.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="autojoin-but-constrain-cidr-list-all-possible-ips-in-certificate">Autojoin but constrain CIDR, list all possible IPs in certificate<a href="#autojoin-but-constrain-cidr-list-all-possible-ips-in-certificate" class="hash-link" aria-label="Direct link to Autojoin but constrain CIDR, list all possible IPs in certificate" title="Direct link to Autojoin but constrain CIDR, list all possible IPs in certificate">​</a></h4>
<p>If all the OpenBao node IPs are assigned from a small subnet, e.g. a <code>/28</code>, it
becomes practical to put all the IPs that exist in that subnet into the IP SANs
of the TLS certificate the nodes will share.</p>
<p>The drawback here is that the cluster may someday outgrow the CIDR and changing
it may be a pain. For similar reasons this solution may be impractical when
using non-voting nodes and dynamically scaling clusters.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="load-balancer-instead-of-autojoin">Load balancer instead of autojoin<a href="#load-balancer-instead-of-autojoin" class="hash-link" aria-label="Direct link to Load balancer instead of autojoin" title="Direct link to Load balancer instead of autojoin">​</a></h4>
<p>Most OpenBao instances are going to have a load balancer (LB) between clients and
the OpenBao nodes. In that case, the LB knows how to route traffic to working
OpenBao nodes, and there&#x27;s no need for auto-join: we can just use
<a href="/openbao/docs/configuration/storage/raft/#retry_join-stanza"><code>retry_join</code></a> with the LB
address as the target.</p>
<p>One potential issue here: some users want a public facing LB for clients to
connect to OpenBao, but aren&#x27;t comfortable with OpenBao internal traffic
egressing from the internal network it normally runs on.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="outage-recovery">Outage recovery<a href="#outage-recovery" class="hash-link" aria-label="Direct link to Outage recovery" title="Direct link to Outage recovery">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quorum-maintained">Quorum maintained<a href="#quorum-maintained" class="hash-link" aria-label="Direct link to Quorum maintained" title="Direct link to Quorum maintained">​</a></h3>
<p>This section outlines the steps to take when a single server or multiple servers
are in a failed state but quorum is still maintained. This means the remaining
alive servers are still operational, can elect a leader, and are able to process
write requests.</p>
<p>If the failed server is recoverable, the best option is to bring it back online
and have it reconnect to the cluster with the same host address. This will return
the cluster to a fully healthy state.</p>
<p>If this is impractical, you need to remove the failed server. Usually, you can
issue a <a href="/openbao/docs/commands/operator/raft/#remove-peer"><code>remove-peer</code></a> command to
remove the failed server if it&#x27;s still a member of the cluster.</p>
<p>If the <a href="/openbao/docs/commands/operator/raft/#remove-peer"><code>remove-peer</code></a> command isn&#x27;t
possible or you&#x27;d rather manually re-write the cluster membership a
<a href="#manual-recovery-using-peers-json"><code>raft/peers.json</code></a> file can be written to
the configured data directory.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="quorum-lost">Quorum lost<a href="#quorum-lost" class="hash-link" aria-label="Direct link to Quorum lost" title="Direct link to Quorum lost">​</a></h3>
<p>In the event that multiple servers are lost, causing a loss of quorum and a
complete outage, partial recovery is still possible.</p>
<p>If the failed servers are recoverable, the best option is to bring them back
online and have them reconnect to the cluster using the same host addresses.
This will return the cluster to a fully healthy state.</p>
<p>If the failed servers are not recoverable, partial recovery is possible using
data on the remaining servers in the cluster. There may be data loss in this
situation because multiple servers were lost, so information about what&#x27;s
committed could be incomplete. The recovery process implicitly commits all
outstanding Raft log entries, so it&#x27;s also possible to commit data that was
uncommitted before the failure.</p>
<p>See the section below on manual recovery using
<a href="#manual-recovery-using-peers-json"><code>peers.json</code></a> for details of the recovery
procedure. You include only the remaining servers in the
<a href="#manual-recovery-using-peers-json"><code>peers.json</code></a> recovery file. The
cluster should be able to elect a leader once the remaining servers are all
restarted with an identical
<a href="#manual-recovery-using-peers-json"><code>peers.json</code></a> configuration.</p>
<p>Any servers you introduce later can be fresh with totally clean data
directories and joined using OpenBao&#x27;s join command.</p>
<p>In extreme cases, it should be possible to recover with just a single remaining
server by starting that single server with itself as the only peer in the
<a href="#manual-recovery-using-peers-json"><code>peers.json</code></a> recovery file.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="manual-recovery-using-peersjson">Manual recovery using peers.json<a href="#manual-recovery-using-peersjson" class="hash-link" aria-label="Direct link to Manual recovery using peers.json" title="Direct link to Manual recovery using peers.json">​</a></h3>
<p>Using <code>raft/peers.json</code> for recovery can cause uncommitted Raft log entries to be
implicitly committed, so this should only be used after an outage where no other
option is available to recover a lost server. Make sure you don&#x27;t have any
automated processes that will put the peers file in place on a periodic basis.</p>
<p>To begin, stop all remaining servers.</p>
<p>The next step is to go to the <a href="/openbao/docs/configuration/storage/raft/#path">configured data
path</a> of each OpenBao server. Inside that
directory, there will be a <code>raft/</code> sub-directory. We need to create a
<code>raft/peers.json</code> file. The file should be formatted as a JSON array containing
the node ID, <code>address:port</code>, and suffrage information of each OpenBao server you
wish to be in the cluster:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;id&quot;: &quot;node1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;address&quot;: &quot;node1.openbao.local:8201&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;non_voter&quot;: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;id&quot;: &quot;node2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;address&quot;: &quot;node2.openbao.local:8201&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;non_voter&quot;: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;id&quot;: &quot;node3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;address&quot;: &quot;node3.openbao.local:8201&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;non_voter&quot;: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>id</code> <code>(string: &lt;required&gt;)</code> - Specifies the node ID of the server. This can be
found in the config file, or inside the <code>node-id</code> file in the server&#x27;s data
directory if it was auto-generated.</li>
<li><code>address</code> <code>(string: &lt;required&gt;)</code> - Specifies the host and port of the server. The
port is the server&#x27;s cluster port.</li>
</ul>
<p>Create entries for all servers. You must confirm that servers you do not
include here have indeed failed and will not later rejoin the cluster. Ensure
that this file is the same across all remaining server nodes.</p>
<p>At this point, you can restart all the remaining servers. The cluster should be
in an operable state again. One of the nodes should claim leadership and become
active.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-recovery-methods">Other recovery methods<a href="#other-recovery-methods" class="hash-link" aria-label="Direct link to Other recovery methods" title="Direct link to Other recovery methods">​</a></h3>
<p>For other, non-quorum related recovery <a href="/openbao/docs/concepts/recovery-mode/">OpenBao&#x27;s
recovery</a> mode can be used.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/openbao/openbao/tree/main/website/content/docs/concepts/integrated-storage/index.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/openbao/docs/concepts/storage/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Storage</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/openbao/docs/concepts/integrated-storage/autopilot/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Autopilot</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#server-to-server-communication" class="table-of-contents__link toc-highlight">Server-to-Server communication</a></li><li><a href="#cluster-membership" class="table-of-contents__link toc-highlight">Cluster membership</a><ul><li><a href="#joining-nodes" class="table-of-contents__link toc-highlight">Joining nodes</a></li><li><a href="#removing-peers" class="table-of-contents__link toc-highlight">Removing peers</a></li><li><a href="#listing-peers" class="table-of-contents__link toc-highlight">Listing peers</a></li></ul></li><li><a href="#integrated-storage-and-tls" class="table-of-contents__link toc-highlight">Integrated storage and TLS</a><ul><li><a href="#openbao-networking-recap" class="table-of-contents__link toc-highlight">OpenBao networking recap</a></li><li><a href="#assisted-raft-join-techniques" class="table-of-contents__link toc-highlight">Assisted raft join techniques</a></li></ul></li><li><a href="#outage-recovery" class="table-of-contents__link toc-highlight">Outage recovery</a><ul><li><a href="#quorum-maintained" class="table-of-contents__link toc-highlight">Quorum maintained</a></li><li><a href="#quorum-lost" class="table-of-contents__link toc-highlight">Quorum lost</a></li><li><a href="#manual-recovery-using-peersjson" class="table-of-contents__link toc-highlight">Manual recovery using peers.json</a></li><li><a href="#other-recovery-methods" class="table-of-contents__link toc-highlight">Other recovery methods</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/openbao/docs/">Intro</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openbao/openbao/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://chat.lfx.linuxfoundation.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat Server<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://wiki.lfedge.org/display/OH/OpenBao+%28Hashicorp+Vault+Fork+effort%29+FAQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openbao/openbao" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 The OpenBao Authors. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>