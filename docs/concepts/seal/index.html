<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/seal" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Seal/Unseal | OpenBao</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://janma.github.io/openbao/docs/concepts/seal/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Seal/Unseal | OpenBao"><meta data-rh="true" name="description" content="An OpenBao must be unsealed before it can access its data. Likewise, it can be sealed to lock it down."><meta data-rh="true" property="og:description" content="An OpenBao must be unsealed before it can access its data. Likewise, it can be sealed to lock it down."><link data-rh="true" rel="icon" href="/openbao/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://janma.github.io/openbao/docs/concepts/seal/"><link data-rh="true" rel="alternate" href="https://janma.github.io/openbao/docs/concepts/seal/" hreflang="en"><link data-rh="true" rel="alternate" href="https://janma.github.io/openbao/docs/concepts/seal/" hreflang="x-default"><link rel="stylesheet" href="/openbao/assets/css/styles.a7459e73.css">
<script src="/openbao/assets/js/runtime~main.d13fa89d.js" defer="defer"></script>
<script src="/openbao/assets/js/main.f51d3bb7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/openbao/"><div class="navbar__logo"><img src="/openbao/img/logo.svg" alt="OpenBao Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/openbao/img/logo.svg" alt="OpenBao Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OpenBao</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/openbao/docs/">Docs</a><a class="navbar__item navbar__link" href="/openbao/api-docs/">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/openbao/openbao" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/what-is-openbao/">What is OpenBao?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/use-cases/">Use cases</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/get-started/developer-qs/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/browser-support/">Browser Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/install/">Installing OpenBao</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/internals/">Internals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/openbao/docs/concepts/">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/dev-server/">&#x27;Dev&#x27; Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/openbao/docs/concepts/seal/">Seal/Unseal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/lease/">Lease, renew, and revoke</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/auth/">Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/tokens/">Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/identity/">Identity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/oidc-provider/">OIDC provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/response-wrapping/">Response wrapping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/policies/">Policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/password-policies/">Password policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/username-templating/">Username templating</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/ha/">High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/storage/">Storage</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/openbao/docs/concepts/integrated-storage/">Integrated Storage</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/pgp-gpg-keybase/">PGP, GnuPG and Keybase</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/recovery-mode/">Recovery mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/resource-quotas/">Resource quotas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/transform/">Transform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/mount-migration/">Mount migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/duration-format/">Duration string format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/concepts/user-lockout/">User lockout</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/configuration/">Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/commands/">Commands (CLI)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/agent-and-proxy/">OpenBao Agent and Proxy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/secrets/">Secret Engines</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/auth/">Auth Methods</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/audit/">Audit Devices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/plugins/">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/platform/">Platforms</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/upgrading/">Upgrade Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/release-notes/">Release Notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/deprecation/">Deprecation Notices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/policies/">Policies</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/rfcs/">RFCs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/faq/">FAQ</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/glossary/">Glossary</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/openbao/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Concepts</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Seal/Unseal</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Seal/Unseal</h1>
<p>When an OpenBao server is started, it starts in a <em>sealed</em> state. In this
state, OpenBao is configured to know where and how to access the physical
storage, but doesn&#x27;t know how to decrypt any of it.</p>
<p><em>Unsealing</em> is the process of obtaining the plaintext root key necessary to
read the decryption key to decrypt the data, allowing access to the OpenBao.</p>
<p>Prior to unsealing, almost no operations are possible with OpenBao. For
example authentication, managing the mount tables, etc. are all not possible.
The only possible operations are to unseal the OpenBao and check the status
of the seal.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why">Why?<a href="#why" class="hash-link" aria-label="Direct link to Why?" title="Direct link to Why?">​</a></h2>
<p>The data stored by OpenBao is encrypted. OpenBao needs the <em>encryption key</em> in order
to decrypt the data. The encryption key is also stored with the data
(in the <em>keyring</em>), but encrypted with another encryption key known as the <em>root key</em>.</p>
<p>Therefore, to decrypt the data, OpenBao must decrypt the encryption key
which requires the root key. Unsealing is the process of getting access to
this root key. The root key is stored alongside all other OpenBao data,
but is encrypted by yet another mechanism: the unseal key.</p>
<p>To recap: most OpenBao data is encrypted using the encryption key in the keyring;
the keyring is encrypted by the root key; and the root key is encrypted by
the unseal key.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="shamir-seals">Shamir seals<a href="#shamir-seals" class="hash-link" aria-label="Direct link to Shamir seals" title="Direct link to Shamir seals">​</a></h2>
<p><img decoding="async" loading="lazy" alt="Shahir seals" src="/openbao/assets/images/vault-shamir-seal-9ba848ed9f348e03b004fc0cd92af233.png" width="666" height="299" class="img_ev3q"></p>
<p>The default OpenBao config uses a Shamir seal. Instead of distributing the unseal
key as a single key to an operator, OpenBao uses an algorithm known as
<a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing" target="_blank" rel="noopener noreferrer">Shamir&#x27;s Secret Sharing</a>
to split the key into shares. A certain threshold of shares is required to
reconstruct the unseal key, which is then used to decrypt the root key.</p>
<p>This is the <em>unseal</em> process: the shares are added one at a time (in any
order) until enough shares are present to reconstruct the key and
decrypt the root key.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="unsealing">Unsealing<a href="#unsealing" class="hash-link" aria-label="Direct link to Unsealing" title="Direct link to Unsealing">​</a></h2>
<p>The unseal process is done by running <code>bao operator unseal</code> or via the API.
This process is stateful: each key can be entered via multiple mechanisms from
multiple client machines and it will work. This allows each shares of the root
key to be on a distinct client machine for better security.</p>
<p>Note that when using the Shamir seal with multiple nodes, each node must be
unsealed with the required threshold of shares. Partial unsealing of each node
is not distributed across the cluster.</p>
<p>Once an OpenBao node is unsealed, it remains unsealed until one of these things happens:</p>
<ol>
<li>
<p>It is resealed via the API (see below).</p>
</li>
<li>
<p>The server is restarted.</p>
</li>
<li>
<p>OpenBao&#x27;s storage layer encounters an unrecoverable error.</p>
</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Note:</strong> Unsealing makes the process of automating an OpenBao install
difficult. Automated tools can easily install, configure, and start OpenBao,
but unsealing it using Shamir is a very manual process. For most users
Auto Unseal will provide a better experience.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sealing">Sealing<a href="#sealing" class="hash-link" aria-label="Direct link to Sealing" title="Direct link to Sealing">​</a></h2>
<p>There is also an API to seal the OpenBao. This will throw away the root
key in memory and require another unseal process to restore it. Sealing
only requires a single operator with root privileges.</p>
<p>This way, if there is a detected intrusion, the OpenBao data can be locked
quickly to try to minimize damages. It can&#x27;t be accessed again without
access to the root key shares.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="auto-unseal">Auto unseal<a href="#auto-unseal" class="hash-link" aria-label="Direct link to Auto unseal" title="Direct link to Auto unseal">​</a></h2>
<p>Auto Unseal was developed to aid in reducing the operational complexity of
keeping the unseal key secure. This feature delegates the responsibility of
securing the unseal key from users to a trusted device or service. At startup
OpenBao will connect to the device or service implementing the seal and ask it
to decrypt the root key OpenBao read from storage.</p>
<p><img decoding="async" loading="lazy" alt="Auto Unseal" src="/openbao/assets/images/vault-auto-unseal-be18e6bd9650dc15413a0812d025cda4.png" width="625" height="235" class="img_ev3q"></p>
<p>There are certain operations in OpenBao besides unsealing that
require a quorum of users to perform, e.g. generating a root token. When
using a Shamir seal the unseal keys must be provided to authorize these
operations. When using Auto Unseal these operations require <em>recovery
keys</em> instead.</p>
<p>Just as the initialization process with a Shamir seal yields unseal keys,
initializing with an Auto Unseal yields recovery keys.</p>
<p>It is still possible to seal an OpenBao node using the API. In this case OpenBao
will remain sealed until restarted, or the unseal API is used, which with Auto
Unseal requires the recovery key fragments instead of the unseal key fragments
that would be provided with Shamir. The process remains the same.</p>
<p>For a list of examples and supported providers, please see the
<a href="/openbao/docs/configuration/seal/">seal documentation</a>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Warning:</strong> Recovery keys cannot decrypt the root key, and thus are not
sufficient to unseal OpenBao if the Auto Unseal mechanism isn&#x27;t working. They
are purely an authorization mechanism.  Using Auto Unseal
creates a strict OpenBao lifecycle dependency on the underlying seal mechanism.
This means that if the seal mechanism (such as the Cloud KMS key) becomes unavailable,
or deleted before the seal is migrated, then there is no ability to recover
access to the OpenBao cluster until the mechanism is available again. <strong>If the seal
mechanism or its keys are permanently deleted, then the OpenBao cluster cannot be recovered, even
from backups.</strong>
To mitigate this risk, we recommend careful controls around management of the seal
mechanism, for example using
<a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html" target="_blank" rel="noopener noreferrer">AWS Service Control Policies</a>
or similar.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="recovery-key">Recovery key<a href="#recovery-key" class="hash-link" aria-label="Direct link to Recovery key" title="Direct link to Recovery key">​</a></h2>
<p>When OpenBao is initialized while using an HSM or KMS, rather than unseal keys
being returned to the operator, recovery keys are returned. These are generated
from an internal recovery key that is split via Shamir&#x27;s Secret Sharing, similar
to OpenBao&#x27;s treatment of unseal keys when running without an HSM or KMS.</p>
<p>Details about initialization and rekeying follow. When performing an operation
that uses recovery keys, such as <code>generate-root</code>, selection of the recovery
keys for this purpose, rather than the barrier unseal keys, is automatic.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="initialization">Initialization<a href="#initialization" class="hash-link" aria-label="Direct link to Initialization" title="Direct link to Initialization">​</a></h3>
<p>When initializing, the split is performed according to the following CLI flags
and their API equivalents in the <a href="/openbao/api-docs/system/init/">/sys/init</a> endpoint:</p>
<ul>
<li><code>recovery-shares</code>: The number of shares into which to split the recovery
key. This value is equivalent to the <code>recovery_shares</code> value in the API
endpoint.</li>
<li><code>recovery-threshold</code>: The threshold of shares required to reconstruct the
recovery key. This value is equivalent to the <code>recovery_threshold</code> value in
the API endpoint.</li>
<li><code>recovery-pgp-keys</code>: The PGP keys to use to encrypt the returned recovery
key shares. This value is equivalent to the <code>recovery_pgp_keys</code> value in the
API endpoint, although as with <code>pgp_keys</code> the object in the API endpoint is
an array, not a string.</li>
</ul>
<p>Additionally, OpenBao will refuse to initialize if the option has not been set to
generate a key, and no key is found. See
<a href="/openbao/docs/configuration/seal/pkcs11/">Configuration</a> for more details.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rekeying">Rekeying<a href="#rekeying" class="hash-link" aria-label="Direct link to Rekeying" title="Direct link to Rekeying">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="unseal-key">Unseal key<a href="#unseal-key" class="hash-link" aria-label="Direct link to Unseal key" title="Direct link to Unseal key">​</a></h4>
<p>OpenBao&#x27;s unseal key can be rekeyed using a normal <code>bao operator rekey</code>
operation from the CLI or the matching API calls. The rekey operation is
authorized by meeting the threshold of recovery keys. After rekeying, the new
barrier key is wrapped by the HSM or KMS and stored like the previous key; it is not
returned to the users that submitted their recovery keys.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recovery-key-1">Recovery key<a href="#recovery-key-1" class="hash-link" aria-label="Direct link to Recovery key" title="Direct link to Recovery key">​</a></h4>
<p>The recovery key can be rekeyed to change the number of shares/threshold or to
target different key holders via different PGP keys. When using the OpenBao CLI,
this is performed by using the <code>-target=recovery</code> flag to <code>bao operator rekey</code>.</p>
<p>Via the API, the rekey operation is performed with the same parameters as the
<a href="/openbao/api-docs/system/rekey/">normal <code>/sys/rekey</code>
endpoint</a>; however, the
API prefix for this operation is at <code>/sys/rekey-recovery-key</code> rather than
<code>/sys/rekey</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="seal-migration">Seal migration<a href="#seal-migration" class="hash-link" aria-label="Direct link to Seal migration" title="Direct link to Seal migration">​</a></h2>
<p>The Seal migration process cannot be performed without downtime, and due to the
technical underpinnings of the seal implementations, the process requires that
you briefly take the whole cluster down. While experiencing some downtime may
be unavoidable, we believe that switching seals is a rare event and that the
inconvenience of the downtime is an acceptable trade-off.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>NOTE</strong>: A backup should be taken before starting seal migration in case
something goes wrong.</p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>NOTE</strong>: Seal migration operation will require both old and new seals to be
available during the migration. For example, migration from Auto Unseal to Shamir
seal will require that the service backing the Auto Unseal is accessible during
the migration.</p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>NOTE</strong>: Seal migration from Auto Unseal to Auto Unseal of the same type is
supported in OpenBao. However, there is a current limitation that
prevents migrating from AWSKMS to AWSKMS; all other seal migrations of the same
type are supported. Seal migration from One Auto Unseal type (AWS KMS) to
different Auto Unseal type (HSM, Azure KMS, etc.) is also supported on older
versions as well.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migration-steps">Migration steps<a href="#migration-steps" class="hash-link" aria-label="Direct link to Migration steps" title="Direct link to Migration steps">​</a></h3>
<p>These steps are common for seal migrations between any supported kinds and for
any storage backend.</p>
<ol>
<li>
<p>Take a standby node down and update the <a href="/openbao/docs/configuration/seal/">seal
configuration</a>.</p>
<ul>
<li>If the migration is from Shamir seal to Auto seal, add the desired new Auto
seal block to the configuration.</li>
<li>If the migration is from Auto seal to Shamir seal, add <code>disabled = &quot;true&quot;</code>
to the old seal block.</li>
<li>If the migration is from Auto seal to another Auto seal, add <code>disabled = &quot;true&quot;</code> to the old seal block and add the desired new Auto seal block.</li>
</ul>
<p>Now, bring the standby node back up and run the unseal command on each key, by
supplying the <code>-migrate</code> flag.</p>
<ul>
<li>Supply Shamir unseal keys if the old seal was Shamir, which will be migrated
as the recovery keys for the Auto seal.</li>
<li>Supply recovery keys if the old seal is one of Auto seals, which will be
migrated as the recovery keys of the new Auto seal, or as Shamir unseal
keys if the new seal is Shamir.</li>
</ul>
</li>
<li>
<p>Perform step 1 for all the standby nodes, one at a time. It is necessary to
bring back the downed standby node before moving on to the other standby nodes,
specifically when Integrated Storage is in use for it helps to retain the
quorum.</p>
</li>
<li>
<p><a href="/openbao/docs/commands/operator/step-down/">Step down</a> the
active node. One of the standby nodes will become the new active node.
When using Integrated Storage, ensure that quorum is reached and a leader is
elected.</p>
</li>
<li>
<p>The new active node will perform the migration. Monitor the server log in
the active node to witness the completion of the seal migration process.
Wait for a little while for the migration information to replicate to all the
nodes in case of Integrated Storage.</p>
</li>
<li>
<p>Seal migration is now completed. Take down the old active node, update its
configuration to use the new seal blocks (completely unaware of the old seal type)
,and bring it back up. It will be auto-unsealed if the new seal is one of the
Auto seals, or will require unseal keys if the new seal is Shamir.</p>
</li>
<li>
<p>At this point, configuration files of all the nodes can be updated to only have the
new seal information. Standby nodes can be restarted right away and the active
node can be restarted upon a leadership change.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migration-pre-151">Migration pre 1.5.1<a href="#migration-pre-151" class="hash-link" aria-label="Direct link to Migration pre 1.5.1" title="Direct link to Migration pre 1.5.1">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="migration-from-shamir-to-auto-unseal">Migration from shamir to auto unseal<a href="#migration-from-shamir-to-auto-unseal" class="hash-link" aria-label="Direct link to Migration from shamir to auto unseal" title="Direct link to Migration from shamir to auto unseal">​</a></h4>
<p>To migrate from Shamir keys to Auto Unseal, take your server cluster offline and
update the <a href="/openbao/docs/configuration/seal/">seal configuration</a> with the appropriate
seal configuration. Bring your server back up and leave the rest of the nodes
offline if using multi-server mode, then run the unseal process with the
<code>-migrate</code> flag and bring the rest of the cluster online.</p>
<p>All unseal commands must specify the <code>-migrate</code> flag. Once the required
threshold of unseal keys are entered, unseal keys will be migrated to recovery
keys.</p>
<p><code>$ bao operator unseal -migrate</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="migration-from-auto-unseal-to-shamir">Migration from auto unseal to shamir<a href="#migration-from-auto-unseal-to-shamir" class="hash-link" aria-label="Direct link to Migration from auto unseal to shamir" title="Direct link to Migration from auto unseal to shamir">​</a></h4>
<p>To migrate from Auto Unseal to Shamir keys, take your server cluster offline
and update the <a href="/openbao/docs/configuration/seal/">seal configuration</a> and add <code>disabled = &quot;true&quot;</code> to the seal block. This allows the migration to use this information
to decrypt the key but will not unseal OpenBao. When you bring your server back
up, run the unseal process with the <code>-migrate</code> flag and use the Recovery Keys
to perform the migration. All unseal commands must specify the <code>-migrate</code> flag.
Once the required threshold of recovery keys are entered, the recovery keys
will be migrated to be used as unseal keys.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="migration-from-auto-unseal-to-auto-unseal">Migration from auto unseal to auto unseal<a href="#migration-from-auto-unseal-to-auto-unseal" class="hash-link" aria-label="Direct link to Migration from auto unseal to auto unseal" title="Direct link to Migration from auto unseal to auto unseal">​</a></h4>
<p>To migrate from Auto Unseal to a different Auto Unseal configuration, take your
server cluster offline and update the existing <a href="/openbao/docs/configuration/seal/">seal
configuration</a> and add <code>disabled = &quot;true&quot;</code> to the seal
block. Then add another seal block to describe the new seal.</p>
<p>When you bring your server back up, run the unseal process with the <code>-migrate</code>
flag and use the Recovery Keys to perform the migration. All unseal commands
must specify the <code>-migrate</code> flag. Once the required threshold of recovery keys
are entered, the recovery keys will be kept and used as recovery keys in the new
seal.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="migration-with-integrated-storage">Migration with integrated storage<a href="#migration-with-integrated-storage" class="hash-link" aria-label="Direct link to Migration with integrated storage" title="Direct link to Migration with integrated storage">​</a></h4>
<p>Integrated Storage uses the Raft protocol underneath, which requires a quorum of
servers to be online before the cluster is functional. Therefore, bringing the
cluster back up one node at a time with the seal configuration updated, will not
work in this case. Follow the same steps for each kind of migration described
above with the exception that after the cluster is taken offline, update the
seal configurations of all the nodes appropriately and bring them all back up.
When the quorum of nodes are back up, Raft will elect a leader and the leader
node that will perform the migration. The migrated information will be replicated to
all other cluster peers and when the peers eventually become the leader,
migration will not happen again on the peer nodes.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/openbao/openbao/tree/main/website/content/docs/concepts/seal.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/openbao/docs/concepts/dev-server/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">&#x27;Dev&#x27; Server</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/openbao/docs/concepts/lease/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lease, renew, and revoke</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why" class="table-of-contents__link toc-highlight">Why?</a></li><li><a href="#shamir-seals" class="table-of-contents__link toc-highlight">Shamir seals</a></li><li><a href="#unsealing" class="table-of-contents__link toc-highlight">Unsealing</a></li><li><a href="#sealing" class="table-of-contents__link toc-highlight">Sealing</a></li><li><a href="#auto-unseal" class="table-of-contents__link toc-highlight">Auto unseal</a></li><li><a href="#recovery-key" class="table-of-contents__link toc-highlight">Recovery key</a><ul><li><a href="#initialization" class="table-of-contents__link toc-highlight">Initialization</a></li><li><a href="#rekeying" class="table-of-contents__link toc-highlight">Rekeying</a></li></ul></li><li><a href="#seal-migration" class="table-of-contents__link toc-highlight">Seal migration</a><ul><li><a href="#migration-steps" class="table-of-contents__link toc-highlight">Migration steps</a></li><li><a href="#migration-pre-151" class="table-of-contents__link toc-highlight">Migration pre 1.5.1</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/openbao/docs/">Intro</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openbao/openbao/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://chat.lfx.linuxfoundation.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat Server<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://wiki.lfedge.org/display/OH/OpenBao+%28Hashicorp+Vault+Fork+effort%29+FAQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openbao/openbao" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 The OpenBao Authors. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>