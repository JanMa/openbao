<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-agent-and-proxy/agent/caching/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">OpenBao agent caching | OpenBao</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://janma.github.io/openbao/docs/agent-and-proxy/agent/caching/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="OpenBao agent caching | OpenBao"><meta data-rh="true" name="description" content="OpenBao Agent Caching allows client-side caching of responses containing newly
created tokens and responses containing leased secrets generated off of these
newly created tokens."><meta data-rh="true" property="og:description" content="OpenBao Agent Caching allows client-side caching of responses containing newly
created tokens and responses containing leased secrets generated off of these
newly created tokens."><link data-rh="true" rel="icon" href="/openbao/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://janma.github.io/openbao/docs/agent-and-proxy/agent/caching/"><link data-rh="true" rel="alternate" href="https://janma.github.io/openbao/docs/agent-and-proxy/agent/caching/" hreflang="en"><link data-rh="true" rel="alternate" href="https://janma.github.io/openbao/docs/agent-and-proxy/agent/caching/" hreflang="x-default"><link rel="stylesheet" href="/openbao/assets/css/styles.a7459e73.css">
<script src="/openbao/assets/js/runtime~main.cc92ce78.js" defer="defer"></script>
<script src="/openbao/assets/js/main.f8cc738b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/openbao/"><div class="navbar__logo"><img src="/openbao/img/logo.svg" alt="OpenBao Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/openbao/img/logo.svg" alt="OpenBao Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">OpenBao</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/openbao/docs/">Docs</a><a class="navbar__item navbar__link" href="/openbao/api-docs/">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/openbao/openbao" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/what-is-openbao/">What is OpenBao?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/use-cases/">Use cases</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/get-started/developer-qs/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/browser-support/">Browser Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/install/">Installing OpenBao</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/internals/">Internals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/concepts/">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/configuration/">Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/commands/">Commands (CLI)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/openbao/docs/agent-and-proxy/">OpenBao Agent and Proxy</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/agent-and-proxy/">OpenBao agent and OpenBao proxy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/openbao/docs/agent-and-proxy/autoauth/">Auto-Auth</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/openbao/docs/agent-and-proxy/proxy/">OpenBao Proxy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/">OpenBao Agent</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/apiproxy/">API proxy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/caching/">Caching</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/caching/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/caching/persistent-caches/">Persistent Caches</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/generate-config/">generate-config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/process-supervisor/">Process Supervisor Mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/template/">Templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/winsvc/">Windows service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/openbao/docs/agent-and-proxy/agent/versions/">Version compatibility</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/secrets/">Secret Engines</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/auth/">Auth Methods</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/audit/">Audit Devices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/plugins/">Plugins</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/platform/">Platforms</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/upgrading/">Upgrade Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/release-notes/">Release Notes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/deprecation/">Deprecation Notices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/policies/">Policies</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/openbao/docs/faq/">FAQ</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/openbao/docs/glossary/">Glossary</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/openbao/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">OpenBao Agent and Proxy</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">OpenBao Agent</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Caching</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Overview</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>OpenBao agent caching</h1>
<p>OpenBao Agent Caching allows client-side caching of responses containing newly
created tokens and responses containing leased secrets generated off of these
newly created tokens. The renewals of the cached tokens and leases are also
managed by the agent.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="caching-and-renewals">Caching and renewals<a href="#caching-and-renewals" class="hash-link" aria-label="Direct link to Caching and renewals" title="Direct link to Caching and renewals">​</a></h2>
<p>Response caching and renewals are managed by the agent only under these
specific scenarios.</p>
<ol>
<li>
<p>Token creation requests are made through the agent. This means that any
login operations performed using various auth methods and invoking the token
creation endpoints of the token auth method via the agent will result in the
response getting cached by the agent. Responses containing new tokens will
be cached by the agent only if the parent token is already being managed by
the agent or if the new token is an orphan token.</p>
</li>
<li>
<p>Leased secret creation requests are made through the agent using tokens that
are already managed by the agent. This means that any dynamic credentials
that are issued using the tokens managed by the agent, will be cached and
its renewals are taken care of.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="persistent-cache">Persistent cache<a href="#persistent-cache" class="hash-link" aria-label="Direct link to Persistent cache" title="Direct link to Persistent cache">​</a></h2>
<p>OpenBao Agent can restore tokens and leases from a persistent cache file created
by a previous OpenBao Agent process.</p>
<p>Refer to the <a href="/openbao/docs/agent-and-proxy/agent/caching/persistent-caches/">OpenBao Agent Persistent
Caching</a> page for more information on
this functionality.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cache-evictions">Cache evictions<a href="#cache-evictions" class="hash-link" aria-label="Direct link to Cache evictions" title="Direct link to Cache evictions">​</a></h2>
<p>The eviction of cache entries pertaining to secrets will occur when the agent
can no longer renew them. This can happen when the secrets hit their maximum
TTL or if the renewals result in errors.</p>
<p>Agent does some best-effort cache evictions by observing specific request types
and response codes. For example, if a token revocation request is made via the
agent and if the forwarded request to the OpenBao server succeeds, then agent
evicts all the cache entries associated with the revoked token. Similarly, any
lease revocation operation will also be intercepted by the agent and the
respective cache entries will be evicted.</p>
<p>Note that while agent evicts the cache entries upon secret expirations and upon
intercepting revocation requests, it is still possible for the agent to be
completely unaware of the revocations that happen through direct client
interactions with the OpenBao server. This could potentially lead to stale cache
entries. For managing the stale entries in the cache, an endpoint
<code>/agent/v1/cache-clear</code>(see below) is made available to manually evict cache
entries based on some of the query criteria used for indexing the cache entries.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="request-uniqueness">Request uniqueness<a href="#request-uniqueness" class="hash-link" aria-label="Direct link to Request uniqueness" title="Direct link to Request uniqueness">​</a></h2>
<p>In order to detect repeat requests and return cached responses, agent will need
to have a way to uniquely identify the requests. This computation as it stands
today takes a simplistic approach (may change in future) of serializing and
hashing the HTTP request along with all the headers and the request body. This
hash value is then used as an index into the cache to check if the response is
readily available. The consequence of this approach is that the hash value for
any request will differ if any data in the request is modified. This has the
side-effect of resulting in false negatives if say, the ordering of the request
parameters are modified. As long as the requests come in without any change,
caching behavior should be consistent. Identical requests with differently
ordered request values will result in duplicated cache entries. A heuristic
assumption that the clients will use consistent mechanisms to make requests,
thereby resulting in consistent hash values per request is the idea upon which
the caching functionality is built upon.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="renewal-management">Renewal management<a href="#renewal-management" class="hash-link" aria-label="Direct link to Renewal management" title="Direct link to Renewal management">​</a></h2>
<p>The tokens and leases are renewed by the agent using the secret renewer that is
made available via the OpenBao server&#x27;s <a href="https://godoc.org/github.com/openbao/openbao/api#Renewer" target="_blank" rel="noopener noreferrer">Go
API</a>. Agent performs
all operations in memory and does not persist anything to storage. This means
that when the agent is shut down, all the renewal operations are immediately
terminated and there is no way for agent to resume renewals after the fact.
Note that shutting down the agent does not indicate revocations of the secrets,
instead it only means that renewal responsibility for all the valid unrevoked
secrets are no longer performed by the OpenBao agent.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="agent-cli">Agent CLI<a href="#agent-cli" class="hash-link" aria-label="Direct link to Agent CLI" title="Direct link to Agent CLI">​</a></h3>
<p>Agent&#x27;s listener address will be picked up by the CLI through the
<code>VAULT_AGENT_ADDR</code> environment variable. This should be a complete URL such as
<code>&quot;http://127.0.0.1:8200&quot;</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="api">API<a href="#api" class="hash-link" aria-label="Direct link to API" title="Direct link to API">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cache-clear">Cache clear<a href="#cache-clear" class="hash-link" aria-label="Direct link to Cache clear" title="Direct link to Cache clear">​</a></h3>
<p>This endpoint clears the cache based on given criteria. To use this
API, some information on how the agent caches values should be known
beforehand. Each response that is cached in the agent will be indexed on some
factors depending on the type of request. Those factors can be the <code>token</code> that
is belonging to the cached response, the <code>token_accessor</code> of the token
belonging to the cached response, the <code>request_path</code> that resulted in the
cached response, the <code>lease</code> that is attached to the cached response, the
<code>namespace</code> to which the cached response belongs to, and a few more. This API
exposes some factors through which associated cache entries are fetched and
evicted. For listeners without caching enabled, this API will still be available,
but will do nothing (there is no cache to clear) and will return a <code>200</code> response.</p>
<table><thead><tr><th style="text-align:left">Method</th><th style="text-align:left">Path</th><th style="text-align:left">Produces</th></tr></thead><tbody><tr><td style="text-align:left"><code>POST</code></td><td style="text-align:left"><code>/agent/v1/cache-clear</code></td><td style="text-align:left"><code>200 application/json</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="parameters">Parameters<a href="#parameters" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4>
<ul>
<li>
<p><code>type</code> <code>(strings: required)</code> - The type of cache entries to evict. Valid
values are <code>request_path</code>, <code>lease</code>, <code>token</code>, <code>token_accessor</code>, and <code>all</code>.
If the <code>type</code> is set to <code>all</code>, the <em>entire cache</em> is cleared.</p>
</li>
<li>
<p><code>value</code> <code>(string: required)</code> - An exact value or the prefix of the value for
the <code>type</code> selected. This parameter is optional when the <code>type</code> is set
to <code>all</code>.</p>
</li>
<li>
<p><code>namespace</code> <code>(string: optional)</code> - This is only applicable when the <code>type</code> is set to
<code>request_path</code>. The namespace of which the cache entries to be evicted for
the given request path.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-payload">Sample payload<a href="#sample-payload" class="hash-link" aria-label="Direct link to Sample payload" title="Direct link to Sample payload">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;type&quot;: &quot;token&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;value&quot;: &quot;hvs.rlNjegSKykWcplOkwsjd8bP9&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-request">Sample request<a href="#sample-request" class="hash-link" aria-label="Direct link to Sample request" title="Direct link to Sample request">​</a></h3>
<div class="language-shell-session codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell-session codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --request POST \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --data @payload.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    http://127.0.0.1:1234/agent/v1/cache-clear</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-cache">Configuration (<code>cache</code>)<a href="#configuration-cache" class="hash-link" aria-label="Direct link to configuration-cache" title="Direct link to configuration-cache">​</a></h2>
<p>The presence of the top level <code>cache</code> block in any way (including an empty <code>cache</code> block)  will enable the cache.
The top level <code>cache</code> block has the following configuration entry:</p>
<ul>
<li><code>persist</code> <code>(object: optional)</code> - Configuration for the persistent cache.</li>
</ul>
<p>The <code>cache</code> block also supports the <code>use_auto_auth_token</code>, <code>enforce_consistency</code>, and
<code>when_inconsistent</code> configuration values of the <code>api_proxy</code> block
<a href="/openbao/docs/agent-and-proxy/agent/apiproxy/#configuration-api_proxy">described in the API Proxy documentation</a> only to
maintain backwards compatibility. This configuration <strong>cannot</strong> be specified alongside <code>api_proxy</code> equivalents,
should not be preferred over configuring these values in the <code>api_proxy</code> block,
and <code>api_proxy</code> should be the preferred place to configure these values.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Note:</strong> When the <code>cache</code> block is defined, at least one
<a href="/openbao/docs/agent-and-proxy/agent/template/">template</a> or <a href="/openbao/docs/agent-and-proxy/agent/#listener-stanza">listener</a> must also be defined
in the config, otherwise there is no way to utilize the cache.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-persist">Configuration (Persist)<a href="#configuration-persist" class="hash-link" aria-label="Direct link to Configuration (Persist)" title="Direct link to Configuration (Persist)">​</a></h3>
<p>These are common configuration values that live within the <code>persist</code> block:</p>
<ul>
<li>
<p><code>type</code> <code>(string: required)</code> - The type of the persistent cache to use,
e.g. <code>kubernetes</code>. <em>Note</em>: when using HCL this can be used as the key for
the block, e.g. <code>persist &quot;kubernetes&quot; {...}</code>. Currently, only <code>kubernetes</code>
is supported.</p>
</li>
<li>
<p><code>path</code> <code>(string: required)</code> - The path on disk where the persistent cache file
should be created or restored from.</p>
</li>
<li>
<p><code>keep_after_import</code> <code>(bool: optional)</code> - When set to true, a restored cache file
is not deleted. Defaults to <code>false</code>.</p>
</li>
<li>
<p><code>exit_on_err</code> <code>(bool: optional)</code> - When set to true, if any errors occur during
a persistent cache restore, OpenBao Agent will exit with an error. Defaults to <code>true</code>.</p>
</li>
<li>
<p><code>service_account_token_file</code> <code>(string: optional)</code> - When <code>type</code> is set to <code>kubernetes</code>,
this configures the path on disk where the Kubernetes service account token can be found.
Defaults to <code>/var/run/secrets/kubernetes.io/serviceaccount/token</code>.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-listener">Configuration (<code>listener</code>)<a href="#configuration-listener" class="hash-link" aria-label="Direct link to configuration-listener" title="Direct link to configuration-listener">​</a></h2>
<ul>
<li><code>listener</code> <code>(array of objects: required)</code> - Configuration for the listeners.</li>
</ul>
<p>There can be one or more <code>listener</code> blocks at the top level. Adding a listener enables
the <a href="/openbao/docs/agent-and-proxy/agent/apiproxy/">API Proxy</a> and enables the API proxy to use the cache, if configured.
These configuration values are common to both <code>tcp</code> and <code>unix</code> listener blocks. Blocks of type
<code>tcp</code> support the standard <code>tcp</code> <a href="/openbao/docs/configuration/listener/tcp/">listener</a>
options. Additionally, the <code>role</code> string option is available as part of the top level
of the <code>listener</code> block, which can be configured to <code>metrics_only</code> to serve only metrics,
or the default role, <code>default</code>, which serves everything (including metrics).</p>
<ul>
<li>
<p><code>type</code> <code>(string: required)</code> - The type of the listener to use. Valid values
are <code>tcp</code> and <code>unix</code>.
<em>Note</em>: when using HCL this can be used as the key for the block, e.g.
<code>listener &quot;tcp&quot; {...}</code>.</p>
</li>
<li>
<p><code>address</code> <code>(string: required)</code> - The address for the listener to listen to.
This can either be a URL path when using <code>tcp</code> or a file path when using
<code>unix</code>. For example, <code>127.0.0.1:8200</code> or <code>/path/to/socket</code>. Defaults to
<code>127.0.0.1:8200</code>.</p>
</li>
<li>
<p><code>tls_disable</code> <code>(bool: false)</code> - Specifies if TLS will be disabled.</p>
</li>
<li>
<p><code>tls_key_file</code> <code>(string: optional)</code> - Specifies the path to the private key
for the certificate.</p>
</li>
<li>
<p><code>tls_cert_file</code> <code>(string: optional)</code> - Specifies the path to the certificate
for TLS.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-configuration">Example configuration<a href="#example-configuration" class="hash-link" aria-label="Direct link to Example configuration" title="Direct link to Example configuration">​</a></h3>
<p>Here is an example of a cache configuration with the optional <code>persist</code> block,
alongside a regular listener, and a listener that only serves metrics.</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Other OpenBao agent configuration blocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cache {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	persist = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		type = &quot;kubernetes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		path = &quot;/openbao/agent-cache/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		keep_after_import = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		exit_on_err = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		service_account_token_file = &quot;/tmp/serviceaccount/token&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listener &quot;tcp&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;127.0.0.1:8100&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tls_disable = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listener &quot;tcp&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = &quot;127.0.0.1:3000&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tls_disable = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    role = &quot;metrics_only&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tutorial">Tutorial<a href="#tutorial" class="hash-link" aria-label="Direct link to Tutorial" title="Direct link to Tutorial">​</a></h2>
<p>Refer to the <a href="/openbao/tutorials/vault-agent/agent-caching/">OpenBao Agent
Caching</a>
tutorial to learn how to use the OpenBao Agent to increase the availability of tokens and secrets to clients using its Caching function.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/openbao/openbao/tree/main/website/content/docs/agent-and-proxy/agent/caching/index.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/openbao/docs/agent-and-proxy/agent/apiproxy/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">API proxy</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/openbao/docs/agent-and-proxy/agent/caching/persistent-caches/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#caching-and-renewals" class="table-of-contents__link toc-highlight">Caching and renewals</a></li><li><a href="#persistent-cache" class="table-of-contents__link toc-highlight">Persistent cache</a></li><li><a href="#cache-evictions" class="table-of-contents__link toc-highlight">Cache evictions</a></li><li><a href="#request-uniqueness" class="table-of-contents__link toc-highlight">Request uniqueness</a></li><li><a href="#renewal-management" class="table-of-contents__link toc-highlight">Renewal management</a><ul><li><a href="#agent-cli" class="table-of-contents__link toc-highlight">Agent CLI</a></li></ul></li><li><a href="#api" class="table-of-contents__link toc-highlight">API</a><ul><li><a href="#cache-clear" class="table-of-contents__link toc-highlight">Cache clear</a></li><li><a href="#sample-payload" class="table-of-contents__link toc-highlight">Sample payload</a></li><li><a href="#sample-request" class="table-of-contents__link toc-highlight">Sample request</a></li></ul></li><li><a href="#configuration-cache" class="table-of-contents__link toc-highlight">Configuration (<code>cache</code>)</a><ul><li><a href="#configuration-persist" class="table-of-contents__link toc-highlight">Configuration (Persist)</a></li></ul></li><li><a href="#configuration-listener" class="table-of-contents__link toc-highlight">Configuration (<code>listener</code>)</a><ul><li><a href="#example-configuration" class="table-of-contents__link toc-highlight">Example configuration</a></li></ul></li><li><a href="#tutorial" class="table-of-contents__link toc-highlight">Tutorial</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/openbao/docs/">Intro</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openbao/openbao/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://chat.lfx.linuxfoundation.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat Server<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://wiki.lfedge.org/display/OH/OpenBao+%28Hashicorp+Vault+Fork+effort%29+FAQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/openbao/openbao" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 The OpenBao Authors. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>